import{_ as N}from"./CEcF5dWm.js";import{f as w,a as M,o as x,w as _,B as c,V as B,c as j,ap as K,j as S,aE as q,l as P,_ as D,b as a,C as V,a4 as z,aF as $,i as A,aN as G,k as R,A as I,D as L,G as O,aQ as Q}from"./DhOLkSnF.js";import{_ as H,a as J,b as W,c as X}from"./DAqc9GYg.js";import{_ as Y}from"./CSbqei5V.js";import{_ as Z}from"./DAIKkUkW.js";import{_ as ee}from"./DAeRr84W.js";import{_ as ne}from"./Kwaskf5N.js";import{_ as te}from"./DQLwzL7i.js";import{_ as oe}from"./Db__RPjw.js";import{_ as ae}from"./BZLiX_8y.js";import{a as ie,g as re,b as se}from"./DU92BzlQ.js";import{o as le,s as T}from"./B-mCBPct.js";import{u as ce,b as me}from"./Bo5OMT4U.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./CLKxJTZi.js";import"./D0vBe5Vh.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";import"./HRiyi1uV.js";import"./CseYhDvv.js";import"./CemQtCgh.js";import"./-rcGzxkB.js";import"./CLU2_0cD.js";const de=w({__name:"CheckboxTree",props:{menu:{default:[]}},setup(v){const C=v,g=(o,d=null)=>{let f=0;o.forEach(m=>{let k;m.children&&m.children.length>0&&(k=g(m.children,m)),m.checked=k?k.checked:m.checked,m.checked===!0&&f++});let n="indeterminate";return d&&(f===o.length?n=!0:f===0&&(n=!1)),{checked:n,children:o}},b=(o,d)=>{o&&o.forEach(f=>{f.checked=d,b(f.children,d)})},y=(o,d)=>{o.checked=d,d?b(o.children,!0):b(o.children,!1),g(C.menu)};return(o,d)=>{const f=ne,n=te;return x(),M(n,{items:v.menu,orientation:"vertical",ui:{item:"mb-1",linkLeadingIcon:"text-(--ui-primary)",linkLabel:"text-(--ui-primary)"}},{"item-leading":_(({item:m})=>[c(f,{"model-value":m.checked,"onUpdate:modelValue":k=>y(m,k),onClick:d[0]||(d[0]=B(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"])]),_:1},8,["items"])}}}),ue=Object.assign(de,{__name:"CheckboxTree"}),fe=w({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})},menu:{default:()=>[]}},emits:["update:dialog","refresh"],setup(v,{emit:C}){const g=v,b=C,y=j({get(){return g.dialog},set(h){b("update:dialog",h)}}),o=()=>{y.value=!1},d=K("formRef"),f=le({name:T().nonempty(),group_id:T().nonempty()}),n=S({loading:!1,form:{}}),m=(h,r=[])=>h.reduce((t,e)=>(e.checked&&t.push(e.value),e.children?.length&&m(e.children,r),t),r),k=q();async function U(){n.loading=!0;const{error:h}=await ie({...n.form,menus:[...m(g.menu)].join(",")});h||(k.add({title:"操作成功",color:"success"}),b("refresh")),n.loading=!1}return P(()=>g.dialog,h=>{h&&(n.loading=!1,n.form=g.currentForm)}),(h,r)=>{const t=D,e=Z,s=ee,p=ue,u=oe,l=ae;return x(),M(l,{open:a(y),"onUpdate:open":r[5]||(r[5]=i=>z(y)?y.value=i:null),title:"分配权限",dismissible:!1,ui:{footer:"justify-end"}},{body:_(()=>[c(u,{ref_key:"formRef",ref:d,schema:a(f),state:a(n).form,class:"flex flex-col gap-4",onSubmit:U},{default:_(()=>[c(s,{label:"名称",name:"name",required:""},{default:_(()=>[c(e,{modelValue:a(n).form.name,"onUpdate:modelValue":r[1]||(r[1]=i=>a(n).form.name=i),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:_(()=>[a(n).form.name?(x(),M(t,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:r[0]||(r[0]=i=>a(n).form.name="")})):V("",!0)]),_:1},8,["modelValue"])]),_:1}),c(s,{label:"标识",name:"group_id",required:""},{default:_(()=>[c(e,{modelValue:a(n).form.group_id,"onUpdate:modelValue":r[3]||(r[3]=i=>a(n).form.group_id=i),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:_(()=>[a(n).form.group_id?(x(),M(t,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:r[2]||(r[2]=i=>a(n).form.group_id="")})):V("",!0)]),_:1},8,["modelValue"])]),_:1}),c(s,{label:"分配权限"},{default:_(()=>[c(p,{menu:v.menu},null,8,["menu"])]),_:1})]),_:1},8,["schema","state"])]),footer:_(()=>[c(t,{label:"取消",color:"neutral",variant:"outline",onClick:o}),c(t,{loading:a(n).loading,label:"确认",variant:"solid",onClick:r[4]||(r[4]=i=>a(d)?.submit())},null,8,["loading"])]),_:1},8,["open"])}}}),pe=Object.assign(fe,{__name:"SystemRoleEdit"}),_e=[{accessorKey:"id",header:()=>$(D,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent text-(--ui-text-highlighted) font-semibold"})},{accessorKey:"name",header:"名称"},{accessorKey:"group_id",header:"标识"}],ge={key:0,class:"absolute top-0 left-0 right-0 h-(--ui-header-height) flex items-center justify-between border-b border-(--ui-border) px-4 sm:px-6 bg-(--ui-bg)"},he={class:"flex items-center gap-4"},Ie=w({name:"SystemRole",__name:"role",setup(v){const g=ce(me).smaller("lg"),b=A(),{hasPermission:y}=G(),o=S({isDialog:!1,currentForm:{},menu:[]}),d=async()=>({error:null,data:{list:[{id:1,name:"管理员",group_id:1},{id:2,name:"运营",group_id:5},{id:3,name:"超级管理员",group_id:99}]}}),f=t=>t.sort((e,s)=>(e.sort?Number(e.sort):0)-(s.sort?Number(s.sort):0)).map(e=>(e.children&&f(e.children),e)),n=(t,e,s=[])=>e.reduce((p,u)=>(t.includes(u.key)&&p.push(u.key),u.children?.length&&n(t,u.children,s),p),s),m=(t,e,s=null)=>{const p=[];t.forEach(l=>{let i;l.children&&l.children.length>0&&(i=m(l.children,e,l)),p.push({label:l.name,value:l.id,checked:i?i.checked:e.includes(l.id),children:i?i.children:void 0})});let u="indeterminate";if(s){let l=0;p.forEach(i=>{i.checked===!0&&l++}),l===p.length?u=!0:l===0&&(u=!1)}return{checked:u,children:p}},k=async t=>{o.isDialog=!0,o.currentForm={name:t.name,group_id:String(t.group_id)},o.menu=[];const e=await Promise.allSettled([re(),se({group_id:t.group_id})]);if(e[0].status==="fulfilled"&&e[0].value.data&&e[1].status==="fulfilled"&&e[1].value.data){const s=f(Q(e[0].value.data.list)),p=e[1].value.data.menus.map(l=>l.id),u=n(p,s);o.menu=m(s,u).children}},U=async()=>{b.value.reload(),o.isDialog=!1};function h(t){return[{label:"分配权限",icon:"material-symbols:edit-square-outline",disabled:!y("rbac-group-add"),onSelect(){k(t.original)}}]}const r=[..._e,{id:"actions",cell:({row:t})=>$("div",{class:"text-right"},$(N,{content:{align:"end"},items:h(t)},()=>$(D,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(t,e)=>{const s=J,p=H,u=W,l=Y,i=X,E=pe;return x(),R(O,null,[c(i,{ui:{body:"pb-[12px]! gap-0!"}},I({body:_(()=>[a(g)?V("",!0):(x(),R("div",ge,[L("div",he,[c(s),c(u)])])),c(l,{ref_key:"tableRef",ref:b,"data-request":d,columns:r,"default-page-size":100},null,512)]),_:2},[a(g)?{name:"header",fn:_(()=>[c(p,{title:"权限管理"},{leading:_(()=>[c(s)]),_:1})]),key:"0"}:void 0]),1024),c(E,{dialog:a(o).isDialog,"onUpdate:dialog":e[0]||(e[0]=F=>a(o).isDialog=F),"current-form":a(o).currentForm,menu:a(o).menu,onRefresh:U},null,8,["dialog","current-form","menu"])],64)}}});export{Ie as default};
