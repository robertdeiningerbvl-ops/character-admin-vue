import{_ as S}from"./1OJ4jHSB.js";import{w as D,_ as V,J as N,K as j}from"./DiI9-bkE.js";import{_ as K}from"./Odvr87Pg.js";import{_ as B}from"./CuFgEFCp.js";import{_ as q}from"./oJBVUttf.js";import{_ as z}from"./BdKneTYw.js";import{_ as L}from"./CCHrFwgR.js";import{_ as P}from"./y-87kxSS.js";import{p as $,z as w,a1 as C,a2 as k,a7 as f,a8 as A,ai as G,w as I,u as l,R,i as O,c as J,r as E,E as y,A as W,W as H,h as Q}from"./Cp_GvCOL.js";import{_ as X}from"./9B_i7pfW.js";import{_ as Y}from"./8gEztUrL.js";import{a as Z,g as ee,b as te}from"./YeUkikDc.js";import{o as ne,s as U}from"./CgOwER5m.js";import{_ as oe}from"./Bml5z8l2.js";import"./D7PB4JkZ.js";import"./C-fFc4Sm.js";import"./DnWsfCtc.js";import"./C6Y-ieo6.js";import"./De6cJ90F.js";import"./BrwH2_O0.js";import"./7ga_NNx6.js";import"./BHtpJmxp.js";import"./BlLzDdHJ.js";import"./CM1DIlR0.js";import"./B3KMLFeu.js";import"./DkYr1hfb.js";import"./DZaB2s8a.js";import"./K6pfE6CB.js";import"./B9BvCEkO.js";import"./DxT_AjaP.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";import"./C3gvogBg.js";import"./B1GmTriL.js";import"./_eNQqsN0.js";import"./Baq49nZQ.js";const ie=$({__name:"CheckboxTree",props:{menu:{default:[]}},setup(_){const g=_,d=(s,c=null)=>{let p=0;s.forEach(u=>{let b;u.children&&u.children.length>0&&(b=d(u.children,u)),u.checked=b?b.checked:u.checked,u.checked===!0&&p++});let n="indeterminate";return c&&(p===s.length?n=!0:p===0&&(n=!1)),{checked:n,children:s}},o=(s,c)=>{s&&s.forEach(p=>{p.checked=c,o(p.children,c)})},h=(s,c)=>{s.checked=c,c?o(s.children,!0):o(s.children,!1),d(g.menu)};return(s,c)=>{const p=L,n=P;return w(),C(n,{items:_.menu,orientation:"vertical",ui:{item:"mb-1",linkLeadingIcon:"text-(--ui-primary)",linkLabel:"text-(--ui-primary)"}},{"item-leading":k(({item:u})=>[f(p,{"model-value":u.checked,"onUpdate:modelValue":b=>h(u,b),onClick:c[0]||(c[0]=A(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"])]),_:1},8,["items"])}}}),re=Object.assign(ie,{__name:"CheckboxTree"}),ae=$({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})},menu:{default:()=>[]}},emits:["update:dialog","refresh"],setup(_,{emit:g}){const d=_,o=g,h=J({get(){return d.dialog},set(t){o("update:dialog",t)}}),s=()=>{h.value=!1},c=G("formRef"),p=ne({name:U().nonempty(),group_id:U().nonempty()}),n=E({loading:!1,form:{}}),u=(t,e=[])=>t.reduce((i,r)=>(r.checked&&i.push(r.value),r.children?.length&&u(r.children,e),i),e),b=D();async function M(){n.loading=!0;const{error:t}=await Z({...n.form,menus:[...u(d.menu)].join(",")});t||(b.add({title:"操作成功",color:"success"}),o("refresh")),n.loading=!1}return I(()=>d.dialog,t=>{t&&(n.loading=!1,n.form=d.currentForm)}),(t,e)=>{const i=V,r=q,m=z,a=re,x=X,F=Y;return w(),C(F,{open:l(h),"onUpdate:open":e[5]||(e[5]=v=>O(h)?h.value=v:null),title:"分配权限",ui:{footer:"justify-end"}},{body:k(()=>[f(x,{ref_key:"formRef",ref:c,schema:l(p),state:l(n).form,class:"flex flex-col gap-4",onSubmit:M},{default:k(()=>[f(m,{label:"名称",name:"name",required:""},{default:k(()=>[f(r,{modelValue:l(n).form.name,"onUpdate:modelValue":e[1]||(e[1]=v=>l(n).form.name=v),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:k(()=>[l(n).form.name?(w(),C(i,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:e[0]||(e[0]=v=>l(n).form.name="")})):R("",!0)]),_:1},8,["modelValue"])]),_:1}),f(m,{label:"标识",name:"group_id",required:""},{default:k(()=>[f(r,{modelValue:l(n).form.group_id,"onUpdate:modelValue":e[3]||(e[3]=v=>l(n).form.group_id=v),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:k(()=>[l(n).form.group_id?(w(),C(i,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:e[2]||(e[2]=v=>l(n).form.group_id="")})):R("",!0)]),_:1},8,["modelValue"])]),_:1}),f(m,{label:"分配权限"},{default:k(()=>[f(a,{menu:_.menu},null,8,["menu"])]),_:1})]),_:1},8,["schema","state"])]),footer:k(()=>[f(i,{label:"取消",color:"neutral",variant:"outline",onClick:s}),f(i,{loading:l(n).loading,label:"确认",variant:"solid",onClick:e[4]||(e[4]=v=>l(c)?.submit())},null,8,["loading"])]),_:1},8,["open"])}}}),le=Object.assign(ae,{__name:"SystemRoleEdit"}),T={1:["warning","i-lucide-shield"],5:["info","i-lucide-user-cog"],99:["error","i-lucide-crown"]},se=[{accessorKey:"name",header:"角色名称",meta:{class:{th:"w-[200px]",td:"w-[200px]"}},cell:({row:_})=>{const{name:g,group_id:d}=_.original,[o,h]=T[d]||["neutral","i-lucide-user"];return y("div",{class:"flex items-center gap-3"},[y("div",{class:"w-10 h-10 rounded-lg bg-(--ui-bg-elevated) flex items-center justify-center"},[y("span",{class:`${h} w-5 h-5 text-(--ui-${o})`})]),y("span",{class:"font-medium text-(--ui-text-highlighted)"},g)])}},{accessorKey:"group_id",header:"角色标识",meta:{class:{th:"w-[120px]",td:"w-[120px]"}},cell:({row:_})=>y("code",{class:"px-2 py-1 rounded bg-(--ui-bg-elevated) text-xs font-mono text-(--ui-text-muted)"},`group_${_.original.group_id}`)},{accessorKey:"level",header:"权限等级",meta:{class:{th:"w-[120px]",td:"w-[120px]"}},cell:({row:_})=>{const{group_id:g}=_.original,d={1:"普通",5:"中级",99:"最高"},[o]=T[g]||["neutral"];return y(oe,{variant:"subtle",color:o},()=>d[g]||"未知")}}],We=$({name:"SystemRole",__name:"role",setup(_){const g=Q(),{hasPermission:d}=N(),o=E({isDialog:!1,currentForm:{},menu:[]}),h=async()=>({error:null,data:{list:[{id:1,name:"管理员",group_id:1},{id:2,name:"运营",group_id:5},{id:3,name:"超级管理员",group_id:99}]}}),s=t=>t.sort((e,i)=>(e.sort?Number(e.sort):0)-(i.sort?Number(i.sort):0)).map(e=>(e.children&&s(e.children),e)),c=(t,e,i=[])=>e.reduce((r,m)=>(t.includes(m.key)&&r.push(m.key),m.children?.length&&c(t,m.children,i),r),i),p=(t,e,i=null)=>{const r=[];t.forEach(a=>{let x;a.children&&a.children.length>0&&(x=p(a.children,e,a)),r.push({label:a.name,value:a.id,checked:x?x.checked:e.includes(a.id),children:x?x.children:void 0})});let m="indeterminate";if(i){let a=0;r.forEach(x=>{x.checked===!0&&a++}),a===r.length?m=!0:a===0&&(m=!1)}return{checked:m,children:r}},n=async t=>{o.isDialog=!0,o.currentForm={name:t.name,group_id:String(t.group_id)},o.menu=[];const e=await Promise.allSettled([ee(),te({group_id:t.group_id})]);if(e[0].status==="fulfilled"&&e[0].value.data&&e[1].status==="fulfilled"&&e[1].value.data){const i=s(j(e[0].value.data.list)),r=e[1].value.data.menus.map(a=>a.id),m=c(r,i);o.menu=p(i,m).children}},u=async()=>{g.value.reload(),o.isDialog=!1};function b(t){return[{label:"分配权限",icon:"material-symbols:edit-square-outline",disabled:!d("rbac-group-add"),onSelect(){n(t.original)}}]}const M=[...se,{id:"actions",cell:({row:t})=>y("div",{class:"text-right"},y(S,{content:{align:"end"},items:b(t)},()=>y(V,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(t,e)=>{const i=K,r=B,m=le;return w(),W(H,null,[f(r,null,{default:k(()=>[f(i,{ref_key:"tableRef",ref:g,"data-request":h,columns:M,"default-page-size":100},null,512)]),_:1}),f(m,{dialog:l(o).isDialog,"onUpdate:dialog":e[0]||(e[0]=a=>l(o).isDialog=a),"current-form":l(o).currentForm,menu:l(o).menu,onRefresh:u},null,8,["dialog","current-form","menu"])],64)}}});export{We as default};
