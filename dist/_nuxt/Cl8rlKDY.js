import{w as X,_ as Y,a as Z}from"./DiI9-bkE.js";import{_ as ae}from"./Bml5z8l2.js";import{_ as _e}from"./DxT_AjaP.js";import{_ as be}from"./CuFgEFCp.js";import{_ as se}from"./oJBVUttf.js";import{_ as ie}from"./BdKneTYw.js";import{_ as re}from"./BkseHKFx.js";import{_ as de}from"./_BOBmhmt.js";import{_ as xe}from"./CCHrFwgR.js";import{_ as ce}from"./8gEztUrL.js";import{i as ue,j as me,k as ve,l as ye}from"./DXr9T7Lu.js";import{p as ee,ai as pe,w as fe,z as y,A as h,W as E,a7 as e,i as W,u as n,a2 as m,Q as l,ah as q,a6 as C,R as P,c as Q,r as te,a5 as ge,j as he,ae as ne}from"./Cp_GvCOL.js";import{_ as ke}from"./DkYr1hfb.js";import{f as Ue}from"./CE7u-7DH.js";import{u as Ve}from"./BCMcqMGM.js";import{c as we}from"./B3KMLFeu.js";import"./CM1DIlR0.js";import"./BlLzDdHJ.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";import"./DZaB2s8a.js";import"./_eNQqsN0.js";import"./C3gvogBg.js";import"./B1GmTriL.js";import"./C-fFc4Sm.js";import"./7ga_NNx6.js";import"./BrwH2_O0.js";import"./D7PB4JkZ.js";import"./DnWsfCtc.js";import"./De6cJ90F.js";const $e={class:"flex items-center gap-2"},Ce={class:"font-semibold"},Se={class:"space-y-4"},Oe={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border)"},Re={class:"flex items-center gap-4"},Ne={class:"flex items-center justify-end gap-2"},De={class:"space-y-4"},je={class:"flex items-center justify-between mb-4"},Fe={class:"flex items-center gap-2"},Te={class:"w-7 h-7 rounded-full bg-orange-500/10 flex items-center justify-center"},Ae={class:"text-sm font-medium text-orange-500"},Ee={class:"font-medium"},Ie={class:"space-y-4"},ze={class:"grid grid-cols-4 gap-4"},Be={class:"space-y-2"},Me={class:"flex justify-end"},Je={class:"grid grid-cols-2 gap-3"},Pe={class:"flex items-center gap-2 p-3 rounded-lg border border-(--ui-border) cursor-pointer hover:bg-(--ui-bg)"},Ke={class:"flex items-center gap-2 p-3 rounded-lg border border-(--ui-border) cursor-pointer hover:bg-(--ui-bg)"},Le={class:"flex items-center gap-2 p-3 rounded-lg border border-(--ui-border) cursor-pointer hover:bg-(--ui-bg)"},We={class:"flex items-center gap-2 p-3 rounded-lg border border-(--ui-border) cursor-pointer hover:bg-(--ui-bg)"},qe={key:0,class:"p-12 text-center rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border)"},Qe=ee({__name:"RegexEdit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(I,{emit:B}){const v=I,N=B,$=Q({get:()=>v.dialog,set:p=>N("update:dialog",p)}),s=()=>{$.value=!1},f=X(),D=pe("fileInputRef"),j=()=>({_key:crypto.randomUUID(),id:crypto.randomUUID(),scriptName:"",findRegex:"",replaceString:"",trimStrings:[],placement:[2],disabled:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!1,substituteRegex:0,minDepth:null,maxDepth:null}),r=te({loading:!1,configName:"",configState:1,rules:[],fullscreenOpen:!1,fullscreenContent:"",fullscreenRuleKey:""}),F=Q({get:()=>r.configState===1,set:p=>{r.configState=p?1:9}}),T=()=>{r.rules.push(j())},o=p=>{r.rules=r.rules.filter(i=>i._key!==p)},U=p=>{r.fullscreenRuleKey=p._key,r.fullscreenContent=p.replaceString,r.fullscreenOpen=!0},O=()=>{const p=r.rules.find(i=>i._key===r.fullscreenRuleKey);p&&(p.replaceString=r.fullscreenContent),r.fullscreenOpen=!1},A=p=>{const i=p.target.files?.[0];if(!i)return;const k=new FileReader;k.onload=d=>{try{const _=JSON.parse(d.target?.result);if(!Array.isArray(_)){f.add({title:"无效的JSON格式，需要数组",color:"error"});return}const R=_.filter(b=>b&&typeof b=="object"&&typeof b.findRegex=="string"&&b.findRegex.trim());if(R.length===0){f.add({title:"未找到有效的正则条目",color:"error"});return}r.rules=R.map(b=>({...j(),...b,_key:crypto.randomUUID()})),f.add({title:`成功导入 ${R.length} 条规则`,color:"success"})}catch{f.add({title:"JSON解析失败，请检查文件格式",color:"error"})}},k.readAsText(i),p.target.value=""},M=()=>{const p=r.rules.map(({_key:_,...R})=>R),i=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),k=URL.createObjectURL(i),d=document.createElement("a");d.href=k,d.download=`${r.configName||"regex-config"}.json`,d.click(),URL.revokeObjectURL(k),f.add({title:"导出成功",color:"success"})};async function J(){if(!r.configName.trim()){f.add({title:"请输入配置名称",color:"error"});return}r.loading=!0;try{const p=r.rules.map(({_key:d,..._})=>_),i={id:v.currentForm?.id,name:r.configName,ty:1,state:r.configState,content:JSON.stringify(p)},{error:k}=await(i.id?ue:me)(i);k||(f.add({title:"保存成功",color:"success"}),s(),N("refresh"))}finally{r.loading=!1}}return fe(()=>v.dialog,p=>{if(p&&(r.loading=!1,r.configName=v.currentForm?.name||"",r.configState=v.currentForm?.state??1,r.rules=[],v.currentForm?.content))try{const i=JSON.parse(v.currentForm.content);Array.isArray(i)&&(r.rules=i.map(k=>({...j(),...k,_key:crypto.randomUUID()})))}catch{f.add({title:"数据解析失败，JSON格式损坏",color:"error"})}}),(p,i)=>{const k=Z,d=se,_=ie,R=re,b=Y,K=de,z=xe,L=ce;return y(),h(E,null,[e(L,{open:n($),"onUpdate:open":i[3]||(i[3]=t=>W($)?$.value=t:null),title:"正则配置",ui:{content:"sm:max-w-4xl",footer:"justify-end"}},{header:m(()=>[l("div",$e,[e(k,{name:"i-lucide-regex",class:"w-5 h-5 text-orange-500"}),l("span",Ce,C(I.currentForm.id?"编辑正则配置":"新建正则配置"),1)])]),body:m(()=>[l("div",Se,[l("div",Oe,[l("div",Re,[e(_,{label:"配置名称",required:"",class:"flex-1"},{default:m(()=>[e(d,{modelValue:n(r).configName,"onUpdate:modelValue":i[0]||(i[0]=t=>n(r).configName=t),modelModifiers:{trim:!0},placeholder:"输入正则配置名称",size:"lg"},null,8,["modelValue"])]),_:1}),e(_,{label:"状态"},{default:m(()=>[e(R,{modelValue:n(F),"onUpdate:modelValue":i[1]||(i[1]=t=>W(F)?F.value=t:null)},null,8,["modelValue"])]),_:1})])]),l("div",Ne,[l("input",{ref_key:"fileInputRef",ref:D,type:"file",accept:".json",class:"hidden",onChange:A},null,544),e(b,{variant:"outline",icon:"i-lucide-upload",label:"导入 JSON",onClick:i[2]||(i[2]=t=>n(D)?.click())}),e(b,{variant:"outline",icon:"i-lucide-download",label:"导出 JSON",onClick:M})]),l("div",De,[(y(!0),h(E,null,q(n(r).rules,(t,a)=>(y(),h("div",{key:t._key,class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border)"},[l("div",je,[l("div",Fe,[l("div",Te,[l("span",Ae,C(a+1),1)]),l("span",Ee,"规则 "+C(a+1),1)]),e(b,{icon:"i-lucide-trash-2",size:"xs",color:"error",variant:"ghost",onClick:c=>o(t._key)},null,8,["onClick"])]),l("div",Ie,[l("div",ze,[e(_,{label:"规则 ID"},{default:m(()=>[e(d,{modelValue:t.id,"onUpdate:modelValue":c=>t.id=c,placeholder:"default-rule-id",class:"font-mono"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{label:"脚本名称"},{default:m(()=>[e(d,{modelValue:t.scriptName,"onUpdate:modelValue":c=>t.scriptName=c,placeholder:"Script Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{label:"最小深度"},{default:m(()=>[e(d,{modelValue:t.minDepth,"onUpdate:modelValue":c=>t.minDepth=c,modelModifiers:{number:!0},type:"number",placeholder:"最小深度"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{label:"最大深度"},{default:m(()=>[e(d,{modelValue:t.maxDepth,"onUpdate:modelValue":c=>t.maxDepth=c,modelModifiers:{number:!0},type:"number",placeholder:"最大深度"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),e(_,{label:"查找正则",required:""},{default:m(()=>[e(d,{modelValue:t.findRegex,"onUpdate:modelValue":c=>t.findRegex=c,placeholder:"\\*([\\s\\S]*?)\\*",class:"font-mono"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{label:"替换内容",required:""},{default:m(()=>[l("div",Be,[l("div",Me,[e(b,{size:"xs",variant:"ghost",icon:"i-lucide-maximize-2",label:"全屏编辑",onClick:c=>U(t)},null,8,["onClick"])]),e(K,{modelValue:t.replaceString,"onUpdate:modelValue":c=>t.replaceString=c,placeholder:'^^^<span class="highlight">$1</span>^^^',rows:8,class:"font-mono w-full"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024),l("div",Je,[l("label",Pe,[e(z,{modelValue:t.disabled,"onUpdate:modelValue":c=>t.disabled=c},null,8,["modelValue","onUpdate:modelValue"]),i[7]||(i[7]=l("span",{class:"text-sm"},"禁用规则",-1))]),l("label",Ke,[e(z,{modelValue:t.markdownOnly,"onUpdate:modelValue":c=>t.markdownOnly=c},null,8,["modelValue","onUpdate:modelValue"]),i[8]||(i[8]=l("span",{class:"text-sm"},"仅 Markdown",-1))]),l("label",Le,[e(z,{modelValue:t.promptOnly,"onUpdate:modelValue":c=>t.promptOnly=c},null,8,["modelValue","onUpdate:modelValue"]),i[9]||(i[9]=l("span",{class:"text-sm"},"仅 Prompt",-1))]),l("label",We,[e(z,{modelValue:t.runOnEdit,"onUpdate:modelValue":c=>t.runOnEdit=c},null,8,["modelValue","onUpdate:modelValue"]),i[10]||(i[10]=l("span",{class:"text-sm"},"编辑时运行",-1))])])])]))),128)),n(r).rules.length===0?(y(),h("div",qe,[e(k,{name:"i-lucide-regex",class:"w-10 h-10 mx-auto mb-2 text-(--ui-text-dimmed)"}),i[11]||(i[11]=l("p",{class:"text-sm text-(--ui-text-muted)"}," 暂无规则，点击下方按钮添加 ",-1))])):P("",!0),e(b,{variant:"outline",block:"",icon:"i-lucide-plus",label:"添加规则",onClick:T})])])]),footer:m(()=>[e(b,{label:"取消",color:"neutral",variant:"outline",onClick:s}),e(b,{loading:n(r).loading,label:"保存",onClick:J},null,8,["loading"])]),_:1},8,["open"]),e(L,{open:n(r).fullscreenOpen,"onUpdate:open":i[6]||(i[6]=t=>n(r).fullscreenOpen=t),title:"编辑替换内容",ui:{content:"sm:max-w-4xl",footer:"justify-end"}},{body:m(()=>[e(K,{modelValue:n(r).fullscreenContent,"onUpdate:modelValue":i[4]||(i[4]=t=>n(r).fullscreenContent=t),rows:20,class:"font-mono w-full"},null,8,["modelValue"])]),footer:m(()=>[e(b,{label:"取消",color:"neutral",variant:"outline",onClick:i[5]||(i[5]=t=>n(r).fullscreenOpen=!1)}),e(b,{label:"确定",onClick:O})]),_:1},8,["open"])],64)}}}),Ge=Object.assign(Qe,{__name:"AmusementParameterRegexEdit"}),He={class:"flex items-center gap-2"},Xe={class:"font-semibold"},Ye={class:"space-y-4"},Ze={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border)"},et={class:"flex items-center gap-4"},tt={class:"flex items-center justify-end gap-2"},ot={class:"space-y-4"},lt={class:"flex items-center gap-3 p-4"},nt={class:"font-medium"},at={key:0,class:"px-4 pb-4 space-y-4"},st={class:"space-y-2"},it={class:"flex justify-end"},rt={class:"grid grid-cols-4 gap-4"},dt={key:0,class:"p-12 text-center rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border)"},ct=ee({__name:"WorldBookEdit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(I,{emit:B}){const v=I,N=B,$=Q({get:()=>v.dialog,set:t=>N("update:dialog",t)}),s=()=>{$.value=!1},f=X(),D=pe("fileInputRef"),j=[{label:"角色定义前",value:"before_char"},{label:"角色定义后",value:"after_char"},{label:"示例消息前",value:"before_example"},{label:"示例消息后",value:"after_example"},{label:"作者注释前",value:"before_author"},{label:"作者注释后",value:"after_author"}],r=[{label:"始终触发",value:"always"},{label:"关键词触发",value:"keyword"}],F=[{label:"默认 (Null)",value:"null"},{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],T=t=>({_key:crypto.randomUUID(),id:t,keys:[],secondary_keys:[],comment:"",content:"",constant:!1,selective:!0,insertion_order:0,enabled:!0,position:"after_char",use_regex:!1,extensions:{position:4,probability:100,depth:1,scan_depth:null,role:0}}),o=te({loading:!1,configName:"",configState:1,entries:[],expandedKeys:[],fullscreenOpen:!1,fullscreenContent:""}),U=Q({get:()=>o.configState===2,set:t=>{o.configState=t?2:4}}),O=t=>o.expandedKeys.includes(t),A=t=>{const a=o.expandedKeys.indexOf(t);a>-1?o.expandedKeys.splice(a,1):o.expandedKeys.push(t)},M=()=>{const t=o.entries.length>0?Math.max(...o.entries.map(c=>c.id))+1:0,a=T(t);o.entries.push(a),o.expandedKeys.push(a._key)},J=t=>{o.entries=o.entries.filter(a=>a._key!==t),o.expandedKeys=o.expandedKeys.filter(a=>a!==t)},p=t=>{const a=t.target.files?.[0];if(!a)return;const c=new FileReader;c.onload=V=>{try{const g=JSON.parse(V.target?.result);let S=[];if(g.entries&&typeof g.entries=="object"&&!Array.isArray(g.entries))S=Object.values(g.entries);else if(Array.isArray(g.entries))S=g.entries;else if(Array.isArray(g))S=g;else{f.add({title:"无效的世界书格式",color:"error"});return}o.entries=S.map((w,G)=>({...T(G),...w,_key:crypto.randomUUID()})),f.add({title:`成功导入 ${S.length} 条世界书条目`,color:"success"})}catch{f.add({title:"JSON解析失败，请检查文件格式",color:"error"})}},c.readAsText(a),t.target.value=""},i=()=>{const t=o.entries.map(({_key:g,...S})=>S),a=new Blob([JSON.stringify({entries:t},null,2)],{type:"application/json"}),c=URL.createObjectURL(a),V=document.createElement("a");V.href=c,V.download=`${o.configName||"worldbook"}.json`,V.click(),URL.revokeObjectURL(c),f.add({title:"导出成功",color:"success"})},k=t=>t.constant?"always":"keyword",d=(t,a)=>{t.constant=a==="always"},_=t=>t.extensions.scan_depth===null?"null":String(t.extensions.scan_depth),R=(t,a)=>{t.extensions.scan_depth=a==="null"?null:parseInt(a)},b=t=>{o.fullscreenOpen=!0,o.fullscreenContent=t.content},K=()=>{o.fullscreenOpen=!1},z=()=>{o.fullscreenOpen=!1};async function L(){if(!o.configName.trim()){f.add({title:"请输入配置名称",color:"error"});return}o.loading=!0;try{const t=o.entries.map(({_key:V,...g})=>g),a={id:v.currentForm?.id,name:o.configName,ty:2,state:o.configState,content:JSON.stringify(t)},{error:c}=await(a.id?ue:me)(a);c||(f.add({title:"保存成功",color:"success"}),s(),N("refresh"))}finally{o.loading=!1}}return fe(()=>v.dialog,t=>{if(t&&(o.loading=!1,o.configName=v.currentForm?.name||"",o.configState=v.currentForm?.state??1,o.entries=[],o.expandedKeys=[],o.fullscreenOpen=!1,v.currentForm?.content))try{const a=JSON.parse(v.currentForm.content);Array.isArray(a)&&(o.entries=a.map((c,V)=>({...T(V),...c,_key:crypto.randomUUID()})))}catch{}}),(t,a)=>{const c=Z,V=se,g=ie,S=re,w=Y,G=ae,H=ke,oe=de,le=ce;return y(),h(E,null,[e(le,{open:n($),"onUpdate:open":a[3]||(a[3]=u=>W($)?$.value=u:null),title:"世界书",ui:{content:"sm:max-w-4xl",footer:"justify-end"}},{header:m(()=>[l("div",He,[e(c,{name:"i-lucide-globe",class:"w-5 h-5 text-purple-500"}),l("span",Xe,C(I.currentForm.id?"编辑世界书":"新建世界书"),1)])]),body:m(()=>[l("div",Ye,[l("div",Ze,[l("div",et,[e(g,{label:"世界书名称",required:"",class:"flex-1"},{default:m(()=>[e(V,{modelValue:n(o).configName,"onUpdate:modelValue":a[0]||(a[0]=u=>n(o).configName=u),modelModifiers:{trim:!0},placeholder:"输入世界书名称",size:"lg"},null,8,["modelValue"])]),_:1}),e(g,{label:"状态"},{default:m(()=>[e(S,{modelValue:n(U),"onUpdate:modelValue":a[1]||(a[1]=u=>W(U)?U.value=u:null)},null,8,["modelValue"])]),_:1})])]),l("div",tt,[l("input",{ref_key:"fileInputRef",ref:D,type:"file",accept:".json",class:"hidden",onChange:p},null,544),e(w,{variant:"outline",icon:"i-lucide-upload",label:"导入 JSON",onClick:a[2]||(a[2]=u=>n(D)?.click())}),e(w,{variant:"outline",icon:"i-lucide-download",label:"导出 JSON",onClick:i})]),l("div",ot,[(y(!0),h(E,null,q(n(o).entries,u=>(y(),h("div",{key:u._key,class:"rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) border-l-4 border-l-purple-500"},[l("div",lt,[e(S,{modelValue:u.enabled,"onUpdate:modelValue":x=>u.enabled=x},null,8,["modelValue","onUpdate:modelValue"]),e(w,{icon:O(u._key)?"i-lucide-chevron-up":"i-lucide-chevron-down",size:"xs",color:"neutral",variant:"ghost",onClick:x=>A(u._key)},null,8,["icon","onClick"]),l("span",nt,C(u.comment||"未命名条目"),1),e(G,{color:u.constant?"info":"success",variant:"subtle",size:"xs"},{default:m(()=>[ge(C(u.constant?"始终":"选择性"),1)]),_:2},1032,["color"]),a[6]||(a[6]=l("div",{class:"flex-1"},null,-1)),e(w,{icon:"i-lucide-trash-2",size:"xs",color:"error",variant:"ghost",onClick:x=>J(u._key)},null,8,["onClick"])]),O(u._key)?(y(),h("div",at,[e(g,{label:"标题 (注释)"},{default:m(()=>[e(V,{modelValue:u.comment,"onUpdate:modelValue":x=>u.comment=x,placeholder:"输入条目标题"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{label:"触发模式"},{default:m(()=>[e(H,{"model-value":k(u),items:r,"onUpdate:modelValue":x=>d(u,x)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),e(g,{label:"内容"},{default:m(()=>[l("div",st,[l("div",it,[e(w,{size:"xs",variant:"ghost",icon:"i-lucide-maximize-2",label:"全屏编辑",onClick:x=>b(u)},null,8,["onClick"])]),e(oe,{modelValue:u.content,"onUpdate:modelValue":x=>u.content=x,placeholder:"输入条目内容",rows:6,class:"font-mono w-full"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024),l("div",rt,[e(g,{label:"插入位置"},{default:m(()=>[e(H,{modelValue:u.position,"onUpdate:modelValue":x=>u.position=x,items:j},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{label:"插入顺序"},{default:m(()=>[e(V,{modelValue:u.insertion_order,"onUpdate:modelValue":x=>u.insertion_order=x,modelModifiers:{number:!0},type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{label:"激活概率 (%)"},{default:m(()=>[e(V,{modelValue:u.extensions.probability,"onUpdate:modelValue":x=>u.extensions.probability=x,modelModifiers:{number:!0},type:"number",min:0,max:100},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{label:"扫描深度"},{default:m(()=>[e(H,{"model-value":_(u),items:F,"onUpdate:modelValue":x=>R(u,x)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)])])):P("",!0)]))),128)),n(o).entries.length===0?(y(),h("div",dt,[e(c,{name:"i-lucide-globe",class:"w-10 h-10 mx-auto mb-2 text-(--ui-text-dimmed)"}),a[7]||(a[7]=l("p",{class:"text-sm text-(--ui-text-muted)"}," 暂无条目，点击下方按钮添加 ",-1))])):P("",!0),e(w,{variant:"outline",block:"",icon:"i-lucide-plus",label:"添加条目",onClick:M})])])]),footer:m(()=>[e(w,{label:"取消",color:"neutral",variant:"outline",onClick:s}),e(w,{loading:n(o).loading,label:"保存",onClick:L},null,8,["loading"])]),_:1},8,["open"]),e(le,{open:n(o).fullscreenOpen,"onUpdate:open":a[5]||(a[5]=u=>n(o).fullscreenOpen=u),ui:{content:"sm:max-w-4xl"}},{header:m(()=>[...a[8]||(a[8]=[l("span",{class:"font-semibold"},"内容编辑",-1)])]),body:m(()=>[e(oe,{modelValue:n(o).fullscreenContent,"onUpdate:modelValue":a[4]||(a[4]=u=>n(o).fullscreenContent=u),class:"font-mono w-full",rows:20},null,8,["modelValue"])]),footer:m(()=>[e(w,{label:"取消",color:"neutral",variant:"outline",onClick:K}),e(w,{label:"保存",onClick:z})]),_:1},8,["open"])],64)}}}),ut=Object.assign(ct,{__name:"AmusementParameterWorldBookEdit"}),mt={class:"mb-6"},pt={class:"flex gap-2"},ft={key:0,class:"flex items-center justify-center py-20"},gt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},_t={class:"flex items-center justify-between mb-3"},bt={class:"flex items-center gap-2"},xt={class:"font-medium"},vt={class:"text-xs text-(--ui-text-muted)"},yt={class:"text-xs text-(--ui-text-muted) mb-3"},ht={class:"flex items-center gap-2 pt-3 border-t border-(--ui-border)"},kt={key:2,class:"flex justify-center mt-6"},Ut={key:3,class:"text-center py-20 text-(--ui-text-muted)"},lo=ee({name:"AmusementParameterList",__name:"parameter",setup(I){const B=Ve(),v=X(),N={2:["启用","success"],0:["未启用","warning"],4:["删除","error"]},$=[{label:"正则规则",value:1,icon:"i-lucide-regex"},{label:"世界书",value:2,icon:"i-lucide-globe"}],s=te({loading:!1,list:[],activeTab:1,isRegexDialog:!1,isWorldBookDialog:!1,currentForm:{},page:1,pageSize:12,total:0}),f=async()=>{s.loading=!0;try{const{data:o}=await ve({ty:s.activeTab,page:s.page,pagesize:s.pageSize});s.list=o?.list||[],s.total=o?.count||0}finally{s.loading=!1}},D=o=>{s.currentForm=o?we(o):{state:1,ty:s.activeTab},(o?.ty??s.activeTab)===1?s.isRegexDialog=!0:s.isWorldBookDialog=!0},j=async o=>{B.open({color:"error",title:"删除配置",description:`确定要删除「${o.name}」吗？`,onPositiveClick:async()=>{const{error:U}=await ye({id:o.id});U||(v.add({title:"删除成功",color:"success"}),f())}})},r=()=>{s.isRegexDialog=!1,s.isWorldBookDialog=!1,f()},F=o=>{s.activeTab=o,s.page=1,f()},T=o=>{s.page=o,f()};return he(()=>f()),(o,U)=>{const O=Y,A=Z,M=ae,J=_e,p=be,i=Ge,k=ut;return y(),h(E,null,[e(p,null,{actions:m(()=>[e(O,{label:"新增",icon:"i-lucide-plus",onClick:U[0]||(U[0]=d=>D())})]),default:m(()=>[l("div",mt,[l("div",pt,[(y(),h(E,null,q($,d=>e(O,{key:d.value,icon:d.icon,label:d.label,color:n(s).activeTab===d.value?"primary":"neutral",variant:n(s).activeTab===d.value?"solid":"outline",onClick:_=>F(d.value)},null,8,["icon","label","color","variant","onClick"])),64))])]),n(s).loading?(y(),h("div",ft,[e(A,{name:"i-lucide-loader",class:"w-8 h-8 animate-spin text-(--ui-text-muted)"})])):(y(),h("div",gt,[(y(!0),h(E,null,q(n(s).list,d=>(y(),h("div",{key:d.id,class:"p-4 rounded-xl bg-(--ui-bg-elevated) border border-(--ui-border) hover:border-(--ui-primary) transition-all"},[l("div",_t,[l("div",bt,[l("div",{class:ne(["w-8 h-8 rounded-lg flex items-center justify-center",n(s).activeTab===1?"bg-orange-500/10":"bg-purple-500/10"])},[e(A,{name:n(s).activeTab===1?"i-lucide-regex":"i-lucide-globe",class:ne(["w-4 h-4",n(s).activeTab===1?"text-orange-500":"text-purple-500"])},null,8,["name","class"])],2),l("div",null,[l("div",xt,C(d.name),1),l("div",vt," ID: "+C(d.id),1)])]),e(M,{color:N[d.state]?.[1]||"neutral",variant:"subtle",size:"xs"},{default:m(()=>[ge(C(N[d.state]?.[0]||"未知"),1)]),_:2},1032,["color"])]),l("div",yt," 更新于 "+C(("formatToDateTime"in o?o.formatToDateTime:n(Ue))(d.updated_at)),1),l("div",ht,[e(O,{size:"xs",color:"neutral",variant:"ghost",icon:"i-lucide-pencil",label:"编辑",onClick:_=>D(d)},null,8,["onClick"]),e(O,{size:"xs",color:"error",variant:"ghost",icon:"i-lucide-trash-2",label:"删除",onClick:_=>j(d)},null,8,["onClick"])])]))),128))])),n(s).total>n(s).pageSize?(y(),h("div",kt,[e(J,{page:n(s).page,"items-per-page":n(s).pageSize,total:n(s).total,"onUpdate:page":T},null,8,["page","items-per-page","total"])])):P("",!0),!n(s).loading&&n(s).list.length===0?(y(),h("div",Ut,[e(A,{name:n(s).activeTab===1?"i-lucide-regex":"i-lucide-globe",class:"w-12 h-12 mx-auto mb-2 opacity-50"},null,8,["name"]),l("p",null,"暂无"+C(n(s).activeTab===1?"正则规则":"世界书")+"配置",1)])):P("",!0)]),_:1}),e(i,{dialog:n(s).isRegexDialog,"onUpdate:dialog":U[1]||(U[1]=d=>n(s).isRegexDialog=d),"current-form":n(s).currentForm,onRefresh:r},null,8,["dialog","current-form"]),e(k,{dialog:n(s).isWorldBookDialog,"onUpdate:dialog":U[2]||(U[2]=d=>n(s).isWorldBookDialog=d),"current-form":n(s).currentForm,onRefresh:r},null,8,["dialog","current-form"])],64)}}});export{lo as default};
