import{_ as j}from"./1OJ4jHSB.js";import{q as K,w as N,_ as $,x as q,a as G,y as J,z as Q,N as W,O as H,J as X,Q as Y,R as Z}from"./DiI9-bkE.js";import{_ as ee}from"./Odvr87Pg.js";import{_ as te}from"./CuFgEFCp.js";import{_ as ae}from"./oJBVUttf.js";import{_ as oe}from"./BdKneTYw.js";import{_ as se}from"./DkYr1hfb.js";import{_ as le}from"./9B_i7pfW.js";import{_ as re}from"./8gEztUrL.js";import{c as z}from"./B3KMLFeu.js";import{p as B,ai as ie,w as ne,z as y,a1 as R,a2 as m,a7 as o,u as t,Q as _,R as me,ae as ce,a6 as de,i as ue,c as pe,h as E,r as A,E as s,aq as fe,A as P,ar as ge,W as _e}from"./Cp_GvCOL.js";import{o as xe,n as S,s as I,l as be}from"./CgOwER5m.js";import{_ as T}from"./Bml5z8l2.js";import{f as ve}from"./CE7u-7DH.js";import{u as he}from"./BCMcqMGM.js";import"./D7PB4JkZ.js";import"./C-fFc4Sm.js";import"./DnWsfCtc.js";import"./C6Y-ieo6.js";import"./De6cJ90F.js";import"./BrwH2_O0.js";import"./7ga_NNx6.js";import"./BHtpJmxp.js";import"./BlLzDdHJ.js";import"./CM1DIlR0.js";import"./K6pfE6CB.js";import"./B9BvCEkO.js";import"./DxT_AjaP.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";import"./DZaB2s8a.js";const we={class:"flex items-center gap-2"},ye={class:"font-semibold"},Fe={class:"flex items-center gap-4 p-4 rounded-lg bg-(--ui-bg) border border-(--ui-border)"},Ue={class:"flex-1"},ke={class:"grid grid-cols-2 gap-4"},Ve=B({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(r,{emit:l}){const f=r,x=l,c=pe({get(){return f.dialog},set(i){x("update:dialog",i)}}),u=()=>{c.value=!1},b=ie("formRef"),v=E(),h=K(),F=xe({username:I().nonempty(),password:I().min(8,"不能少于 8 个字符").optional().or(be("")),group_id:S(),state:S()}),e=A({loading:!1,avatarLoading:!1,form:{},groupOptions:[{label:"运营",value:5},{label:"管理员",value:1},{label:"超级管理员",value:99}],stateOptions:[{label:"正常",value:2},{label:"禁用",value:1}]});async function n(i){const a=i.target;if(a.files?.length&&J(a.files[0])){e.avatarLoading=!0;const{data:p}=await Q({image:a.files[0]});p&&(e.form.avatar=p.uri),e.avatarLoading=!1}}function g(){v.value?.click()}const U=N();async function k(){e.loading=!0;const i=z(e.form);i.id=f.currentForm.id,!i.id&&!i.password&&(i.password="12345677");const{error:a}=await(i.id?W:H)(i);a||(U.add({title:"操作成功",color:"success"}),x("refresh")),e.loading=!1}return ne(()=>f.dialog,i=>{i&&(e.loading=!1,e.form=f.currentForm)}),(i,a)=>{const p=G,L=q,V=$,C=ae,w=oe,D=se,M=le,O=re;return y(),R(O,{open:t(c),"onUpdate:open":a[5]||(a[5]=d=>ue(c)?c.value=d:null),ui:{footer:"justify-end",content:"sm:max-w-lg"}},{header:m(()=>[_("div",we,[o(p,{name:"i-lucide-user-cog",class:"w-5 h-5 text-(--ui-primary)"}),_("span",ye,de(r.currentForm.id?"修改用户":"新增用户"),1)])]),body:m(()=>[o(M,{ref_key:"formRef",ref:b,schema:t(F),state:t(e).form,class:"flex flex-col gap-4",onSubmit:k},{default:m(()=>[_("div",Fe,[o(L,{src:t(e).form.avatar,alt:t(e).form.username,size:"xl"},null,8,["src","alt"]),_("div",Ue,[a[6]||(a[6]=_("p",{class:"text-sm font-medium text-(--ui-text-highlighted) mb-1"}," 用户头像 ",-1)),a[7]||(a[7]=_("p",{class:"text-xs text-(--ui-text-muted) mb-2"}," 支持 JPG、PNG 格式，最大 1MB ",-1)),o(V,{loading:t(e).avatarLoading,label:"上传头像",color:"neutral",size:"xs",onClick:g},null,8,["loading"]),_("input",{ref_key:"fileRef",ref:v,type:"file",class:"hidden",accept:".jpg, .jpeg, .png",onChange:n},null,544)])]),o(w,{label:"用户名",name:"username",required:""},{default:m(()=>[o(C,{modelValue:t(e).form.username,"onUpdate:modelValue":a[0]||(a[0]=d=>t(e).form.username=d),modelModifiers:{trim:!0},disabled:!!r.currentForm.id,placeholder:"请输入用户名",class:"w-full"},{leading:m(()=>[o(p,{name:"i-lucide-user",class:"w-4 h-4 text-(--ui-text-muted)"})]),_:1},8,["modelValue","disabled"])]),_:1}),o(w,{label:"密码",name:"password",help:r.currentForm.id?"不填则不修改密码":"默认密码：12345677"},{default:m(()=>[o(C,{modelValue:t(e).form.password,"onUpdate:modelValue":a[1]||(a[1]=d=>t(e).form.password=d),modelModifiers:{trim:!0},type:"password",placeholder:"请输入密码（至少8位）",class:"w-full"},{leading:m(()=>[o(p,{name:"i-lucide-lock",class:"w-4 h-4 text-(--ui-text-muted)"})]),_:1},8,["modelValue"])]),_:1},8,["help"]),_("div",ke,[t(h).userInfo.group_id==99?(y(),R(w,{key:0,label:"角色",name:"group_id",required:""},{default:m(()=>[o(D,{modelValue:t(e).form.group_id,"onUpdate:modelValue":a[2]||(a[2]=d=>t(e).form.group_id=d),items:t(e).groupOptions,placeholder:"请选择",class:"w-full"},null,8,["modelValue","items"])]),_:1})):me("",!0),o(w,{label:"状态",name:"state",required:"",class:ce(t(h).userInfo.group_id!=99?"col-span-2":"")},{default:m(()=>[o(D,{modelValue:t(e).form.state,"onUpdate:modelValue":a[3]||(a[3]=d=>t(e).form.state=d),items:t(e).stateOptions,placeholder:"请选择",class:"w-full"},null,8,["modelValue","items"])]),_:1},8,["class"])])]),_:1},8,["schema","state"])]),footer:m(()=>[o(V,{label:"取消",color:"neutral",variant:"outline",onClick:u}),o(V,{loading:t(e).loading,label:"确认",variant:"solid",onClick:a[4]||(a[4]=d=>t(b)?.submit())},null,8,["loading"])]),_:1},8,["open"])}}}),$e=Object.assign(Ve,{__name:"SystemUserEdit"}),Ce={1:["管理员","warning"],5:["运营","info"],99:["超级管理员","error"]},De={1:["禁用","error"],2:["正常","success"],4:["已删除","neutral"]},Re=[{accessorKey:"username",header:"用户信息",searchPlaceholder:"筛选账号",meta:{class:{th:"w-[200px]",td:"w-[200px]"}},cell:({row:r})=>{const{username:l,avatar:f,id:x,email:c}=r.original;return s("div",{class:"flex items-center gap-3"},[s(q,{src:f,alt:l,size:"lg",class:"shrink-0"}),s("div",{class:"flex flex-col min-w-0"},[s("span",{class:"font-medium text-(--ui-text-highlighted) truncate"},l),s("span",{class:"text-xs text-(--ui-text-muted)"},`ID: ${x}`),c&&s("span",{class:"text-xs text-(--ui-text-dimmed) truncate"},c)])])}},{accessorKey:"created_at",header:"注册时间",meta:{class:{th:"w-[160px]",td:"w-[160px]"}},cell:({row:r})=>s("div",{class:"flex items-center gap-2"},[s("span",{class:"i-lucide-calendar w-4 h-4 text-(--ui-text-muted)"}),s("span",{class:"text-sm"},ve(r.original.created_at))])},{accessorKey:"last_ip",header:"登录IP",meta:{class:{th:"w-[150px]",td:"w-[150px]"}},cell:({row:r})=>{const l=r.original.last_ip||r.original.ip;return l?s("div",{class:"flex items-center gap-2"},[s("span",{class:"i-lucide-globe w-4 h-4 text-(--ui-text-muted)"}),s("code",{class:"text-xs font-mono bg-(--ui-bg-elevated) px-2 py-1 rounded"},l)]):s("span",{class:"text-(--ui-text-muted)"},"-")}},{accessorKey:"group_id",header:"角色",searchPlaceholder:"筛选角色",meta:{class:{th:"w-[120px]",td:"w-[120px]"}},formItemProps:{component:"Select",componentProps:{options:[{label:"管理员",value:1},{label:"运营",value:5},{label:"超级管理员",value:99}]}},cell:({row:r})=>{const l=Ce[r.original.group_id];return s(T,{class:"capitalize",variant:"subtle",color:l?.[1]||"neutral"},()=>l?.[0]||"未知")}},{accessorKey:"state",header:"状态",searchPlaceholder:"筛选状态",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},formItemProps:{component:"Select",componentProps:{options:[{label:"正常",value:2},{label:"禁用",value:1},{label:"已删除",value:4}]}},cell:({row:r})=>{const l=De[r.original.state];return s(T,{class:"capitalize",variant:"subtle",color:l?.[1]||"neutral"},()=>l?.[0]||"未知")}}],dt=B({name:"SystemUser",__name:"user",setup(r){const l=E(),f=$,x=he(),{hasPermission:c}=X(),u=A({isDialog:!1,currentForm:{}}),b=async n=>{u.isDialog=!0,n?u.currentForm=z(n):u.currentForm={group_id:5,state:2}},v=async()=>{l.value.reload(),u.isDialog=!1},h=async n=>{const{error:g}=await Z({id:n.id});g||l.value.reload()};function F(n){return[{label:"编辑",icon:"material-symbols:edit-square-outline",disabled:!c("admin-edit"),onSelect(){b(n.original)}},{type:"separator"},{label:"删除",icon:"material-symbols:contract-delete-outline-rounded",color:"error",disabled:!c("admin-remove"),onSelect(){x.open({color:"error",title:"删除数据",description:"您确定要删除吗？",onPositiveClick(){h(n.original)}})}}]}const e=[...Re,{id:"actions",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:n})=>s("div",{class:"text-right"},s(j,{content:{align:"end"},items:F(n)},()=>s($,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(n,g)=>{const U=ee,k=te,i=$e,a=fe("permission");return y(),P(_e,null,[o(k,null,{actions:m(()=>[ge((y(),P("div",null,[o(t(f),{label:"新增",icon:"i-lucide-plus",color:"neutral",onClick:g[0]||(g[0]=p=>b(null))})])),[[a,"admin-add"]])]),default:m(()=>[o(U,{ref_key:"tableRef",ref:l,"data-request":t(Y),columns:e,"scroll-x":"min-w-[1200px]"},null,8,["data-request"])]),_:1}),o(i,{dialog:t(u).isDialog,"onUpdate:dialog":g[1]||(g[1]=p=>t(u).isDialog=p),"current-form":t(u).currentForm,onRefresh:v},null,8,["dialog","current-form"])],64)}}});export{dt as default};
