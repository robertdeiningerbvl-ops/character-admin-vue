import{_ as L}from"./CEcF5dWm.js";import{f as z,c as E,ap as I,j as R,aE as K,l as S,a as j,o as D,w as m,B as s,_ as k,b as o,a4 as q,aF as g,i as N,ay as P,k as M,A,C as G,D as H,G as J}from"./DhOLkSnF.js";import{_ as Q,a as W,b as X,c as Y}from"./DAqc9GYg.js";import{_ as Z}from"./CSbqei5V.js";import{_ as ee}from"./D0vBe5Vh.js";import{_ as oe}from"./DAeRr84W.js";import{_ as te}from"./DAIKkUkW.js";import{_ as ae}from"./Db__RPjw.js";import{_ as se}from"./BZLiX_8y.js";import{e as ne,C as le,D as re,E as ie,F as me}from"./D1QVHQma.js";import{c as B}from"./45RcOEEf.js";import{o as de,n as v}from"./B-mCBPct.js";import{u as ce,b as ue}from"./Bo5OMT4U.js";import{_ as pe}from"./-rcGzxkB.js";import{f as fe}from"./BmKy9gZZ.js";import{u as _e}from"./BVQSm7Ip.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./CLKxJTZi.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";import"./HRiyi1uV.js";const be=z({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})},bizId:{}},emits:["update:dialog","refresh"],setup(c,{emit:F}){const u=c,f=F,p=E({get(){return u.dialog},set(i){f("update:dialog",i)}}),x=()=>{p.value=!1},r=I("formRef"),_=de({battery:v().min(0),max_token:v().min(0),biz_id:v().min(0),state:v().min(0)}),h=[{label:"启用",value:2},{label:"关闭",value:4}],e=R({loading:!1,avatarLoading:!1,presetOptions:[],modelLoading:!1,form:{}}),b=async(i=!1)=>{i&&(e.presetOptions=[]),e.modelLoading=!0,r.value?.clear("preset_id");const{data:t,error:a}=await ne({});if(t){const n=[];t.list.forEach(d=>{n.push({label:d.name,value:d.id})}),e.presetOptions=n}else a&&(e.form.mark=void 0,a.code===400?r.value?.setErrors([{name:"preset_id",message:a.msg}]):a.code===401?r.value?.setErrors([{name:"type",message:a.msg}]):r.value?.setErrors([{name:"mark",message:a.msg}]));e.modelLoading=!1},C=K();async function w(){e.loading=!0;const i=B(e.form);console.log("postForm",i);const{error:t}=await(i.id?le:re)(i);t||(C.add({title:"操作成功",color:"success"}),f("refresh")),e.loading=!1}return S(()=>u.dialog,i=>{i&&(e.loading=!1,e.form=u.currentForm,!e.form.id&&u.bizId&&(e.form.biz_id=Number(u.bizId)),b())}),(i,t)=>{const a=ee,n=oe,d=te,V=ae,y=k,U=se;return D(),j(U,{open:o(p),"onUpdate:open":t[7]||(t[7]=l=>q(p)?p.value=l:null),title:c.currentForm.id?"修改":"新增",dismissible:!1,ui:{footer:"justify-end"}},{body:m(()=>[s(V,{ref_key:"formRef",ref:r,schema:o(_),state:o(e).form,class:"flex flex-col gap-4",onSubmit:w},{default:m(()=>[s(n,{label:"关联模型",name:"biz_id",required:""},{default:m(()=>[s(a,{modelValue:o(e).form.biz_id,"onUpdate:modelValue":t[0]||(t[0]=l=>o(e).form.biz_id=l),items:o(e).presetOptions,placeholder:"请选择",class:"w-full",onChange:t[1]||(t[1]=l=>b(!0))},null,8,["modelValue","items"])]),_:1}),s(n,{label:"最大token数",name:"max_token",required:""},{default:m(()=>[s(d,{modelValue:o(e).form.max_token,"onUpdate:modelValue":t[2]||(t[2]=l=>o(e).form.max_token=l),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"},type:"number",min:"0"},null,8,["modelValue"])]),_:1}),s(n,{label:"说明",name:"description"},{default:m(()=>[s(d,{modelValue:o(e).form.description,"onUpdate:modelValue":t[3]||(t[3]=l=>o(e).form.description=l),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},null,8,["modelValue"])]),_:1}),s(n,{label:"每次消耗",name:"battery"},{default:m(()=>[s(d,{modelValue:o(e).form.battery,"onUpdate:modelValue":t[4]||(t[4]=l=>o(e).form.battery=l),modelModifiers:{trim:!0},placeholder:"请输入",type:"number",class:"w-full",ui:{trailing:"pe-1"}},null,8,["modelValue"])]),_:1}),s(n,{label:"状态",name:"state",required:""},{default:m(()=>[s(a,{modelValue:o(e).form.state,"onUpdate:modelValue":t[5]||(t[5]=l=>o(e).form.state=l),items:h,placeholder:"请选择",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["schema","state"])]),footer:m(()=>[s(y,{label:"取消",color:"neutral",variant:"outline",onClick:x}),s(y,{loading:o(e).loading,label:"确认",variant:"solid",onClick:t[6]||(t[6]=l=>o(r)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),ge=Object.assign(be,{__name:"CommonModelTokenEdit"}),T={2:["启用","success"],4:["关闭","error"]},ye=[{accessorKey:"id",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},header:()=>g(k,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"})},{accessorKey:"biz_id",header:"关联模型"},{accessorKey:"max_token",header:"最大token数"},{accessorKey:"battery",header:"每次消耗"},{accessorKey:"description",header:"说明"},{accessorKey:"state",meta:{class:{th:"w-[100px]",td:"w-[80px]"}},header:"状态",formItemProps:{component:"Select",componentProps:{options:[{label:"启动",value:2},{label:"关闭",value:4}]}},cell:({row:c})=>g(pe,{class:"capitalize",variant:"subtle",color:T[c.original.state]?.[1]},()=>T[c.original.state]?.[0])},{accessorKey:"updated_at",header:"更新时间",cell:({row:c})=>fe(c.original.updated_at)}],ve={key:0,class:"absolute top-0 left-0 right-0 h-(--ui-header-height) flex items-center justify-between border-b border-(--ui-border) px-4 sm:px-6 bg-(--ui-bg)"},ke={class:"flex items-center gap-4"},Ae=z({name:"CommonModelTokenList",__name:"[id]",setup(c){const u=ce(ue).smaller("lg"),f=N(),p=k,x=_e(),r=R({isDialog:!1,currentForm:{},factoryOwnerOptions:[]}),_=async a=>{r.isDialog=!0,a?r.currentForm=B(a):r.currentForm={state:2}},h=async()=>{f.value.reload(),r.isDialog=!1},e=P(),b=E(()=>e.params.id),C=a=>ie({...a,biz_id:b.value});function w(a){return[{label:"编辑",icon:"material-symbols:edit-square-outline",onSelect(){_(a.original)}},{label:"删除",icon:"material-symbols:contract-delete-outline-rounded",color:"error",onSelect(){x.open({color:"error",title:"删除数据",description:"您确定要删除吗？",onPositiveClick(){i(a.original)}})}},{type:"separator"}]}const i=async a=>{const{error:n}=await me({id:a.id});n||f.value.reload()},t=[...ye,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:a})=>g("div",{class:"text-right"},g(L,{content:{align:"end"},items:w(a)},()=>g(k,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(a,n)=>{const d=W,V=Q,y=X,U=Z,l=Y,O=ge;return D(),M(J,null,[s(l,{ui:{body:"pb-[12px]! gap-0!"}},A({body:m(()=>[o(u)?G("",!0):(D(),M("div",ve,[H("div",ke,[s(d),s(y)]),s(o(p),{label:"新增",icon:"i-lucide-plus",onClick:n[1]||(n[1]=$=>_(null))})])),s(U,{ref_key:"tableRef",ref:f,"data-request":C,columns:t,"scroll-x":"min-w-[1800px]"},null,512)]),_:2},[o(u)?{name:"header",fn:m(()=>[s(V,{title:"模型token列表"},{leading:m(()=>[s(d)]),right:m(()=>[s(o(p),{label:"新增",icon:"i-lucide-plus",onClick:n[0]||(n[0]=$=>_(null))})]),_:1})]),key:"0"}:void 0]),1024),s(O,{dialog:o(r).isDialog,"onUpdate:dialog":n[2]||(n[2]=$=>o(r).isDialog=$),"current-form":o(r).currentForm,"biz-id":o(b),onRefresh:h},null,8,["dialog","current-form","biz-id"])],64)}}});export{Ae as default};
