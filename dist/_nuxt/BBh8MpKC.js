import{_ as L}from"./CEcF5dWm.js";import{f as E,c as A,ap as J,i as S,j as K,aE as W,l as H,a as Q,o as U,w as n,B as t,_ as F,b as a,D as d,k as R,I as X,n as Y,F as Z,a4 as ee,aU as oe,aF as m,G as ae}from"./DhOLkSnF.js";import{b as te,_ as le,a as re,c as se}from"./DAqc9GYg.js";import{_ as ne}from"./CSbqei5V.js";import{_ as ie}from"./DAIKkUkW.js";import{_ as ce}from"./DAeRr84W.js";import{_ as me}from"./CVanS2c1.js";import{_ as de}from"./D0vBe5Vh.js";import{_ as ue}from"./Db__RPjw.js";import{_ as pe}from"./BZLiX_8y.js";import{q as fe,s as ge,t as _e,v as be}from"./D1QVHQma.js";import{c as z}from"./45RcOEEf.js";import{o as ye,n as B,s as P}from"./B-mCBPct.js";import{_ as T}from"./-rcGzxkB.js";import{f as ve}from"./BmKy9gZZ.js";import{u as he}from"./BVQSm7Ip.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./Bo5OMT4U.js";import"./CLKxJTZi.js";import"./HRiyi1uV.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";const xe={class:"w-full"},we={class:"flex flex-col items-center gap-2"},ke={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Ce={key:1,class:"relative group"},Ue={class:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},Fe=["src"],De={class:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2 rounded-lg"},$e=E({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(l,{emit:u}){const g=l,b=u,r=A({get(){return g.dialog},set(i){b("update:dialog",i)}}),y=()=>{r.value=!1},v=J("formRef"),h=S(),D=ye({title:P().nonempty("标题不能为空"),content:P().nonempty("内容不能为空"),ty:B().min(2,"类型不能为空"),state:B().min(2,"状态不能为空")}),$=[{label:"启用",value:2},{label:"禁用",value:4}],s=[{label:"系统",value:2},{label:"公告",value:3},{label:"营销",value:4}],e=K({loading:!1,uploading:!1,form:{}}),p=W();function x(){h.value?.click()}const V=async i=>{const o=i.target,_=o.files?.[0];if(!o.files?.length||!_)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(_.type)){p.add({title:"请上传图片文件（jpg、png、gif、webp）",color:"error"});return}if(_.size>5*1024*1024){p.add({title:"图片大小不能超过 5MB",color:"error"});return}e.uploading=!0;try{const{data:w,error:k}=await oe({image:o.files[0]});!k&&w?(e.form.image=w.uri,p.add({title:"上传成功",color:"success"})):p.add({title:"上传失败",color:"error"})}catch{p.add({title:"上传失败",color:"error"})}finally{e.uploading=!1,o.value=""}},M=()=>{e.form.image=""};async function j(){e.loading=!0;const i=z(e.form),{error:o}=await(i.id?fe:ge)(i);o||(p.add({title:"操作成功",color:"success"}),b("refresh")),e.loading=!1}return H(()=>g.dialog,i=>{i&&(e.loading=!1,e.uploading=!1,e.form=g.currentForm)}),(i,o)=>{const _=ie,f=ce,w=me,k=de,G=X,C=F,N=ue,O=pe;return U(),Q(O,{open:a(r),"onUpdate:open":o[5]||(o[5]=c=>ee(r)?r.value=c:null),title:l.currentForm.id?"修改消息":"新增消息",dismissible:!1,ui:{footer:"justify-end"}},{body:n(()=>[t(N,{ref_key:"formRef",ref:v,schema:a(D),state:a(e).form,class:"flex flex-col gap-4",onSubmit:j},{default:n(()=>[t(f,{label:"标题",name:"title",required:""},{default:n(()=>[t(_,{modelValue:a(e).form.title,"onUpdate:modelValue":o[0]||(o[0]=c=>a(e).form.title=c),modelModifiers:{trim:!0},placeholder:"请输入标题",class:"w-full"},null,8,["modelValue"])]),_:1}),t(f,{label:"内容",name:"content",required:""},{default:n(()=>[t(w,{modelValue:a(e).form.content,"onUpdate:modelValue":o[1]||(o[1]=c=>a(e).form.content=c),modelModifiers:{trim:!0},placeholder:"请输入消息内容",rows:4,class:"w-full"},null,8,["modelValue"])]),_:1}),t(f,{label:"类型",name:"ty",required:""},{default:n(()=>[t(k,{modelValue:a(e).form.ty,"onUpdate:modelValue":o[2]||(o[2]=c=>a(e).form.ty=c),items:s,placeholder:"请选择类型",class:"w-full"},null,8,["modelValue"])]),_:1}),t(f,{label:"状态",name:"state",required:""},{default:n(()=>[t(k,{modelValue:a(e).form.state,"onUpdate:modelValue":o[3]||(o[3]=c=>a(e).form.state=c),items:$,placeholder:"请选择状态",class:"w-full"},null,8,["modelValue"])]),_:1}),t(f,{label:"宣传图",name:"image"},{default:n(()=>[d("div",xe,[a(e).form.image?(U(),R("div",Ce,[d("div",Ue,[d("img",{src:a(e).form.image,alt:"宣传图",class:"w-full h-48 object-cover"},null,8,Fe)]),d("div",De,[t(C,{icon:"i-lucide-refresh-cw",color:"neutral",variant:"solid",label:"更换",onClick:x}),t(C,{icon:"i-lucide-trash-2",color:"error",variant:"solid",label:"删除",onClick:M})])])):(U(),R("div",{key:0,class:"border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-6 text-center cursor-pointer hover:border-primary-500 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-all",onClick:x},[d("div",we,[t(G,{name:a(e).uploading?"i-lucide-loader":"i-lucide-image-plus",class:Y(["w-10 h-10 text-gray-400",{"animate-spin":a(e).uploading}])},null,8,["name","class"]),d("div",null,[d("p",ke,Z(a(e).uploading?"上传中...":"点击上传宣传图"),1),o[6]||(o[6]=d("p",{class:"text-xs text-gray-500 mt-1"}," 支持 JPG、PNG、GIF、WebP，最大 5MB ",-1))])])])),d("input",{ref_key:"fileRef",ref:h,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",class:"hidden",onChange:V},null,544)])]),_:1})]),_:1},8,["schema","state"])]),footer:n(()=>[t(C,{label:"取消",color:"neutral",variant:"outline",onClick:y}),t(C,{loading:a(e).loading,label:"确认",variant:"solid",onClick:o[4]||(o[4]=c=>a(v)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),Ve=Object.assign($e,{__name:"CommonMessageEdit"}),I={2:["启用","success"],4:["禁用","error"]},q={1:["互动消息","secondary"],2:["系统消息","primary"],3:["公告","info"],4:["营销","neutral"]},Me=[{accessorKey:"id",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},header:()=>m(F,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"})},{accessorKey:"title",searchPlaceholder:"筛选标题",header:"标题"},{accessorKey:"image",header:"宣传图",meta:{class:{th:"w-[120px]",td:"w-[120px]"}},cell:({row:l})=>l.original.image?m("div",{class:"flex items-center"},[m("img",{src:l.original.image,alt:"宣传图",class:"w-16 h-16 object-cover rounded-lg border border-gray-200 dark:border-gray-700"})]):m("span",{class:"text-gray-400 text-sm"},"无图片")},{accessorKey:"content",header:"内容",cell:({row:l})=>{const u=l.original.content||"";return m("div",{class:"truncate max-w-[300px]",title:u},u)}},{accessorKey:"ty",searchPlaceholder:"筛选类型",header:"类型",formItemProps:{component:"Select",componentProps:{options:[{label:"互动消息",value:1},{label:"系统",value:2},{label:"公告",value:3},{label:"营销",value:4}]}},cell:({row:l})=>m(T,{class:"capitalize",variant:"subtle",color:q[l.original.ty]?.[1]},()=>q[l.original.ty]?.[0])},{accessorKey:"state",header:"状态",formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:2},{label:"禁用",value:4}]}},cell:({row:l})=>m(T,{class:"capitalize",variant:"subtle",color:I[l.original.state]?.[1]},()=>I[l.original.state]?.[0])},{accessorKey:"updated_at",header:"更新时间",cell:({row:l})=>ve(l.original.updated_at)}],ao=E({name:"MessageList",__name:"message",setup(l){const u=S(),g=F,b=he(),r=K({isDialog:!1,currentForm:{}}),y=async s=>{r.isDialog=!0,s?r.currentForm=z(s):r.currentForm={state:2,ty:2,image:""}},v=async()=>{u.value.reload(),r.isDialog=!1},h=async s=>{const{error:e}=await be({id:s.id});e||u.value.reload()};function D(s){return[{label:"编辑",icon:"material-symbols:edit-square-outline",onSelect(){y(s.original)}},{type:"separator"},{label:"删除",icon:"material-symbols:contract-delete-outline-rounded",color:"error",onSelect(){b.open({color:"error",title:"删除数据",description:"您确定要删除这条消息吗？",onPositiveClick(){h(s.original)}})}}]}const $=[...Me,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:s})=>m("div",{class:"text-right"},m(L,{content:{align:"end"},items:D(s)},()=>m(F,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(s,e)=>{const p=re,x=le,V=te,M=ne,j=se,i=Ve;return U(),R(ae,null,[t(j,{ui:{body:"pb-[12px]! gap-0!"}},{header:n(()=>[t(x,{title:"消息列表"},{leading:n(()=>[t(p)]),right:n(()=>[t(a(g),{label:"新增",icon:"i-lucide-plus",onClick:e[0]||(e[0]=o=>y(null))})]),_:1})]),body:n(()=>[t(V,{class:"mb-4"}),t(M,{ref_key:"tableRef",ref:u,"data-request":a(_e),columns:$,"scroll-x":"min-w-[800px]"},null,8,["data-request"])]),_:1}),t(i,{dialog:a(r).isDialog,"onUpdate:dialog":e[1]||(e[1]=o=>a(r).isDialog=o),"current-form":a(r).currentForm,onRefresh:v},null,8,["dialog","current-form"])],64)}}});export{ao as default};
