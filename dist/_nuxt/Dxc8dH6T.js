import{_ as T}from"./CEcF5dWm.js";import{f as $,c as K,ap as j,aE as q,j as C,l as z,a as S,o as R,w as n,D as r,B as t,E as I,I as N,_ as U,b as s,F as P,a4 as Y,aF as d,J as H,i as L,k as O,G as A}from"./DhOLkSnF.js";import{b as G,_ as J,a as Q,c as W}from"./DAqc9GYg.js";import{_ as X}from"./CSbqei5V.js";import{_ as Z}from"./DAIKkUkW.js";import{_ as ee}from"./DAeRr84W.js";import{_ as te}from"./CVanS2c1.js";import{_ as ae}from"./D0vBe5Vh.js";import{_ as oe}from"./Db__RPjw.js";import{_ as se}from"./BZLiX_8y.js";import{k as re,l as le,m as ne}from"./D1QVHQma.js";import{c as F}from"./45RcOEEf.js";import{o as ie,n as me,s as V}from"./B-mCBPct.js";import{_ as de}from"./-rcGzxkB.js";import{u as ce}from"./BVQSm7Ip.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./Bo5OMT4U.js";import"./CLKxJTZi.js";import"./HRiyi1uV.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";const pe={class:"max-h-[75vh] overflow-y-auto p-6"},ue={class:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-xl p-5 border border-blue-100 dark:border-blue-700"},fe={class:"flex items-center gap-3"},_e={class:"p-3 bg-white dark:bg-gray-700 rounded-lg shadow-sm"},ge={class:"font-semibold text-gray-900 dark:text-gray-100"},be={class:"bg-white dark:bg-gray-800/50 rounded-xl border border-gray-200 dark:border-gray-600 p-6 space-y-5"},ye={class:"flex items-center gap-2 pb-3 border-b border-gray-200 dark:border-gray-600"},xe={class:"bg-white dark:bg-gray-800/50 rounded-xl border border-gray-200 dark:border-gray-600 p-6 space-y-5"},we={class:"flex items-center gap-2 pb-3 border-b border-gray-200 dark:border-gray-600"},he={class:"flex items-center justify-between w-full"},ve={class:"text-sm text-gray-500 dark:text-gray-400"},ke={class:"flex gap-3"},Fe=$({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(l,{emit:o}){const p=l,i=o,_=K({get(){return p.dialog},set(u){i("update:dialog",u)}}),b=()=>{_.value=!1},y=j("formRef"),w=q(),h=[{label:"待处理",value:0},{label:"已回复",value:1},{label:"已关闭",value:2}],m=ie({title:V().nonempty("标题不能为空"),content:V().nonempty("内容不能为空"),state:me().min(0)}),a=C({loading:!1,form:{id:0,username:"",title:"",content:"",reply:"",state:0}});async function v(){a.loading=!0;const u=F(a.form),{error:e}=await re(u);e||(w.add({title:"操作成功",color:"success"}),i("refresh"),b()),a.loading=!1}return z(()=>p.dialog,u=>{u&&p.currentForm&&(a.form=F(p.currentForm))}),(u,e)=>{const f=N,k=Z,g=ee,x=te,B=ae,E=oe,D=U,M=se;return R(),S(M,{open:s(_),"onUpdate:open":e[5]||(e[5]=c=>Y(_)?_.value=c:null),title:"回复反馈",description:"编辑反馈信息并回复用户",dismissible:!1,ui:{content:"sm:max-w-3xl",body:"p-0",footer:"justify-end bg-gray-50 dark:bg-gray-900"}},{body:n(()=>[r("div",pe,[t(E,{ref_key:"formRef",ref:y,schema:s(m),state:s(a).form,class:"flex flex-col gap-5",onSubmit:v},{default:n(()=>[r("div",ue,[r("div",fe,[r("div",_e,[t(f,{name:"i-material-symbols-person-outline",class:"w-6 h-6 text-blue-600 dark:text-blue-400"})]),r("div",null,[e[6]||(e[6]=r("p",{class:"text-sm text-gray-600 dark:text-gray-300"}," 反馈用户 ",-1)),r("p",ge,P(s(a).form.username||"未知用户"),1)])])]),r("div",be,[r("div",ye,[t(f,{name:"i-material-symbols-info-outline",class:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e[7]||(e[7]=r("h4",{class:"font-semibold text-gray-900 dark:text-gray-100"}," 基本信息 ",-1))]),t(g,{label:"标题",name:"title",required:"",class:"w-full"},{default:n(()=>[t(k,{modelValue:s(a).form.title,"onUpdate:modelValue":e[0]||(e[0]=c=>s(a).form.title=c),modelModifiers:{trim:!0},placeholder:"请输入标题",size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),t(g,{label:"反馈内容",name:"content",required:"",class:"w-full"},{default:n(()=>[t(x,{modelValue:s(a).form.content,"onUpdate:modelValue":e[1]||(e[1]=c=>s(a).form.content=c),modelModifiers:{trim:!0},placeholder:"用户反馈的内容",rows:4,size:"lg",class:"w-full",disabled:""},null,8,["modelValue"])]),_:1})]),r("div",xe,[r("div",we,[t(f,{name:"i-material-symbols-reply",class:"w-5 h-5 text-green-600 dark:text-green-400"}),e[8]||(e[8]=r("h4",{class:"font-semibold text-gray-900 dark:text-gray-100"}," 回复内容 ",-1))]),t(g,{label:"回复",name:"reply",class:"w-full"},{default:n(()=>[t(x,{modelValue:s(a).form.reply,"onUpdate:modelValue":e[2]||(e[2]=c=>s(a).form.reply=c),modelModifiers:{trim:!0},placeholder:"请输入回复内容",rows:5,size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),t(g,{label:"状态",name:"state",required:"",class:"w-full"},{default:n(()=>[t(B,{modelValue:s(a).form.state,"onUpdate:modelValue":e[3]||(e[3]=c=>s(a).form.state=c),items:h,placeholder:"请选择状态",size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1})])]),_:1},8,["schema","state"])])]),footer:n(()=>[r("div",he,[r("div",ve,[t(f,{name:"i-material-symbols-info-outline",class:"inline w-4 h-4"}),e[9]||(e[9]=I(" 修改后将更新反馈信息 ",-1))]),r("div",ke,[t(D,{label:"取消",color:"neutral",variant:"outline",size:"lg",onClick:b},{leading:n(()=>[t(f,{name:"i-material-symbols-close"})]),_:1}),t(D,{loading:s(a).loading,label:"确认保存",variant:"solid",size:"lg",onClick:e[4]||(e[4]=c=>s(y)?.submit())},{leading:n(()=>[t(f,{name:"i-material-symbols-check"})]),_:1},8,["loading"])])])]),_:1},8,["open"])}}}),Ue=Object.assign(Fe,{__name:"FeedEdit"}),De={0:["待处理","warning"],1:["已回复","success"],2:["已关闭","info"]},Ve=[{accessorKey:"id",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},header:()=>d(U,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"})},{accessorKey:"username",header:"用户名",searchPlaceholder:"请输入用户名",meta:{class:{th:"w-[120px]",td:"w-[120px]"}},cell:({row:l})=>{const o=l.original.username||"-";return d("div",{class:"font-medium"},o)}},{accessorKey:"title",header:"标题",searchPlaceholder:"请输入标题",meta:{class:{th:"min-w-[180px]",td:"min-w-[180px]"}},cell:({row:l})=>{const o=l.original.title||"-";return d("div",{class:"font-medium text-gray-900 dark:text-white"},o)}},{accessorKey:"content",header:"内容",meta:{class:{th:"min-w-[200px]",td:"min-w-[200px]"}},cell:({row:l})=>{const o=l.original.content||"-";return d("div",{class:"text-sm text-gray-600 dark:text-gray-400 truncate max-w-[250px]",title:o},o)}},{accessorKey:"reply",header:"回复",meta:{class:{th:"min-w-[200px]",td:"min-w-[200px]"}},cell:({row:l})=>{const o=l.original.reply;return o?d("div",{class:"text-sm text-gray-600 dark:text-gray-400 truncate max-w-[250px]",title:o},o):d("span",{class:"text-xs text-gray-400 dark:text-gray-500"},"未回复")}},{accessorKey:"state",header:"状态",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:l})=>{const o=l.original.state,[p,i]=De[o]||["未知","info"];return d(de,{color:i,variant:"subtle",label:p})}},{accessorKey:"created_at",header:"创建时间",meta:{class:{th:"w-[160px]",td:"w-[160px]"}},cell:({row:l})=>d("span",{class:"text-sm text-gray-600 dark:text-gray-400"},H(l.original.created_at).format("YYYY-MM-DD HH:mm"))}],Xe=$({name:"FeedList",__name:"feeds",setup(l){const o=L(),p=ce(),i=C({isDialog:!1,currentForm:{}}),_=async m=>{i.isDialog=!0,i.currentForm=F(m)},b=async()=>{o.value.reload(),i.isDialog=!1},y=async m=>{const{error:a}=await ne({id:m.id});a||o.value.reload()};function w(m){return[{label:"回复",icon:"material-symbols:edit-square-outline",onSelect(){_(m.original)}},{type:"separator"},{label:"删除",icon:"material-symbols:contract-delete-outline-rounded",color:"error",onSelect(){p.open({color:"error",title:"删除反馈",description:"您确定要删除这条反馈吗？",onPositiveClick(){y(m.original)}})}}]}const h=[...Ve,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:m})=>d("div",{class:"text-right"},d(T,{items:w(m)},{default:()=>d(U,{color:"neutral",variant:"ghost",icon:"lucide:more-vertical"})}))}];return(m,a)=>{const v=Q,u=J,e=G,f=X,k=W,g=Ue;return R(),O(A,null,[t(k,{ui:{body:"pb-[12px]! gap-0!"}},{header:n(()=>[t(u,{title:"反馈管理"},{leading:n(()=>[t(v)]),_:1})]),body:n(()=>[t(e,{class:"mb-4"}),t(f,{ref_key:"tableRef",ref:o,"data-request":s(le),columns:h,"scroll-x":"min-w-[800px]"},null,8,["data-request"])]),_:1}),t(g,{dialog:s(i).isDialog,"onUpdate:dialog":a[0]||(a[0]=x=>s(i).isDialog=x),"current-form":s(i).currentForm,onRefresh:b},null,8,["dialog","current-form"])],64)}}});export{Xe as default};
