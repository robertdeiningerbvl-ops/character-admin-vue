import{q as Re,w as ke,a as we,_ as Ve,x as Fe,y as Te,z as Ie,m as De}from"./DiI9-bkE.js";import{_ as Ue}from"./oJBVUttf.js";import{_ as Le}from"./xC7ZNHnZ.js";import{_ as Me}from"./DWJKBe83.js";import{_ as $e}from"./1OJ4jHSB.js";import{_ as Ee}from"./Bml5z8l2.js";import{_ as Je}from"./Baq49nZQ.js";import{_ as Be}from"./DxT_AjaP.js";import{_ as qe}from"./DwJuNt-9.js";import{_ as Ce}from"./BdKneTYw.js";import{_ as Ge}from"./_BOBmhmt.js";import{_ as Ke}from"./DkYr1hfb.js";import{_ as Ye}from"./9B_i7pfW.js";import{_ as We}from"./CCHrFwgR.js";import{_ as He}from"./BkseHKFx.js";import{_ as ze}from"./8gEztUrL.js";import{g as Qe,u as Z,a as Xe,b as Ze,r as et,c as tt,d as at}from"./DXr9T7Lu.js";import{c as ot}from"./B3KMLFeu.js";import{p as Se,ai as lt,w as ye,z as p,a1 as J,a2 as m,Q as e,a7 as t,a5 as $,a6 as _,u as l,A as f,W as D,ah as G,ae as te,R as h,i as _e,c as ee,h as X,r as Oe,J as st,an as be,a8 as rt}from"./Cp_GvCOL.js";import{o as nt,s as he,n as ve}from"./CgOwER5m.js";import{g as it}from"./adOTzFDE.js";import{u as dt}from"./BCMcqMGM.js";import"./CM1DIlR0.js";import"./BlLzDdHJ.js";import"./C-fFc4Sm.js";import"./D7PB4JkZ.js";import"./DZaB2s8a.js";import"./7ga_NNx6.js";import"./_eNQqsN0.js";import"./B9BvCEkO.js";import"./DnWsfCtc.js";import"./C6Y-ieo6.js";import"./De6cJ90F.js";import"./BrwH2_O0.js";import"./BHtpJmxp.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";import"./C3gvogBg.js";import"./B1GmTriL.js";function mt(y){const A=atob(y),u=new Uint8Array(A.length);for(let o=0;o<A.length;o++)u[o]=A.charCodeAt(o);return u}function ct(y){return new Promise((A,u)=>{const o=new FileReader;o.onload=()=>A(o.result),o.onerror=()=>u(new Error("读取文件失败")),o.readAsArrayBuffer(y)})}const ut=async y=>{const A=await ct(y),u=new Uint8Array(A),o=[137,80,78,71,13,10,26,10];for(let N=0;N<8;N++)if(u[N]!==o[N])throw new Error("不是有效的 PNG 文件");const j="chara",S=new TextDecoder("utf-8");let k=8;for(;k+12<=u.length;){const N=(u[k]<<24|u[k+1]<<16|u[k+2]<<8|u[k+3])>>>0,w=String.fromCharCode(u[k+4],u[k+5],u[k+6],u[k+7]),T=k+8,B=T+N,Y=B+4;if(B>u.length)break;if(w==="tEXt"){const L=u.slice(T,B);let I=0;for(;I<L.length&&L[I]!==0;)I++;if(S.decode(L.slice(0,I))===j){const W=S.decode(L.slice(I+1));try{const K=mt(W),r=new TextDecoder("utf-8").decode(K);return{charData:JSON.parse(r)}}catch(K){throw new Error(`不支持该角色卡导入：${K.message}`)}}}k=Y}throw new Error("该图片不是角色卡")};function pt(y,A){if(!y||typeof y!="object")throw new Error("角色卡数据错误");const u=y.data||{},o=Array.isArray(y.tags)&&y.tags.length?y.tags:Array.isArray(u.tags)?u.tags:[],j=Array.isArray(y.alternate_greetings)&&y.alternate_greetings.length?y.alternate_greetings:Array.isArray(u.alternate_greetings)?u.alternate_greetings:[],S={id:`char_${Date.now()}`,fav:!1,spec:y.spec,spec_version:y.spec_version,name:y.name||u.name,anohana:{image:A,avatar:A},data:{name:y.name||u.name,description:y.description||u.description||"",personality:y.personality||u.personality||"",scenario:y.scenario||u.scenario||"",mes_example:y.mes_example||u.mes_example||"",creator_notes:y.creator_notes||u.creator_notes||"",system_prompt:y.system_prompt||u.system_prompt||"",post_history_instructions:y.post_history_instructions||u.post_history_instructions||"",creator:y.creator||u.creator||"",character_version:y.character_version||u.character_version||"",alternate_greetings:j,first_mes:y.first_mes||u.first_mes||"",tags:o,character_book:{},regex:[],regex_enabled:!1}};if(y.data&&typeof y.data=="object"&&(S.data={...u,character_book:u.character_book||{},regex:Array.isArray(u.regex)?u.regex:[],regex_enabled:!!u.regex_enabled,tags:Array.isArray(u.tags)?u.tags:o},S.tags=S.data.tags||o),u?.extensions?.regex_scripts&&(S.data.regex=u.extensions.regex_scripts,S.data.regex_enabled=!0),u?.character_book){const k={...u.character_book};console.log(k),Array.isArray(k.entries)&&(k.entries=k.entries.map(N=>{const w=N?.position;let T;return w===0||w==="0"?T="before_char":typeof w=="string"?T=w:T="after_char",{...N,position:T}})),S.data.character_book=k}return S}const gt={class:"border-b-2 border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-gray-900 px-6"},ft={class:"flex gap-2"},bt=["onClick"],yt={class:"p-6"},xt={key:0,class:"flex items-center justify-center py-20"},_t={class:"text-center"},ht={key:1,class:"max-h-[60vh] overflow-y-auto pr-2"},vt={key:0,class:"space-y-4"},kt={class:"bg-gradient-to-br from-primary-50 to-blue-50 dark:from-primary-900/20 dark:to-blue-900/20 rounded-lg p-6 border border-primary-100 dark:border-primary-800"},wt={class:"flex items-start gap-4"},Vt={class:"p-3 bg-white dark:bg-gray-800 rounded-lg shadow-sm"},Ut={class:"flex-1"},$t={key:1},Ct={class:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-5 space-y-5"},zt={class:"flex items-center gap-2 mb-1"},St={class:"grid grid-cols-3 gap-4"},Ot={class:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-5"},At={class:"flex items-center gap-2 mb-4"},jt={class:"flex items-center gap-4"},Nt={class:"relative group"},Pt={key:0,class:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-full flex items-center justify-center"},Rt={class:"flex-1"},Ft={key:0,class:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-5"},Tt={key:0,class:"flex items-center gap-2 text-red-600 dark:text-red-400 text-sm mt-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg"},It={key:2,class:"space-y-4"},Dt={class:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-5 border border-blue-100 dark:border-blue-800 mb-6"},Lt={class:"flex items-start gap-3"},Mt={class:"flex flex-col items-center justify-center min-w-[60px] pt-2"},Et={class:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center"},Jt={class:"font-bold text-primary-600 dark:text-primary-400"},Bt={class:"pt-4"},qt={key:3,class:"space-y-5"},Gt={class:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-5 border border-purple-100 dark:border-purple-800"},Kt={class:"flex items-start gap-3 mb-4"},Yt={class:"space-y-4"},Wt={class:"flex items-center justify-between mb-4"},Ht={class:"flex items-center gap-2"},Qt={class:"w-7 h-7 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center"},Xt={class:"font-semibold text-purple-600 dark:text-purple-400 text-sm"},Zt={class:"font-medium text-gray-900 dark:text-white"},ea={class:"space-y-5"},ta={class:"space-y-2"},aa={class:"grid grid-cols-3 gap-4"},oa={class:"grid grid-cols-2 gap-4"},la={class:"grid grid-cols-2 gap-4"},sa={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},ra={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},na={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},ia={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},da={class:"pt-4"},ma={key:4,class:"space-y-6"},ca={class:"bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-lg p-5 border border-orange-100 dark:border-orange-800"},ua={class:"flex items-start gap-3"},pa={class:"flex-1"},ga={class:"flex items-center gap-3 mt-4"},fa={class:"text-gray-700 dark:text-gray-300 font-medium"},ba={key:0,class:"space-y-4"},ya={class:"flex items-center justify-between mb-4"},xa={class:"flex items-center gap-2"},_a={class:"w-7 h-7 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center"},ha={class:"font-semibold text-orange-600 dark:text-orange-400 text-sm"},va={class:"font-medium text-gray-900 dark:text-white"},ka={class:"space-y-5"},wa={class:"grid grid-cols-2 gap-3"},Va={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Ua={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},$a={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Ca={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},za={class:"grid grid-cols-2 gap-3"},Sa={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Oa={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Aa={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},ja={class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Na={key:1,class:"pt-4"},Pa={key:5,class:"space-y-4"},Ra={class:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 space-y-3"},Fa={class:"flex items-center gap-2 mb-1"},Ta={class:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Ia={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Da={class:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},La={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Ma={class:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},Ea={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Ja={class:"flex items-center justify-between w-full"},Ba={class:"text-sm text-gray-500 dark:text-gray-400"},qa={class:"flex gap-3"},Ga=Se({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})},tagsOptions:{}},emits:["update:dialog","refresh","tags-options"],setup(y,{emit:A}){const u=Re(),o=ee(()=>u.userInfo?.group_id===99),j=y,S=A,k=ee({get(){return j.dialog},set(d){S("update:dialog",d)}}),N=()=>{k.value=!1},w=X("card"),T=ee(()=>{const d=[["info","基础信息"],["dialogue","对话"],["world","世界书"],["regex","正则"],["status","状态管理"]];return j.currentForm?.id||d.unshift(["card","角色卡"]),d}),B=lt("formRef"),Y=X(),L=X(),I=X(),ae=[{label:"原创",value:0},{label:"转载",value:1}],W=[{label:"隐私",value:2},{label:"公开",value:0}],K=[{label:"角色定义前",value:"0-0"},{label:"角色定义后",value:"1-0"},{label:"角色定义后-1",value:"2-0"},{label:"角色定义后-2",value:"3-0"},{label:"智能插入",value:"4-0"},{label:"智能插入-User",value:"4-1"},{label:"智能插入-AI",value:"4-2"},{label:"智能插入-System",value:"4-3"}],r=Oe({loading:!1,avatarLoading:!1,form:{tag:[],name:"",avatar:"",summary:"",description:"",first_mes:"",scenario:"",mes_example:"",personality:"",system_prompt:"",character_version:"",source_url:"",guide:"",character_book:{name:"",entries:[]},regex_enabled:!1,regex_rules:[],opening_lines:[]}}),oe=nt({anonymous:ve(),source:ve(),image:he().nonempty(),source_url:he().optional()}).refine(d=>!(d.source===1&&!d.source_url),{message:"转载时必须填写来源地址",path:["source_url"]}),v=ke();function M(d={}){return{opening_lines:[],character_book:{name:"",entries:[]},regex_enabled:!1,regex_rules:[],...d}}function de(){r.form.character_book.entries.push({keys:[""],secondary_keys:[],content:"",enabled:!0,constant:!1,selective:!1,use_regex:!1,insertion_order:0,priority:0,extensions:{depth:4,position:0,role:0,probability:100,scan_depth:null}})}function me(d){r.form.character_book.entries.splice(Number(d),1)}function ce(d){d.keys||(d.keys=[]),d.keys.push("")}function b(d,a){d.keys?.splice(Number(a),1)}function s(d){if(!d.extensions)return"0-0";const a=d.extensions.position||0,c=d.extensions.role||0;return`${a}-${c}`}function x(d,a){if(d.extensions||(d.extensions={}),a){const[c,U]=a.split("-").map(Number);d.extensions.position=c,d.extensions.role=U}}function C(d,a){d.placement||(d.placement=[]);const c=d.placement.indexOf(a);c>-1?d.placement.splice(c,1):d.placement.push(a)}function O(d,a){return d.placement&&d.placement.includes(a)}function ue(){r.form.regex_rules.push({id:String(r.form.regex_rules.length),scriptName:"",findRegex:"",replaceString:"",trimStrings:[],placement:[],disabled:!1,markdownOnly:!1,promptOnly:!1,runOnEdit:!1,substituteRegex:0,minDepth:null,maxDepth:null})}function P(d){r.form.regex_rules.splice(Number(d),1)}async function H(d,a){if(!r.form.id){v.add({title:"请先保存角色卡",color:"warning"});return}r.form[d]=a;const{error:c}=await Z({id:r.form.id,[d]:a});c?(v.add({title:"更新失败",color:"error"}),d==="state"?r.form[d]=a===2?4:2:r.form[d]=a?0:1):(v.add({title:"更新成功",color:"success"}),S("refresh"))}async function le(d){const a=d.target;if(a.files?.length&&Te(a.files[0])){r.avatarLoading=!0;const{data:c}=await Ie({image:a.files[0]});c&&(r.form.image=c.uri),r.avatarLoading=!1}}function E(){Y.value?.click()}async function pe(d){const a=d.target.files?.[0];if(a)try{r.avatarLoading=!0;const{charData:c}=await ut(a),U=pt(c,a);if(!U){v.add({title:"导入失败：无效的角色卡数据",color:"error"});return}Object.assign(r.form,U),w.value="info",v.add({title:"导入成功",color:"success"})}catch(c){console.error("导入 PNG 角色卡失败:",c),v.add({title:`导入失败：${c.message||"未知错误"}`,color:"error"})}finally{r.avatarLoading=!1;const c=d.target;c&&(c.value="")}}async function ge(d){const a=d.target.files?.[0];if(a)try{r.avatarLoading=!0;const c=await a.text(),U=JSON.parse(c);if(!U){v.add({title:"导入失败：无效的 JSON 数据",color:"error"});return}Object.assign(r.form,U),w.value="info",v.add({title:"导入成功",color:"success"})}catch(c){console.error("导入 JSON 失败:",c),v.add({title:`导入失败：${c.message||"JSON 格式错误"}`,color:"error"})}finally{r.avatarLoading=!1;const c=d.target;c&&(c.value="")}}const q=X(null),Q=ee({get(){try{const d=typeof r.form.body=="string"?JSON.parse(r.form.body):r.form.body;return JSON.stringify(d,null,2)}catch{return r.form.body}},set(d){r.form.body=d}});async function fe(){r.loading=!0;try{const d=ot(r.form);Array.isArray(d.tag)&&(d.tag=d.tag.join(",")),d.source===0&&delete d.source_url;try{const c=JSON.parse(d.body);q.value=null,d.content=JSON.stringify(c)}catch(c){q.value=c.message,v.add({title:`JSON 格式错误: ${c.message}`,color:"error"});return}const{error:a}=await(d.id?Xe:Ze)(d);a||(v.add({title:"操作成功",color:"success"}),N(),S("refresh"))}finally{r.loading=!1}}const i=[{label:"导入 PNG 角色卡",icon:"i-lucide-image",onSelect(){L.value?.click()}},{label:"导入 JSON",icon:"i-lucide-file-json",onSelect(){I.value?.click()}}];return ye(()=>j.dialog,async d=>{if(d){r.loading=!0,q.value=null;try{if(j.currentForm?.id){w.value="info";const{data:a,error:c}=await Qe({biz_id:j.currentForm.id});!c&&a?r.form=M(a.info):(r.form=M(j.currentForm),v.add({title:"获取详情失败",color:"error"}))}else w.value="card",r.form=M(j.currentForm)}catch{r.form=M(j.currentForm),v.add({title:"获取详情异常",color:"error"})}finally{r.loading=!1}}}),ye(()=>r.form.source,d=>{d===0&&(r.form.source_url="")}),(d,a)=>{const c=we,U=Ve,Ae=$e,R=Ue,V=Ce,se=Ge,re=Ke,je=Fe,Ne=Ye,F=We,ne=He,Pe=ze;return p(),J(Pe,{open:l(k),"onUpdate:open":a[15]||(a[15]=n=>_e(k)?k.value=n:null),title:l(r).form.id?"编辑":"新增",description:l(r).form.id?"编辑角色":"新增角色",ui:{content:"sm:max-w-4xl",footer:"justify-end"}},{body:m(()=>[e("div",gt,[e("div",ft,[(p(!0),f(D,null,G(l(T),([n,z])=>(p(),f("button",{key:n,type:"button",class:te(["px-5 py-3.5 text-sm transition-all relative rounded-t-lg",l(w)===n?"text-white dark:text-white font-bold bg-blue-400 dark:bg-blue-400 shadow-lg":"text-gray-600 dark:text-gray-400 font-medium hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-800"]),onClick:g=>w.value=n},_(z),11,bt))),128))])]),e("div",yt,[l(r).loading?(p(),f("div",xt,[e("div",_t,[t(c,{name:"i-material-symbols-progress-activity",class:"w-12 h-12 text-primary-500 animate-spin mx-auto"}),a[16]||(a[16]=e("p",{class:"mt-4 text-gray-600 dark:text-gray-400 font-medium"}," 加载中... ",-1))])])):(p(),f("div",ht,[l(w)==="card"?(p(),f("div",vt,[e("div",kt,[e("div",wt,[e("div",Vt,[t(c,{name:"i-material-symbols-upload-file",class:"w-6 h-6 text-primary-600"})]),e("div",Ut,[a[18]||(a[18]=e("h4",{class:"font-semibold text-gray-900 dark:text-white mb-1"}," 导入角色卡 ",-1)),a[19]||(a[19]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-4"}," 支持导入 PNG 格式的角色卡或 JSON 配置文件 ",-1)),t(Ae,{items:i},{default:m(()=>[t(U,{loading:l(r).avatarLoading,"trailing-icon":"i-material-symbols-keyboard-arrow-down",size:"lg"},{leading:m(()=>[t(c,{name:"i-material-symbols-download"})]),default:m(()=>[a[17]||(a[17]=$(" 选择导入方式 ",-1))]),_:1},8,["loading"])]),_:1})])])]),e("input",{ref_key:"pngInputRef",ref:L,type:"file",class:"hidden",accept:".png",onChange:pe},null,544),e("input",{ref_key:"jsonInputRef",ref:I,type:"file",class:"hidden",accept:".json",onChange:ge},null,544)])):h("",!0),l(w)==="info"?(p(),f("div",$t,[t(Ne,{ref_key:"formRef",ref:B,schema:l(oe),state:l(r).form,class:"flex flex-col gap-5",onSubmit:fe},{default:m(()=>[e("div",Ct,[e("div",zt,[t(c,{name:"i-material-symbols-info-outline",class:"w-5 h-5 text-primary-600"}),a[20]||(a[20]=e("h4",{class:"font-semibold text-gray-900 dark:text-white"}," 基本信息 ",-1))]),t(V,{label:"角色名",name:"name",required:""},{default:m(()=>[t(R,{modelValue:l(r).form.name,"onUpdate:modelValue":a[0]||(a[0]=n=>l(r).form.name=n),modelModifiers:{trim:!0},placeholder:"请输入角色名称",class:"w-full",type:"text",size:"lg"},{leading:m(()=>[t(c,{name:"i-material-symbols-person-outline",class:"w-5 h-5 text-gray-400"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"前导词语",name:"guide",description:"角色对话的前导提示词，可选填"},{default:m(()=>[t(se,{modelValue:l(r).form.guide,"onUpdate:modelValue":a[1]||(a[1]=n=>l(r).form.guide=n),modelModifiers:{trim:!0},placeholder:"例如：你是一位友善的助手，擅长解答问题...",rows:3,class:"w-full",size:"lg"},null,8,["modelValue"])]),_:1}),e("div",St,[t(V,{label:"来源",name:"source",required:""},{default:m(()=>[t(re,{modelValue:l(r).form.source,"onUpdate:modelValue":a[2]||(a[2]=n=>l(r).form.source=n),items:ae,placeholder:"请选择",class:"w-full",size:"lg"},null,8,["modelValue"])]),_:1}),t(V,{label:"标签",name:"tag"},{default:m(()=>[t(re,{modelValue:l(r).form.tag,"onUpdate:modelValue":a[3]||(a[3]=n=>l(r).form.tag=n),items:y.tagsOptions,multiple:"",placeholder:"请选择标签",class:"w-full",clearable:"",size:"lg"},null,8,["modelValue","items"])]),_:1}),t(V,{label:"隐私",name:"anonymous",required:""},{default:m(()=>[t(re,{modelValue:l(r).form.anonymous,"onUpdate:modelValue":a[4]||(a[4]=n=>l(r).form.anonymous=n),items:W,placeholder:"请选择",class:"w-full",size:"lg"},null,8,["modelValue"])]),_:1})]),l(r).form.source===1?(p(),J(V,{key:0,label:"来源地址",name:"source_url",description:"请输入转载来源的网址",required:""},{default:m(()=>[t(R,{modelValue:l(r).form.source_url,"onUpdate:modelValue":a[6]||(a[6]=n=>l(r).form.source_url=n),modelModifiers:{trim:!0},placeholder:"请输入来源地址，如：https://example.com",class:"w-full",type:"url",size:"lg"},{leading:m(()=>[t(c,{name:"i-material-symbols-link",class:"w-5 h-5 text-gray-400"})]),trailing:m(()=>[l(r).form.source_url?(p(),J(U,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-material-symbols-close",onClick:a[5]||(a[5]=n=>l(r).form.source_url="")})):h("",!0)]),_:1},8,["modelValue"])]),_:1})):h("",!0)]),e("div",Ot,[e("div",At,[t(c,{name:"i-material-symbols-image-outline",class:"w-5 h-5 text-primary-600"}),a[21]||(a[21]=e("h4",{class:"font-semibold text-gray-900 dark:text-white"}," 封面图片 ",-1))]),t(V,{name:"image",description:"JPG, JPEG or PNG. 1MB Max."},{default:m(()=>[e("div",jt,[e("div",Nt,[t(je,{src:l(r).form.image,alt:l(r).form.name,size:"2xl",class:"ring-2 ring-gray-200 dark:ring-gray-700"},null,8,["src","alt"]),l(r).form.image?(p(),f("div",Pt,[t(c,{name:"i-material-symbols-edit",class:"w-6 h-6 text-white"})])):h("",!0)]),e("div",Rt,[t(U,{loading:l(r).avatarLoading,color:"neutral",variant:"outline",size:"lg",onClick:E},{leading:m(()=>[t(c,{name:"i-material-symbols-upload"})]),default:m(()=>[$(" "+_(l(r).form.image?"更换图片":"上传图片"),1)]),_:1},8,["loading"]),e("input",{ref_key:"fileRef",ref:Y,type:"file",class:"hidden",accept:".jpg, .jpeg, .png",onChange:le},null,544)])])]),_:1})]),l(o)?(p(),f("div",Ft,[t(V,{label:"角色数据 (JSON)",name:"content"},{default:m(()=>[t(se,{modelValue:l(Q),"onUpdate:modelValue":a[7]||(a[7]=n=>_e(Q)?Q.value=n:null),class:te(["w-full font-mono text-sm",{"border-red-500 bg-red-50 dark:bg-red-900/20":l(q)}]),rows:12,placeholder:"请输入 JSON"},null,8,["modelValue","class"]),l(q)?(p(),f("div",Tt,[t(c,{name:"i-material-symbols-error-outline",class:"w-5 h-5"}),e("span",null,"JSON 错误: "+_(l(q)),1)])):h("",!0)]),_:1})])):h("",!0)]),_:1},8,["schema","state"])])):h("",!0),l(w)==="dialogue"?(p(),f("div",It,[e("div",Dt,[e("div",Lt,[t(c,{name:"i-material-symbols-chat-outline",class:"w-6 h-6 text-blue-600 mt-1"}),a[22]||(a[22]=e("div",null,[e("h4",{class:"font-semibold text-gray-900 dark:text-white mb-1"}," 开场对话配置 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," 设置角色的开场白和初始对话内容 ")],-1))])]),(p(!0),f(D,null,G(l(r).form.opening_lines,(n,z)=>(p(),f("div",{key:z,class:"group rounded-xl border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-5 flex gap-4 hover:border-primary-300 dark:hover:border-primary-700 hover:shadow-md transition-all"},[e("div",Mt,[e("div",Et,[e("span",Jt,_(Number(z)+1),1)]),a[23]||(a[23]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},"对话",-1))]),t(se,{modelValue:l(r).form.opening_lines[z],"onUpdate:modelValue":g=>l(r).form.opening_lines[z]=g,placeholder:"请输入对话内容...",class:"flex-1",rows:4,size:"lg"},null,8,["modelValue","onUpdate:modelValue"]),t(U,{icon:"i-material-symbols-delete-outline",color:"error",variant:"ghost",size:"lg",class:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:g=>l(r).form.opening_lines.splice(z,1)},null,8,["onClick"])]))),128)),e("div",Bt,[t(U,{variant:"outline",color:"primary",size:"lg",block:"",onClick:a[8]||(a[8]=n=>l(r).form.opening_lines.push(""))},{leading:m(()=>[t(c,{name:"i-material-symbols-add-circle-outline"})]),default:m(()=>[a[24]||(a[24]=$(" 新增对话 ",-1))]),_:1})])])):h("",!0),l(w)==="world"?(p(),f("div",qt,[e("div",Gt,[e("div",Kt,[t(c,{name:"i-material-symbols-public",class:"w-6 h-6 text-purple-600 mt-1"}),a[25]||(a[25]=e("div",null,[e("h4",{class:"font-semibold text-gray-900 dark:text-white mb-1"}," 世界观设定 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," 定义角色所处的世界背景和设定 ")],-1))]),t(V,{label:"世界书名称"},{default:m(()=>[t(R,{modelValue:l(r).form.character_book.name,"onUpdate:modelValue":a[9]||(a[9]=n=>l(r).form.character_book.name=n),placeholder:"例如：中世纪魔法世界",size:"lg",class:"w-full"},{leading:m(()=>[t(c,{name:"i-material-symbols-book-outline",class:"w-5 h-5 text-gray-400"})]),_:1},8,["modelValue"])]),_:1})]),e("div",Yt,[(p(!0),f(D,null,G(l(r).form.character_book.entries,(n,z)=>(p(),f("div",{key:z,class:"bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700 p-5"},[e("div",Wt,[e("div",Ht,[e("div",Qt,[e("span",Xt,_(Number(z)+1),1)]),e("span",Zt,"条目 "+_(Number(z)+1),1)]),t(U,{icon:"i-material-symbols-delete-outline",size:"sm",variant:"ghost",color:"error",onClick:g=>me(z)},null,8,["onClick"])]),e("div",ea,[t(V,{label:"备注",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.comment,"onUpdate:modelValue":g=>n.comment=g,placeholder:"备注说明",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{label:"触发关键词",required:"",class:"w-full"},{default:m(()=>[e("div",ta,[(p(!0),f(D,null,G(n.keys,(g,ie)=>(p(),f("div",{key:ie,class:"flex gap-2"},[t(R,{modelValue:n.keys[ie],"onUpdate:modelValue":xe=>n.keys[ie]=xe,placeholder:"输入关键词",size:"lg",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),t(U,{icon:"i-material-symbols-close",size:"lg",variant:"ghost",color:"error",onClick:xe=>b(n,ie)},null,8,["onClick"])]))),128)),t(U,{variant:"soft",size:"sm",onClick:g=>ce(n)},{leading:m(()=>[t(c,{name:"i-material-symbols-add"})]),default:m(()=>[a[26]||(a[26]=$(" 添加关键词 ",-1))]),_:1},8,["onClick"])])]),_:2},1024),t(V,{label:"内容",required:"",class:"w-full"},{default:m(()=>[t(se,{modelValue:n.content,"onUpdate:modelValue":g=>n.content=g,placeholder:"输入世界书内容...",rows:4,size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e("div",aa,[t(V,{label:"优先级",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.insertion_order,"onUpdate:modelValue":g=>n.insertion_order=g,modelModifiers:{number:!0},type:"number",placeholder:"0",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{label:"触发概率 (0%-100%)",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.extensions.probability,"onUpdate:modelValue":g=>n.extensions.probability=g,modelModifiers:{number:!0},type:"number",min:"0",max:"100",placeholder:"100",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{label:"记录深度",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.extensions.depth,"onUpdate:modelValue":g=>n.extensions.depth=g,modelModifiers:{number:!0},type:"number",placeholder:"4",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),e("div",oa,[t(V,{label:"深度扫描",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.extensions.scan_depth,"onUpdate:modelValue":g=>n.extensions.scan_depth=g,modelModifiers:{number:!0},type:"number",placeholder:"留空使用默认值",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{label:"插入位置",class:"w-full"},{default:m(()=>[t(re,{"model-value":s(n),items:K,placeholder:"请选择插入位置",size:"lg",class:"w-full","onUpdate:modelValue":g=>x(n,g)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),e("div",la,[e("div",sa,[t(F,{modelValue:n.enabled,"onUpdate:modelValue":g=>n.enabled=g},null,8,["modelValue","onUpdate:modelValue"]),a[27]||(a[27]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"启用条目",-1))]),e("div",ra,[t(F,{modelValue:n.constant,"onUpdate:modelValue":g=>n.constant=g},null,8,["modelValue","onUpdate:modelValue"]),a[28]||(a[28]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"常驻内存",-1))]),e("div",na,[t(F,{modelValue:n.selective,"onUpdate:modelValue":g=>n.selective=g},null,8,["modelValue","onUpdate:modelValue"]),a[29]||(a[29]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"选择性注入",-1))]),e("div",ia,[t(F,{modelValue:n.use_regex,"onUpdate:modelValue":g=>n.use_regex=g},null,8,["modelValue","onUpdate:modelValue"]),a[30]||(a[30]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"使用正则",-1))])])])]))),128))]),e("div",da,[t(U,{variant:"outline",color:"primary",size:"lg",block:"",onClick:de},{leading:m(()=>[t(c,{name:"i-material-symbols-add-circle-outline"})]),default:m(()=>[a[31]||(a[31]=$(" 新增条目 ",-1))]),_:1})])])):h("",!0),l(w)==="regex"?(p(),f("div",ma,[e("div",ca,[e("div",ua,[t(c,{name:"i-material-symbols-regular-expression",class:"w-6 h-6 text-orange-600 mt-1"}),e("div",pa,[a[32]||(a[32]=e("h4",{class:"font-semibold text-gray-900 dark:text-white mb-1"}," 正则表达式回复 ",-1)),a[33]||(a[33]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-4"}," 使用正则表达式匹配特定内容并自动回复 ",-1)),e("div",ga,[t(ne,{modelValue:l(r).form.regex_enabled,"onUpdate:modelValue":a[10]||(a[10]=n=>l(r).form.regex_enabled=n),size:"lg"},null,8,["modelValue"]),e("span",fa,_(l(r).form.regex_enabled?"已启用":"已禁用"),1)])])])]),l(r).form.regex_enabled?(p(),f("div",ba,[(p(!0),f(D,null,G(l(r).form.regex_rules,(n,z)=>(p(),f("div",{key:n.id||z,class:"bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700 p-5"},[e("div",ya,[e("div",xa,[e("div",_a,[e("span",ha,_(Number(z)+1),1)]),e("span",va,"规则 "+_(Number(z)+1),1)]),t(U,{icon:"i-material-symbols-delete-outline",size:"sm",variant:"ghost",color:"error",onClick:g=>P(z)},null,8,["onClick"])]),e("div",ka,[t(V,{label:"脚本名称",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.scriptName,"onUpdate:modelValue":g=>n.scriptName=g,placeholder:"输入脚本名称",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{label:"查找正则",required:"",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.findRegex,"onUpdate:modelValue":g=>n.findRegex=g,placeholder:"输入正则表达式",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{label:"替换字符串",class:"w-full"},{default:m(()=>[t(R,{modelValue:n.replaceString,"onUpdate:modelValue":g=>n.replaceString=g,placeholder:"输入替换内容",size:"lg",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{label:"应用位置",class:"w-full"},{default:m(()=>[e("div",wa,[e("div",Va,[t(F,{"model-value":O(n,0),"onUpdate:modelValue":g=>C(n,0)},null,8,["model-value","onUpdate:modelValue"]),a[34]||(a[34]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"用户输入",-1))]),e("div",Ua,[t(F,{"model-value":O(n,1),"onUpdate:modelValue":g=>C(n,1)},null,8,["model-value","onUpdate:modelValue"]),a[35]||(a[35]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"AI 输出",-1))]),e("div",$a,[t(F,{"model-value":O(n,2),"onUpdate:modelValue":g=>C(n,2)},null,8,["model-value","onUpdate:modelValue"]),a[36]||(a[36]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"快捷命令",-1))]),e("div",Ca,[t(F,{"model-value":O(n,3),"onUpdate:modelValue":g=>C(n,3)},null,8,["model-value","onUpdate:modelValue"]),a[37]||(a[37]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"世界信息",-1))])])]),_:2},1024),t(V,{label:"其他选项",class:"w-full"},{default:m(()=>[e("div",za,[e("div",Sa,[t(F,{modelValue:n.disabled,"onUpdate:modelValue":g=>n.disabled=g},null,8,["modelValue","onUpdate:modelValue"]),a[38]||(a[38]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"禁用",-1))]),e("div",Oa,[t(F,{modelValue:n.markdownOnly,"onUpdate:modelValue":g=>n.markdownOnly=g},null,8,["modelValue","onUpdate:modelValue"]),a[39]||(a[39]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"仅 Markdown",-1))]),e("div",Aa,[t(F,{modelValue:n.promptOnly,"onUpdate:modelValue":g=>n.promptOnly=g},null,8,["modelValue","onUpdate:modelValue"]),a[40]||(a[40]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"仅提示词",-1))]),e("div",ja,[t(F,{modelValue:n.runOnEdit,"onUpdate:modelValue":g=>n.runOnEdit=g},null,8,["modelValue","onUpdate:modelValue"]),a[41]||(a[41]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"编辑时运行",-1))])])]),_:2},1024)])]))),128))])):h("",!0),l(r).form.regex_enabled?(p(),f("div",Na,[t(U,{variant:"outline",color:"primary",size:"lg",block:"",onClick:ue},{leading:m(()=>[t(c,{name:"i-material-symbols-add-circle-outline"})]),default:m(()=>[a[42]||(a[42]=$(" 新增规则 ",-1))]),_:1})])):h("",!0)])):h("",!0),l(w)==="status"?(p(),f("div",Pa,[e("div",Ra,[e("div",Fa,[t(c,{name:"i-material-symbols-settings-outline",class:"w-5 h-5 text-primary-600"}),a[43]||(a[43]=e("h4",{class:"font-semibold text-gray-900 dark:text-white"}," 状态管理 ",-1))]),e("div",Ta,[e("div",null,[a[44]||(a[44]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-white"}," 状态 ",-1)),e("p",Ia,_(l(r).form.state===2?"正常":"已删除"),1)]),t(ne,{"model-value":l(r).form.state===2,size:"lg","onUpdate:modelValue":a[11]||(a[11]=n=>H("state",n?2:4))},null,8,["model-value"])]),e("div",Da,[e("div",null,[a[45]||(a[45]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-white"}," 推荐 ",-1)),e("p",La,_(l(r).form.recommend?"已推荐":"未推荐"),1)]),t(ne,{"model-value":!!l(r).form.recommend,size:"lg","onUpdate:modelValue":a[12]||(a[12]=n=>H("recommend",n?1:0))},null,8,["model-value"])]),e("div",Ma,[e("div",null,[a[46]||(a[46]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-white"}," 每日推荐 ",-1)),e("p",Ea,_(l(r).form.day_recommend?"已推荐":"未推荐"),1)]),t(ne,{"model-value":!!l(r).form.day_recommend,size:"lg","onUpdate:modelValue":a[13]||(a[13]=n=>H("day_recommend",n?1:0))},null,8,["model-value"])])])])):h("",!0)]))])]),footer:m(()=>[e("div",Ja,[e("div",Ba,[t(c,{name:"i-material-symbols-info-outline",class:"inline w-4 h-4"}),$(" "+_(l(w)==="status"?"状态管理通过开关直接更新":l(r).form.id?"修改后将更新角色信息":"确认后将创建新角色"),1)]),e("div",qa,[t(U,{label:"取消",color:"neutral",variant:"outline",size:"lg",onClick:N},{leading:m(()=>[t(c,{name:"i-material-symbols-close"})]),_:1}),t(U,{loading:l(r).loading,disabled:l(w)==="status",label:"确认保存",variant:"solid",size:"lg",onClick:a[14]||(a[14]=n=>l(B)?.submit())},{leading:m(()=>[t(c,{name:"i-material-symbols-check"})]),_:1},8,["loading","disabled"])])])]),_:1},8,["open","title","description"])}}}),Ka=Object.assign(Ga,{__name:"AmusementListEdit"}),Ya={class:"p-4 sm:p-6"},Wa={class:"flex flex-wrap items-center gap-4"},Ha={class:"relative"},Qa={class:"relative"},Xa={class:"relative"},Za={class:"relative"},eo={class:"relative"},to={class:"relative z-10"},ao={class:"flex flex-wrap items-center gap-4"},oo={class:"mt-2.5 mb-4 flex gap-1 border-b border-gray-200 dark:border-gray-700"},lo=["onClick"],so={class:"min-h-[400px]"},ro={key:0,class:"flex items-center justify-center py-12"},no={class:"text-center"},io={key:1,class:"flex flex-col items-center justify-center py-16"},mo={class:"w-24 h-24 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-6"},co={class:"grid grid-cols-5 gap-4"},uo=["onClick"],po={key:0,class:"absolute top-0 right-0 w-0 h-0 border-t-[32px] border-t-amber-500 dark:border-t-amber-600 border-l-[32px] border-l-transparent"},go={class:"flex items-start gap-3"},fo={class:"relative shrink-0"},bo=["src","alt"],yo={key:1,class:"w-16 h-20 rounded-lg bg-gradient-to-br from-pink-100 to-purple-100 dark:from-pink-900/30 dark:to-purple-900/30 flex items-center justify-center text-gray-400 text-xs"},xo={class:"flex-1 min-w-0"},_o={class:"flex items-start justify-between"},ho={class:"flex items-center gap-1 flex-1 min-w-0 mr-2"},vo={class:"font-semibold text-gray-900 dark:text-gray-100 truncate"},ko={class:"text-xs text-gray-500 mt-1"},wo={class:"text-[10px] text-gray-400 mt-0.5"},Vo={key:0,class:"inline-block mt-1 px-1.5 py-0.5 text-[10px] font-medium bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 rounded"},Uo={key:1,class:"inline-block mt-1 px-1.5 py-0.5 text-[10px] font-medium bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 rounded"},$o={key:2,class:"inline-flex items-center gap-1 mt-1 ml-1 px-1.5 py-0.5 text-xs bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400 rounded"},Co={key:1,class:"flex flex-wrap gap-1 mt-3"},zo={class:"flex flex-wrap gap-1 mt-2"},So={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400 rounded"},Oo={key:1,class:"px-1.5 py-0.5 text-[10px] font-medium bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400 rounded"},Ao={key:2,class:"px-1.5 py-0.5 text-[10px] font-medium bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400 rounded"},jo={key:3,class:"px-1.5 py-0.5 text-[10px] font-medium bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 rounded"},No={key:4,class:"px-1.5 py-0.5 text-[10px] font-medium bg-cyan-100 text-cyan-600 dark:bg-cyan-900/30 dark:text-cyan-400 rounded"},Po={key:5,class:"px-1.5 py-0.5 text-[10px] font-medium bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400 rounded"},Ro={class:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-3 pt-3 border-t border-gray-100 dark:border-gray-800 text-xs text-gray-500"},Fo={class:"flex items-center gap-1 cursor-help"},To={class:"flex items-center gap-1 cursor-help"},Io={class:"flex items-center gap-1 cursor-help"},Do={class:"flex items-center gap-1 cursor-help"},Lo={class:"flex items-center gap-1 cursor-help"},Mo={class:"flex items-center gap-1 cursor-help"},Eo={class:"flex items-center gap-1 cursor-help"},Jo={class:"flex justify-center mt-6"},Bo={class:"p-4"},qo={class:"flex justify-end gap-2"},Pl=Se({name:"AmusementList",__name:"list",setup(y){const A=dt(),u=ke(),o=Oe({isDialog:!1,currentForm:{},tagsOptions:[],categoryOptions:[],activeTab:0,currentList:[],loading:!1,datePickerVisible:!1,datePickerItem:null,selectedDate:"",pagination:{page:1,pagesize:30,total:0},search:{id:"",uid:"",name:"",category_id:"all",anonymous:"all",recommend:"all",day_recommend:"all",date_recommend:"all",sort:"all"}}),j=De(),S=async b=>{j.push(`/amusement/detail/${b.id}`)},k=async()=>{v(),o.isDialog=!1},N=async b=>{const{error:s}=await et({id:b.id});s||(u.add({title:"删除成功",color:"success"}),v())},w=async b=>{const s=b.recommend===2?0:2,{error:x}=await Z({id:b.id,recommend:s});x||(u.add({title:s===2?"已设为推荐":"已取消推荐",color:"success"}),v())},T=async b=>{const s=b.day_recommend===2?0:2,{error:x}=await Z({id:b.id,day_recommend:s});x||(u.add({title:s===2?"已设为日推":"已取消日推",color:"success"}),v())},B=b=>{o.datePickerItem=b,o.selectedDate=b.recommend_time||"",o.datePickerVisible=!0},Y=async b=>{const s=b.state===2?0:2,{error:x}=await Z({id:b.id,state:s});x||(u.add({title:s===2?"已发布":"已取消发布",color:"success"}),v())},L=async()=>{if(!o.datePickerItem)return;const{error:b}=await Z({id:o.datePickerItem.id,recommend_time:o.selectedDate.replace("T"," ")});b||(u.add({title:"日期推荐设置成功",color:"success"}),o.datePickerVisible=!1,v())},I=async()=>{const{data:b}=await it({page:1,pagesize:-1,ty:"1"});b?o.tagsOptions=b.list.map(s=>({label:s.name,value:s.name})):o.tagsOptions=[]},ae=async()=>{const{data:b}=await at({page:1,pagesize:-1});o.categoryOptions=b?.list?.map(s=>({label:s.name,value:String(s.id)}))||[]},W=ee(()=>[{label:"全部",value:"all"},...o.categoryOptions]),K=b=>{if(!b)return!1;const s=new Date(b),x=new Date,C=new Date(x);C.setDate(x.getDate()-x.getDay()),C.setHours(0,0,0,0);const O=new Date(C);return O.setDate(C.getDate()+7),s>=C&&s<O},r=b=>{if(!b)return!1;const s=new Date(b),x=new Date;return s.getFullYear()===x.getFullYear()&&s.getMonth()===x.getMonth()},oe=b=>{if(!b)return"";const s=new Date(b),x=s.getFullYear(),C=String(s.getMonth()+1).padStart(2,"0"),O=String(s.getDate()).padStart(2,"0");return`${x}/${C}/${O}`},v=async(b=1)=>{o.loading=!0,o.pagination.page=b;const s={page:o.pagination.page,pagesize:o.pagination.pagesize};o.activeTab>0&&(s.seeking=o.activeTab),o.search.id&&(s.id=o.search.id),o.search.uid&&(s.uid=o.search.uid),o.search.name&&(s.name=o.search.name),o.search.category_id&&o.search.category_id!=="all"&&(s.category_id=o.search.category_id),o.search.sort&&o.search.sort!=="all"&&(s.sort=o.search.sort),o.search.anonymous&&o.search.anonymous!=="all"&&(s.anonymous=o.search.anonymous),o.search.recommend&&o.search.recommend!=="all"&&(s.recommend=o.search.recommend),o.search.day_recommend&&o.search.day_recommend!=="all"&&(s.day_recommend=o.search.day_recommend),o.search.date_recommend&&o.search.date_recommend!=="all"&&(s.date_recommend=o.search.date_recommend);const{data:x}=await tt(s);o.currentList=x?.list||[],o.pagination.total=x?.count||0,o.loading=!1},M=()=>{o.pagination.page=1,v(1)},de=()=>{o.search.id="",o.search.uid="",o.search.name="",o.search.category_id="all",o.search.sort="all",o.search.anonymous="all",o.search.recommend="all",o.search.day_recommend="all",o.search.date_recommend="all",o.pagination.page=1,v(1)},me=b=>{v(b)},ce=()=>{I(),ae(),v()};return ye(()=>o.activeTab,()=>{o.pagination.page=1,v(1)}),st(()=>{ce()}),(b,s)=>{const x=Ve,C=Ue,O=Le,ue=Me,P=we,H=$e,le=Ee,E=Je,pe=Be,ge=qe,q=Ka,Q=Ce,fe=ze;return p(),f(D,null,[t(ge,null,{default:m(()=>[e("div",Ya,[t(ue,null,{default:m(()=>[e("div",Wa,[t(C,{modelValue:l(o).search.id,"onUpdate:modelValue":s[1]||(s[1]=i=>l(o).search.id=i),placeholder:"",class:"w-[180px]",ui:{base:"peer",trailing:"pe-1"},onKeyup:be(M,["enter"])},{trailing:m(()=>[l(o).search.id?(p(),J(x,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:s[0]||(s[0]=i=>l(o).search.id="")})):h("",!0)]),default:m(()=>[s[17]||(s[17]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5 transition-all peer-focus:-top-2.5 peer-focus:text-highlighted peer-focus:text-xs peer-focus:font-medium peer-placeholder-shown:text-sm peer-placeholder-shown:text-dimmed peer-placeholder-shown:top-1.5 peer-placeholder-shown:font-normal"},[e("span",{class:"inline-flex bg-default px-1"},"角色ID")],-1))]),_:1},8,["modelValue"]),t(C,{modelValue:l(o).search.uid,"onUpdate:modelValue":s[3]||(s[3]=i=>l(o).search.uid=i),placeholder:"",class:"w-[180px]",ui:{base:"peer",trailing:"pe-1"},onKeyup:be(M,["enter"])},{trailing:m(()=>[l(o).search.uid?(p(),J(x,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:s[2]||(s[2]=i=>l(o).search.uid="")})):h("",!0)]),default:m(()=>[s[18]||(s[18]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5 transition-all peer-focus:-top-2.5 peer-focus:text-highlighted peer-focus:text-xs peer-focus:font-medium peer-placeholder-shown:text-sm peer-placeholder-shown:text-dimmed peer-placeholder-shown:top-1.5 peer-placeholder-shown:font-normal"},[e("span",{class:"inline-flex bg-default px-1"},"用户UID")],-1))]),_:1},8,["modelValue"]),t(C,{modelValue:l(o).search.name,"onUpdate:modelValue":s[5]||(s[5]=i=>l(o).search.name=i),placeholder:"",class:"w-[260px]",ui:{base:"peer",trailing:"pe-1"},onKeyup:be(M,["enter"])},{trailing:m(()=>[l(o).search.name?(p(),J(x,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:s[4]||(s[4]=i=>l(o).search.name="")})):h("",!0)]),default:m(()=>[s[19]||(s[19]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5 transition-all peer-focus:-top-2.5 peer-focus:text-highlighted peer-focus:text-xs peer-focus:font-medium peer-placeholder-shown:text-sm peer-placeholder-shown:text-dimmed peer-placeholder-shown:top-1.5 peer-placeholder-shown:font-normal"},[e("span",{class:"inline-flex bg-default px-1"},"搜索(名字/简介/tag/发布者)")],-1))]),_:1},8,["modelValue"]),e("div",Ha,[t(O,{modelValue:l(o).search.category_id,"onUpdate:modelValue":s[6]||(s[6]=i=>l(o).search.category_id=i),items:l(W),"value-key":"value",placeholder:"分类",class:"w-[180px]",ui:{placeholder:"opacity-0",trailing:"pe-1"}},null,8,["modelValue","items"]),s[20]||(s[20]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},[e("span",{class:"inline-flex bg-default px-1"},"分类")],-1))]),e("div",Qa,[t(O,{modelValue:l(o).search.anonymous,"onUpdate:modelValue":s[7]||(s[7]=i=>l(o).search.anonymous=i),items:[{label:"全部",value:"all"},{label:"公开",value:"0"},{label:"隐私",value:"1"}],"value-key":"value",placeholder:"隐私",class:"w-[180px]",ui:{placeholder:"opacity-0",trailing:"pe-1"}},null,8,["modelValue"]),s[21]||(s[21]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},[e("span",{class:"inline-flex bg-default px-1"},"隐私")],-1))]),e("div",Xa,[t(O,{modelValue:l(o).search.recommend,"onUpdate:modelValue":s[8]||(s[8]=i=>l(o).search.recommend=i),items:[{label:"全部",value:"all"},{label:"推荐",value:"2"},{label:"不推荐",value:"0"}],"value-key":"value",placeholder:"推荐",class:"w-[180px]",ui:{placeholder:"opacity-0",trailing:"pe-1"}},null,8,["modelValue"]),s[22]||(s[22]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},[e("span",{class:"inline-flex bg-default px-1"},"推荐")],-1))]),e("div",Za,[t(O,{modelValue:l(o).search.day_recommend,"onUpdate:modelValue":s[9]||(s[9]=i=>l(o).search.day_recommend=i),items:[{label:"全部",value:"all"},{label:"日推",value:"2"},{label:"非日推",value:"0"}],"value-key":"value",placeholder:"日推",class:"w-[180px]",ui:{placeholder:"opacity-0",trailing:"pe-1"}},null,8,["modelValue"]),s[23]||(s[23]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},[e("span",{class:"inline-flex bg-default px-1"},"日推")],-1))]),e("div",eo,[t(O,{modelValue:l(o).search.date_recommend,"onUpdate:modelValue":s[10]||(s[10]=i=>l(o).search.date_recommend=i),items:[{label:"全部",value:"all"},{label:"周推",value:"week"},{label:"月推",value:"month"}],"value-key":"value",placeholder:"日期推",class:"w-[180px]",ui:{placeholder:"opacity-0",trailing:"pe-1"}},null,8,["modelValue"]),s[24]||(s[24]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},[e("span",{class:"inline-flex bg-default px-1"},"日期推")],-1))]),e("div",to,[t(O,{modelValue:l(o).search.sort,"onUpdate:modelValue":s[11]||(s[11]=i=>l(o).search.sort=i),items:[{label:"默认",value:"all"},{label:"电量",value:"battery"},{label:"播放数",value:"play_count"},{label:"点赞数",value:"praise_count"},{label:"收藏数",value:"collect_count"},{label:"对话数",value:"dialogue_count"},{label:"评分",value:"score"},{label:"推荐时间",value:"recommend_time"},{label:"更新时间",value:"updated_at"}],"value-key":"value",placeholder:"排序",class:"w-[180px]",ui:{placeholder:"opacity-0",trailing:"pe-1"}},null,8,["modelValue"]),s[25]||(s[25]=e("label",{class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},[e("span",{class:"inline-flex bg-default px-1"},"排序")],-1))]),e("div",ao,[t(x,{label:"查询",icon:"i-lucide-search",onClick:M}),t(x,{label:"重置",icon:"fluent:arrow-reset-24-filled",color:"neutral",variant:"outline",onClick:de})])])]),_:1}),e("div",oo,[(p(),f(D,null,G([{value:0,label:"全部"},{value:2,label:"待审核"},{value:3,label:"版本升级审核"},{value:5,label:"已发布"},{value:4,label:"已删除"}],i=>e("button",{key:i.value,type:"button",class:te(["px-4 py-2 text-sm font-medium border-b-2 -mb-px",l(o).activeTab===i.value?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"]),onClick:d=>l(o).activeTab=i.value},_(i.label),11,lo)),64))]),e("div",so,[l(o).loading?(p(),f("div",ro,[e("div",no,[t(P,{name:"i-material-symbols-progress-activity",class:"w-12 h-12 text-primary-500 animate-spin mx-auto"}),s[26]||(s[26]=e("p",{class:"mt-4 text-gray-600 dark:text-gray-400 font-medium"}," 加载中... ",-1))])])):l(o).currentList.length===0?(p(),f("div",io,[e("div",mo,[t(P,{name:"i-material-symbols-inbox-outline",class:"w-12 h-12 text-gray-400"})]),s[27]||(s[27]=e("p",{class:"text-gray-900 dark:text-white text-xl font-semibold mb-2"}," 暂无数据 ",-1)),s[28]||(s[28]=e("p",{class:"text-gray-500 dark:text-gray-400 text-sm"}," 试试调整搜索条件或切换其他标签页 ",-1))])):(p(),f(D,{key:2},[e("div",co,[(p(!0),f(D,null,G(l(o).currentList,i=>(p(),f("div",{key:i.id,class:te(["group bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 p-4 cursor-pointer hover:shadow-lg hover:border-pink-300 transition-all relative overflow-hidden",{"opacity-60":l(o).activeTab===4}]),onClick:d=>S(i)},[i.recommend===2?(p(),f("div",po,[...s[29]||(s[29]=[e("span",{class:"absolute -top-[30px] right-[3px] text-white text-xs font-bold"},"精",-1)])])):h("",!0),e("div",go,[e("div",fo,[i.image?(p(),f("img",{key:0,src:i.image,alt:i.name,class:te(["w-16 h-20 rounded-lg object-cover",{grayscale:l(o).activeTab===4}])},null,10,bo)):(p(),f("div",yo," 暂无 "))]),e("div",xo,[e("div",_o,[e("div",ho,[e("h3",vo,_(i.name),1)]),l(o).activeTab!==4?(p(),J(H,{key:0,items:[[{label:i.state===2?"取消发布":"设为发布",icon:"i-lucide-check-circle",onSelect:()=>Y(i)},{label:i.recommend===2?"取消推荐":"设为推荐",icon:"i-lucide-star",onSelect:()=>w(i)},{label:i.day_recommend===2?"取消日推":"设为日推",icon:"i-lucide-sun",onSelect:()=>T(i)},{label:"日期推荐",icon:"i-lucide-calendar",onSelect:()=>B(i)}],[{label:"删除",icon:"i-lucide-trash-2",color:"error",onSelect:()=>l(A).open({color:"error",title:"删除数据",description:"您确定要删除吗？",onPositiveClick(){N(i)}})}]]},{default:m(()=>[t(x,{variant:"ghost",size:"xs",class:"opacity-0 group-hover:opacity-100 -mt-1 -mr-1",onClick:s[12]||(s[12]=rt(()=>{},["stop"]))},{default:m(()=>[t(P,{name:"i-lucide-more-vertical",class:"w-4 h-4 text-gray-400"})]),_:1})]),_:1},8,["items"])):h("",!0)]),e("p",ko,_(oe(i.created_at)),1),e("p",wo," UID: "+_(i.uid||i.member?.id||"-")+" · "+_(i.member?.nickname||i.member?.username||"-"),1),i.state===0?(p(),f("span",Vo,"审核中")):h("",!0),i.state===2&&i.version_id!==i.review_version_id?(p(),f("span",Uo,"新版本审核中")):h("",!0),i.battery>0?(p(),f("span",$o,[t(P,{name:"i-lucide-zap",class:"w-3 h-3"}),$(_(i.battery),1)])):h("",!0)])]),i.tag&&i.tag.length>0?(p(),f("div",Co,[(p(!0),f(D,null,G(i.tag.slice(0,3),(d,a)=>(p(),J(le,{key:a,variant:"outline",size:"xs"},{default:m(()=>[$(_(d),1)]),_:2},1024))),128)),i.tag.length>3?(p(),J(le,{key:0,variant:"outline",size:"xs"},{default:m(()=>[$(" +"+_(i.tag.length-3),1)]),_:2},1024)):h("",!0)])):h("",!0),e("div",zo,[i.state===2?(p(),f("span",So,"已发布")):(p(),f("span",Oo,"未发布")),i.recommend===2?(p(),f("span",Ao,"推荐")):h("",!0),i.day_recommend===2?(p(),f("span",jo,"日推")):h("",!0),K(i.recommend_time)?(p(),f("span",No,"周推")):h("",!0),r(i.recommend_time)?(p(),f("span",Po,"月推")):h("",!0)]),e("div",Ro,[t(E,{text:"点赞数"},{default:m(()=>[e("span",Fo,[t(P,{name:"i-lucide-heart",class:"w-3 h-3 text-pink-500"}),$(_(i.praise_count||0),1)])]),_:2},1024),t(E,{text:"收藏数"},{default:m(()=>[e("span",To,[t(P,{name:"i-lucide-bookmark",class:"w-3 h-3 text-orange-500"}),$(_(i.collect_count||0),1)])]),_:2},1024),t(E,{text:"评论数"},{default:m(()=>[e("span",Io,[t(P,{name:"i-lucide-message-circle",class:"w-3 h-3 text-blue-500"}),$(_(i.comment_count||0),1)])]),_:2},1024),t(E,{text:"播放次数"},{default:m(()=>[e("span",Do,[t(P,{name:"i-lucide-play",class:"w-3 h-3 text-green-500"}),$(_(i.play_count||0),1)])]),_:2},1024),t(E,{text:"对话人数"},{default:m(()=>[e("span",Lo,[t(P,{name:"i-lucide-users",class:"w-3 h-3 text-purple-500"}),$(_(i.dialogue_count||0),1)])]),_:2},1024),t(E,{text:"评分"},{default:m(()=>[e("span",Mo,[t(P,{name:"i-lucide-star",class:"w-3 h-3 text-yellow-500"}),$(_(i.score||0),1)])]),_:2},1024),t(E,{text:"评分人数"},{default:m(()=>[e("span",Eo,[t(P,{name:"i-lucide-users",class:"w-3 h-3 text-indigo-500"}),$(_(i.score_count||0),1)])]),_:2},1024)])],10,uo))),128))]),e("div",Jo,[t(pe,{page:l(o).pagination.page,"items-per-page":l(o).pagination.pagesize,total:l(o).pagination.total,"onUpdate:page":me},null,8,["page","items-per-page","total"])])],64))])])]),_:1}),t(q,{dialog:l(o).isDialog,"onUpdate:dialog":s[13]||(s[13]=i=>l(o).isDialog=i),"current-form":l(o).currentForm,"tags-options":l(o).tagsOptions,onRefresh:k},null,8,["dialog","current-form","tags-options"]),t(fe,{open:l(o).datePickerVisible,"onUpdate:open":s[16]||(s[16]=i=>l(o).datePickerVisible=i),title:"设置日期推荐",ui:{content:"sm:max-w-md"}},{body:m(()=>[e("div",Bo,[t(Q,{label:"推荐时间"},{default:m(()=>[t(C,{modelValue:l(o).selectedDate,"onUpdate:modelValue":s[14]||(s[14]=i=>l(o).selectedDate=i),type:"datetime-local",step:"1",class:"w-full"},null,8,["modelValue"])]),_:1})])]),footer:m(()=>[e("div",qo,[t(x,{color:"neutral",variant:"outline",onClick:s[15]||(s[15]=i=>l(o).datePickerVisible=!1)},{default:m(()=>[...s[30]||(s[30]=[$(" 取消 ",-1)])]),_:1}),t(x,{onClick:L},{default:m(()=>[...s[31]||(s[31]=[$(" 确认 ",-1)])]),_:1})])]),_:1},8,["open"])],64)}}});export{Pl as default};
