import{_ as J}from"./CEcF5dWm.js";import{f as z,c as H,ap as Q,i as K,j as N,aE as W,l as X,a as x,o as p,w as n,B as o,_ as R,b as a,C as k,D as L,aq as S,a4 as Y,aT as Z,aU as ee,aF as m,k as T,A as ae,G as te}from"./DhOLkSnF.js";import{_ as oe,a as le,b as re,c as ne}from"./DAqc9GYg.js";import{_ as se}from"./CSbqei5V.js";import{_ as ie}from"./DAIKkUkW.js";import{_ as me}from"./DAeRr84W.js";import{_ as ce}from"./D0vBe5Vh.js";import{_ as de}from"./Db__RPjw.js";import{_ as ue}from"./BZLiX_8y.js";import{a as j,b as fe}from"./CzWoDhk-.js";import{c as A}from"./45RcOEEf.js";import{o as pe,s as D,n as M}from"./B-mCBPct.js";import{u as ge,b as _e}from"./Bo5OMT4U.js";import{_ as E}from"./-rcGzxkB.js";import{f as be}from"./BmKy9gZZ.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./CLKxJTZi.js";import"./HRiyi1uV.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";const ve={class:"flex flex-wrap items-center gap-3"},ye=z({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(l,{emit:g}){const u=l,_=g,s=H({get(){return u.dialog},set(i){_("update:dialog",i)}}),h=()=>{s.value=!1},b=Q("formRef"),v=K(),w=pe({name:D().nonempty(),remark:D().nonempty(),battery:M().min(0),divided:M().min(0),state:M().min(0),logo:D()}),c=[{label:"启用",value:2},{label:"待审核",value:1},{label:"已删除",value:4}],y=[{label:"是",value:1},{label:"否",value:0}],e=N({loading:!1,avatarLoading:!1,form:{}});async function V(i){const t=i.target;if(t.files?.length&&Z(t.files[0])){e.avatarLoading=!0;const{data:d}=await ee({image:t.files[0]});d&&(e.form.logo=d.uri),e.avatarLoading=!1}}function U(){v.value?.click()}const $=W();async function F(){e.loading=!0;const i=A(e.form),{error:t}=await(i.id?j:j)(i);t||($.add({title:"操作成功",color:"success"}),_("refresh")),e.loading=!1}return X(()=>u.dialog,i=>{i&&(e.loading=!1,e.form=u.currentForm)}),(i,t)=>{const d=R,C=ie,f=me,B=ce,G=S,I=de,O=ue;return p(),x(O,{open:a(s),"onUpdate:open":t[9]||(t[9]=r=>Y(s)?s.value=r:null),title:l.currentForm.id?"修改":"新增",dismissible:!1,ui:{footer:"justify-end"}},{body:n(()=>[o(I,{ref_key:"formRef",ref:b,schema:a(w),state:a(e).form,class:"flex flex-col gap-4",onSubmit:F},{default:n(()=>[o(f,{label:"等级名称",name:"name",required:""},{default:n(()=>[o(C,{modelValue:a(e).form.name,"onUpdate:modelValue":t[1]||(t[1]=r=>a(e).form.name=r),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:n(()=>[a(e).form.name?(p(),x(d,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:t[0]||(t[0]=r=>a(e).form.name="")})):k("",!0)]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"所需电量",name:"battery",required:""},{default:n(()=>[o(C,{modelValue:a(e).form.battery,"onUpdate:modelValue":t[3]||(t[3]=r=>a(e).form.battery=r),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"},type:"number",min:"0"},{trailing:n(()=>[a(e).form.battery?(p(),x(d,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:t[2]||(t[2]=r=>a(e).form.battery="")})):k("",!0)]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"参与分成?",name:"divided",required:""},{default:n(()=>[o(B,{modelValue:a(e).form.divided,"onUpdate:modelValue":t[4]||(t[4]=r=>a(e).form.divided=r),items:y,placeholder:"请选择",class:"w-full"},null,8,["modelValue"])]),_:1}),o(f,{label:"备注",name:"remark"},{default:n(()=>[o(C,{modelValue:a(e).form.remark,"onUpdate:modelValue":t[6]||(t[6]=r=>a(e).form.remark=r),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:n(()=>[a(e).form.remark?(p(),x(d,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:t[5]||(t[5]=r=>a(e).form.remark="")})):k("",!0)]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"状态",name:"state",required:""},{default:n(()=>[o(B,{modelValue:a(e).form.state,"onUpdate:modelValue":t[7]||(t[7]=r=>a(e).form.state=r),items:c,placeholder:"请选择",class:"w-full"},null,8,["modelValue"])]),_:1}),o(f,{label:"icon",name:"logo",description:"JPG, JPEG or PNG. 1MB Max.",class:"flex max-sm:flex-col justify-between sm:items-center gap-4"},{default:n(()=>[L("div",ve,[o(G,{src:a(e).form.logo,alt:a(e).form.name,size:"xl"},null,8,["src","alt"]),o(d,{loading:a(e).avatarLoading,label:"上传",color:"neutral",onClick:U},null,8,["loading"]),L("input",{ref_key:"fileRef",ref:v,type:"file",class:"hidden",accept:".jpg, .jpeg, .png",onChange:V},null,544)])]),_:1})]),_:1},8,["schema","state"])]),footer:n(()=>[o(d,{label:"取消",color:"neutral",variant:"outline",onClick:h}),o(d,{loading:a(e).loading,label:"确认",variant:"solid",onClick:t[8]||(t[8]=r=>a(b)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),xe=Object.assign(ye,{__name:"MemberLevelEdit"}),q={2:["启用","success"],1:["待审核","warning"],4:["已删除","error"]},P={0:["否","error"],1:["是","success"]},ke=[{accessorKey:"id",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},header:()=>m(R,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"})},{accessorKey:"logo",header:"Logo",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:l})=>{const g=l.original.logo;return g?m(S,{src:g,alt:"logo",size:"lg",class:"ring-1 ring-gray-200"}):m("div",{class:"w-10 h-10 rounded bg-gray-200 flex items-center justify-center text-xs text-gray-500"},"N/A")}},{accessorKey:"name",header:"等级名称",searchPlaceholder:"筛选名称",cell:({row:l})=>m("div",void 0,[m("p",{class:"font-medium text-(--ui-text-highlighted)"},l.original.name),m("p",{class:"text-xs"},l.original.remark)])},{accessorKey:"battery",header:"所需电量"},{accessorKey:"divided",header:"参与分成?",cell:({row:l})=>m(E,{class:"capitalize",variant:"subtle",color:P[l.original.divided]?.[1]},()=>P[l.original.divided]?.[0])},{accessorKey:"updated_at",header:"更新时间",cell:({row:l})=>be(l.original.updated_at)},{accessorKey:"state",header:"状态",searchPlaceholder:"筛选状态",formItemProps:{component:"Select",componentProps:{options:[{label:"待审核",value:1},{label:"启用",value:2},{label:"已删除",value:4}]}},cell:({row:l})=>m(E,{class:"capitalize",variant:"subtle",color:q[l.original.state]?.[1]},()=>q[l.original.state]?.[0])}],he={key:0,class:"absolute top-0 left-0 right-0 h-(--ui-header-height) flex items-center justify-between border-b border-(--ui-border) px-4 sm:px-6 bg-(--ui-bg)"},we={class:"flex items-center gap-4"},Je=z({name:"MemberLevelList",__name:"level",setup(l){const u=ge(_e).smaller("lg"),_=K(),s=N({isDialog:!1,currentForm:{}}),h=async c=>{s.isDialog=!0,c?s.currentForm=A(c):s.currentForm={state:2}},b=async()=>{_.value.reload(),s.isDialog=!1};function v(c){return[{label:"编辑",icon:"material-symbols:edit-square-outline",onSelect(){h(c.original)}}]}const w=[...ke,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:c})=>m("div",{class:"text-right"},m(J,{content:{align:"end"},items:v(c)},()=>m(R,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(c,y)=>{const e=le,V=oe,U=re,$=se,F=ne,i=xe;return p(),T(te,null,[o(F,{ui:{body:"pb-[12px]! gap-0!"}},ae({body:n(()=>[a(u)?k("",!0):(p(),T("div",he,[L("div",we,[o(e),o(U)])])),o($,{ref_key:"tableRef",ref:_,"data-request":a(fe),columns:w,"scroll-x":"min-w-[1200px]"},null,8,["data-request"])]),_:2},[a(u)?{name:"header",fn:n(()=>[o(V,{title:"客户等级规则"},{leading:n(()=>[o(e)]),_:1})]),key:"0"}:void 0]),1024),o(i,{dialog:a(s).isDialog,"onUpdate:dialog":y[0]||(y[0]=t=>a(s).isDialog=t),"current-form":a(s).currentForm,onRefresh:b},null,8,["dialog","current-form"])],64)}}});export{Je as default};
