import{_ as Q}from"./1OJ4jHSB.js";import{w as H,_ as T,a as X,z as Y}from"./DiI9-bkE.js";import{_ as Z}from"./Odvr87Pg.js";import{_ as ee}from"./CuFgEFCp.js";import{_ as te}from"./DkYr1hfb.js";import{_ as oe}from"./BdKneTYw.js";import{_ as ae}from"./oJBVUttf.js";import{_ as se}from"./CMdLDScf.js";import{_ as le}from"./BkseHKFx.js";import{_ as ie}from"./9B_i7pfW.js";import{_ as re}from"./8gEztUrL.js";import{p as ne,q as ce,s as me,v as de}from"./adOTzFDE.js";import{c as K}from"./B3KMLFeu.js";import{p as D,ai as ue,w as pe,z as b,a1 as R,a2 as u,a7 as l,u as a,Q as o,A as k,ae as S,a6 as fe,R as z,i as ge,c as O,h as P,r as N,a8 as B,T as xe,a4 as _e,E as i,W as be}from"./Cp_GvCOL.js";import{o as he,n as I,s as q}from"./CgOwER5m.js";import{_ as E}from"./Bml5z8l2.js";import{_ as ve}from"./Baq49nZQ.js";import{f as ye}from"./CE7u-7DH.js";import{u as we}from"./BCMcqMGM.js";import"./D7PB4JkZ.js";import"./C-fFc4Sm.js";import"./DnWsfCtc.js";import"./C6Y-ieo6.js";import"./De6cJ90F.js";import"./BrwH2_O0.js";import"./7ga_NNx6.js";import"./BHtpJmxp.js";import"./BlLzDdHJ.js";import"./CM1DIlR0.js";import"./K6pfE6CB.js";import"./B9BvCEkO.js";import"./DxT_AjaP.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DZaB2s8a.js";import"./DVCf4JVd.js";import"./BqeYyIoT.js";import"./DlAUqK2U.js";import"./_eNQqsN0.js";const ke={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},Ce={class:"flex items-center gap-2"},$e={class:"grid grid-cols-2 gap-4"},Ve={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},Ue={class:"flex items-center gap-2"},je={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},Fe={class:"flex items-center gap-2"},Me={class:"w-full"},Te={class:"flex flex-col items-center gap-2"},Re={class:"text-sm font-medium text-(--ui-text-highlighted)"},De={key:1,class:"relative group"},Pe={class:"border border-(--ui-border) rounded-lg overflow-hidden"},Be=["src"],Ie={class:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2 rounded-lg"},qe={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},Ee={class:"flex items-center gap-2"},Ke={class:"grid grid-cols-2 gap-4"},Se={class:"flex items-center justify-between p-3 rounded-lg border border-(--ui-border)"},ze=D({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(s,{emit:r}){const n=s,y=r,c=O({get:()=>n.dialog,set:p=>y("update:dialog",p)}),h=()=>{c.value=!1},w=ue("formRef"),v=P(),x=H(),j=he({title:q().nonempty("标题不能为空"),content:q().nonempty("内容不能为空"),ty:I().min(2,"类型不能为空"),state:I().min(2,"状态不能为空")}),d=[{label:"启用",value:2},{label:"禁用",value:4}],_=[{label:"系统",value:2},{label:"公告",value:3},{label:"营销",value:4}],t=N({loading:!1,uploading:!1,form:{}});function C(){v.value?.click()}const F=async p=>{const e=p.target,f=e.files?.[0];if(!e.files?.length||!f)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(f.type)){x.add({title:"请上传图片文件（jpg、png、gif、webp）",color:"error"});return}if(f.size>5*1024*1024){x.add({title:"图片大小不能超过 5MB",color:"error"});return}t.uploading=!0;try{const{data:g,error:V}=await Y({image:e.files[0]});!V&&g?(t.form.image=g.uri,x.add({title:"上传成功",color:"success"})):x.add({title:"上传失败",color:"error"})}catch{x.add({title:"上传失败",color:"error"})}finally{t.uploading=!1,e.value=""}},$=()=>{t.form.image=""};async function G(){t.loading=!0;try{const p=K(t.form),{error:e}=await(p.id?ne:ce)(p);e||(x.add({title:"操作成功",color:"success"}),h(),y("refresh"))}finally{t.loading=!1}}return pe(()=>n.dialog,p=>{p&&(t.loading=!1,t.uploading=!1,t.form=n.currentForm)}),(p,e)=>{const f=X,M=te,g=oe,V=ae,L=se,U=T,W=le,A=ie,J=re;return b(),R(J,{open:a(c),"onUpdate:open":e[7]||(e[7]=m=>ge(c)?c.value=m:null),title:s.currentForm.id?"修改消息":"新增消息",ui:{content:"sm:max-w-3xl",footer:"justify-end bg-(--ui-bg-elevated)"}},{body:u(()=>[l(A,{ref_key:"formRef",ref:w,schema:a(j),state:a(t).form,class:"space-y-5",onSubmit:G},{default:u(()=>[o("div",ke,[o("div",Ce,[l(f,{name:"i-lucide-info",class:"w-4 h-4 text-(--ui-primary)"}),e[8]||(e[8]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"基本信息",-1))]),o("div",$e,[l(g,{label:"消息类型",name:"ty",required:""},{default:u(()=>[l(M,{modelValue:a(t).form.ty,"onUpdate:modelValue":e[0]||(e[0]=m=>a(t).form.ty=m),items:_,placeholder:"请选择类型",class:"w-full"},null,8,["modelValue"])]),_:1}),l(g,{label:"消息状态",name:"state",required:""},{default:u(()=>[l(M,{modelValue:a(t).form.state,"onUpdate:modelValue":e[1]||(e[1]=m=>a(t).form.state=m),items:d,placeholder:"请选择状态",class:"w-full"},null,8,["modelValue"])]),_:1})]),l(g,{label:"消息标题",name:"title",required:""},{default:u(()=>[l(V,{modelValue:a(t).form.title,"onUpdate:modelValue":e[2]||(e[2]=m=>a(t).form.title=m),modelModifiers:{trim:!0},placeholder:"请输入消息标题",class:"w-full"},null,8,["modelValue"])]),_:1})]),o("div",Ve,[o("div",Ue,[l(f,{name:"i-lucide-file-text",class:"w-4 h-4 text-(--ui-info)"}),e[9]||(e[9]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"消息内容",-1))]),l(g,{label:"消息正文",name:"content",required:""},{default:u(()=>[l(L,{modelValue:a(t).form.content,"onUpdate:modelValue":e[3]||(e[3]=m=>a(t).form.content=m),"min-height":"200px"},null,8,["modelValue"])]),_:1})]),o("div",je,[o("div",Fe,[l(f,{name:"i-lucide-image",class:"w-4 h-4 text-(--ui-success)"}),e[10]||(e[10]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"宣传图",-1)),e[11]||(e[11]=o("span",{class:"text-xs text-(--ui-text-muted)"},"（可选）",-1))]),l(g,{name:"image"},{default:u(()=>[o("div",Me,[a(t).form.image?(b(),k("div",De,[o("div",Pe,[o("img",{src:a(t).form.image,alt:"宣传图",class:"w-full h-48 object-cover"},null,8,Be)]),o("div",Ie,[l(U,{icon:"i-lucide-refresh-cw",color:"neutral",variant:"solid",label:"更换",onClick:C}),l(U,{icon:"i-lucide-trash-2",color:"error",variant:"solid",label:"删除",onClick:$})])])):(b(),k("div",{key:0,class:"border-2 border-dashed border-(--ui-border) rounded-lg p-6 text-center cursor-pointer hover:border-(--ui-primary) hover:bg-(--ui-bg-elevated)/50 transition-all",onClick:C},[o("div",Te,[l(f,{name:a(t).uploading?"i-lucide-loader":"i-lucide-image-plus",class:S(["w-10 h-10 text-(--ui-text-muted)",{"animate-spin":a(t).uploading}])},null,8,["name","class"]),o("div",null,[o("p",Re,fe(a(t).uploading?"上传中...":"点击上传宣传图"),1),e[12]||(e[12]=o("p",{class:"text-xs text-(--ui-text-muted) mt-1"}," 支持 JPG、PNG、GIF、WebP，最大 5MB ",-1))])])])),o("input",{ref_key:"fileRef",ref:v,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",class:"hidden",onChange:F},null,544)])]),_:1})]),o("div",qe,[o("div",Ee,[l(f,{name:"i-lucide-bell-ring",class:"w-4 h-4 text-(--ui-warning)"}),e[13]||(e[13]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"弹框配置",-1))]),o("div",Ke,[o("div",Se,[e[14]||(e[14]=o("div",null,[o("p",{class:"text-sm font-medium text-(--ui-text-highlighted)"}," 是否弹框 "),o("p",{class:"text-xs text-(--ui-text-muted)"}," 开启后将定时弹出消息提示 ")],-1)),l(W,{"model-value":(a(t).form.tm??0)>0,"onUpdate:modelValue":e[4]||(e[4]=m=>a(t).form.tm=m?60:0)},null,8,["model-value"])]),(a(t).form.tm??0)>0?(b(),R(g,{key:0,label:"弹框间隔（秒）",name:"tm"},{default:u(()=>[l(V,{modelValue:a(t).form.tm,"onUpdate:modelValue":e[5]||(e[5]=m=>a(t).form.tm=m),modelModifiers:{number:!0},type:"number",min:"1",placeholder:"间隔秒数",class:"w-full"},null,8,["modelValue"])]),_:1})):z("",!0)])])]),_:1},8,["schema","state"])]),footer:u(()=>[l(U,{label:"取消",color:"neutral",variant:"outline",onClick:h}),l(U,{loading:a(t).loading,label:"确认",variant:"solid",onClick:e[6]||(e[6]=m=>a(w)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),Oe=Object.assign(ze,{__name:"CommonMessageEdit"}),Ne=["src","alt"],Ge={class:"relative max-w-[90vw] max-h-[90vh] p-4"},Le=["src","alt"],We=D({__name:"ImagePreview",props:{src:{},alt:{default:"图片"},width:{default:"w-16"},height:{default:"h-16"},class:{default:""}},setup(s){const r=s,n=P(!1),y=()=>{n.value=!0},c=()=>{n.value=!1},h=O(()=>[r.width,r.height,"object-cover rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:opacity-80 transition-opacity",r.class].filter(Boolean).join(" "));return(w,v)=>(b(),k("div",null,[o("img",{src:s.src,alt:s.alt,class:S(a(h)),onClick:y},null,10,Ne),(b(),R(_e,{to:"body"},[l(xe,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:u(()=>[a(n)?(b(),k("div",{key:0,class:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center cursor-pointer",onClick:c},[o("div",Ge,[o("button",{class:"absolute -top-2 -right-2 w-8 h-8 bg-white dark:bg-gray-800 rounded-full shadow-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center text-xl font-bold z-10 text-gray-900 dark:text-white",onClick:B(c,["stop"])}," ✕ "),o("img",{src:s.src,alt:s.alt,class:"max-w-full max-h-[85vh] rounded-lg shadow-2xl",onClick:v[0]||(v[0]=B(()=>{},["stop"]))},null,8,Le)])])):z("",!0)]),_:1})]))]))}}),Ae=Object.assign(We,{__name:"ImagePreview"}),Je={2:["启用","success"],4:["禁用","error"]},Qe={1:["互动消息","secondary"],2:["系统消息","primary"],3:["公告","info"],4:["营销","neutral"]},He=[{accessorKey:"id",header:"ID",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:s})=>i("span",{class:"text-(--ui-text-muted) font-mono text-sm"},`#${s.original.id}`)},{accessorKey:"title",searchPlaceholder:"筛选标题",header:"标题",cell:({row:s})=>i("div",{class:"flex items-center gap-2"},[i("span",{class:"i-lucide-message-square w-4 h-4 text-(--ui-primary)"}),i("span",{class:"font-medium text-(--ui-text-highlighted)"},s.original.title||"-")])},{accessorKey:"image",header:"宣传图",meta:{class:{th:"w-[120px]",td:"w-[120px]"}},cell:({row:s})=>s.original.image?i(Ae,{src:s.original.image,alt:"宣传图"}):i("span",{class:"text-(--ui-text-muted) text-sm"},"无图片")},{accessorKey:"content",header:"内容",cell:({row:s})=>{const n=(s.original.content||"").replace(/<[^>]*>/g,"").substring(0,50);return n?i(ve,{text:n},{default:()=>i("div",{class:"truncate max-w-[200px] text-(--ui-text-muted)"},n)}):i("span",{class:"text-(--ui-text-muted)"},"-")}},{accessorKey:"ty",header:"类型",formItemProps:{component:"Select",componentProps:{options:[{label:"互动消息",value:1},{label:"系统",value:2},{label:"公告",value:3},{label:"营销",value:4}]}},meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:s})=>{const[r,n]=Qe[s.original.ty]||["未知","neutral"];return i(E,{variant:"subtle",color:n},()=>r)}},{accessorKey:"state",header:"状态",formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:2},{label:"禁用",value:4}]}},meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:s})=>{const[r,n]=Je[s.original.state]||["未知","error"];return i(E,{variant:"subtle",color:n},()=>r)}},{accessorKey:"tm",header:"弹框间隔",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:s})=>{const r=s.original.tm;return!r||r<=0?i("span",{class:"text-(--ui-text-muted)"},"不弹框"):i("div",{class:"flex items-center gap-1"},[i("span",{class:"i-lucide-timer w-4 h-4 text-(--ui-warning)"}),i("span",{class:"text-(--ui-text-highlighted)"},`${r}秒`)])}},{accessorKey:"updated_at",header:"更新时间",meta:{class:{th:"w-[160px]",td:"w-[160px]"}},cell:({row:s})=>{const r=s.original.updated_at;return r?i("div",{class:"flex items-center gap-2"},[i("span",{class:"i-lucide-clock w-4 h-4 text-(--ui-text-muted)"}),i("span",{class:"text-sm"},ye(r))]):i("span",{class:"text-(--ui-text-muted)"},"-")}}],Et=D({name:"MessageList",__name:"message",setup(s){const r=P(),n=T,y=we(),c=N({isDialog:!1,currentForm:{}}),h=async d=>{c.isDialog=!0,d?c.currentForm=K(d):c.currentForm={state:2,ty:2,image:""}},w=async()=>{r.value.reload(),c.isDialog=!1},v=async d=>{const{error:_}=await de({id:d.id});_||r.value.reload()};function x(d){return[{label:"编辑",icon:"material-symbols:edit-square-outline",onSelect(){h(d.original)}},{type:"separator"},{label:"删除",icon:"material-symbols:contract-delete-outline-rounded",color:"error",onSelect(){y.open({color:"error",title:"删除数据",description:"您确定要删除这条消息吗？",onPositiveClick(){v(d.original)}})}}]}const j=[...He,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:d})=>i("div",{class:"text-right"},i(Q,{content:{align:"end"},items:x(d)},()=>i(T,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(d,_)=>{const t=Z,C=ee,F=Oe;return b(),k(be,null,[l(C,null,{actions:u(()=>[l(a(n),{label:"新增",icon:"i-lucide-plus",color:"neutral",onClick:_[0]||(_[0]=$=>h(null))})]),default:u(()=>[l(t,{ref_key:"tableRef",ref:r,"data-request":a(me),columns:j,"scroll-x":"min-w-[800px]"},null,8,["data-request"])]),_:1}),l(F,{dialog:a(c).isDialog,"onUpdate:dialog":_[1]||(_[1]=$=>a(c).isDialog=$),"current-form":a(c).currentForm,onRefresh:w},null,8,["dialog","current-form"])],64)}}});export{Et as default};
