import{w as P,_ as T,a as z}from"./DiI9-bkE.js";import{_ as Q}from"./Bml5z8l2.js";import{_ as W}from"./CuFgEFCp.js";import{_ as G}from"./oJBVUttf.js";import{_ as H}from"./BdKneTYw.js";import{_ as J}from"./_BOBmhmt.js";import{_ as K}from"./BkseHKFx.js";import{_ as X}from"./9B_i7pfW.js";import{_ as Y}from"./8gEztUrL.js";import{f as Z,h as ee,i as te,j as oe}from"./adOTzFDE.js";import{c as L}from"./B3KMLFeu.js";import{p as N,ai as se,w as le,z as c,a1 as q,a2 as a,a7 as t,u as l,Q as o,i as k,a6 as u,c as F,r as I,j as ne,A as x,W as R,ah as ie,a5 as M,R as D}from"./Cp_GvCOL.js";import{o as ae,n as y,s as B}from"./CgOwER5m.js";import{u as re}from"./BCMcqMGM.js";import"./CM1DIlR0.js";import"./BlLzDdHJ.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";import"./DZaB2s8a.js";import"./_eNQqsN0.js";import"./C-fFc4Sm.js";import"./DnWsfCtc.js";const de={class:"flex items-center gap-2"},me={class:"font-semibold"},ce={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},ue={class:"flex items-center gap-2"},fe={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},pe={class:"flex items-center gap-2"},_e={class:"grid grid-cols-2 gap-4"},ge={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},be={class:"flex items-center gap-2"},xe={class:"grid grid-cols-2 gap-4"},he={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},ve={class:"flex items-center gap-2"},ye={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},we={class:"flex items-center gap-2"},Ve={class:"flex items-center gap-8"},$e=N({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup($,{emit:C}){const i=$,h=C,_=F({get:()=>i.dialog,set:r=>h("update:dialog",r)}),w=()=>{_.value=!1},V=se("formRef"),d=P(),f=ae({title:B().nonempty("套餐名称不能为空"),content:B().optional(),coins:y().min(0,"能量不能小于0"),gift_coins:y().min(0,"赠送能量不能小于0").optional(),amount:y().min(0,"价格不能小于0"),sort:y().optional(),recommend_desc:B().optional(),state:y()}),s=I({loading:!1,form:{}}),g=F({get:()=>s.form.show===2,set:r=>{s.form.show=r?2:0}}),b=F({get:()=>s.form.state===2,set:r=>{s.form.state=r?2:4}});async function U(){s.loading=!0;try{const r=L(s.form);r.amount=Math.round(r.amount*100);const{error:e}=await(r.id?Z:ee)(r);e||(d.add({title:"操作成功",color:"success"}),w(),h("refresh"))}finally{s.loading=!1}}return le(()=>i.dialog,r=>{r&&(s.loading=!1,s.form={...i.currentForm,amount:i.currentForm.amount?i.currentForm.amount/100:0})}),(r,e)=>{const p=z,v=G,m=H,S=J,j=K,A=X,E=T,O=Y;return c(),q(O,{open:l(_),"onUpdate:open":e[10]||(e[10]=n=>k(_)?_.value=n:null),ui:{footer:"justify-end",content:"sm:max-w-xl"}},{header:a(()=>[o("div",de,[t(p,{name:"i-lucide-package",class:"w-5 h-5 text-(--ui-primary)"}),o("span",me,u($.currentForm.id?"修改套餐":"新增套餐"),1)])]),body:a(()=>[t(A,{ref_key:"formRef",ref:V,schema:l(f),state:l(s).form,class:"space-y-5",onSubmit:U},{default:a(()=>[o("div",ce,[o("div",ue,[t(p,{name:"i-lucide-info",class:"w-4 h-4 text-(--ui-primary)"}),e[11]||(e[11]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"基本信息",-1))]),t(m,{label:"套餐名称",name:"title",required:""},{default:a(()=>[t(v,{modelValue:l(s).form.title,"onUpdate:modelValue":e[0]||(e[0]=n=>l(s).form.title=n),modelModifiers:{trim:!0},placeholder:"请输入套餐名称",class:"w-full"},null,8,["modelValue"])]),_:1})]),o("div",fe,[o("div",pe,[t(p,{name:"i-lucide-zap",class:"w-4 h-4 text-(--ui-warning)"}),e[12]||(e[12]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"能量配置",-1))]),o("div",_e,[t(m,{label:"能量数",name:"coins",required:""},{default:a(()=>[t(v,{modelValue:l(s).form.coins,"onUpdate:modelValue":e[1]||(e[1]=n=>l(s).form.coins=n),modelModifiers:{number:!0},placeholder:"请输入",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),t(m,{label:"赠送能量",name:"gift_coins"},{default:a(()=>[t(v,{modelValue:l(s).form.gift_coins,"onUpdate:modelValue":e[2]||(e[2]=n=>l(s).form.gift_coins=n),modelModifiers:{number:!0},placeholder:"请输入",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1})])]),o("div",ge,[o("div",be,[t(p,{name:"i-lucide-coins",class:"w-4 h-4 text-(--ui-success)"}),e[13]||(e[13]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"价格配置",-1))]),o("div",xe,[t(m,{label:"价格",name:"amount",required:""},{default:a(()=>[t(v,{modelValue:l(s).form.amount,"onUpdate:modelValue":e[3]||(e[3]=n=>l(s).form.amount=n),modelModifiers:{number:!0},placeholder:"请输入",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),t(m,{label:"排序",name:"sort"},{default:a(()=>[t(v,{modelValue:l(s).form.sort,"onUpdate:modelValue":e[4]||(e[4]=n=>l(s).form.sort=n),modelModifiers:{number:!0},placeholder:"数值越大越靠前",type:"number",class:"w-full"},null,8,["modelValue"])]),_:1})])]),o("div",he,[o("div",ve,[t(p,{name:"i-lucide-file-text",class:"w-4 h-4 text-(--ui-info)"}),e[14]||(e[14]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"套餐详情",-1))]),t(m,{label:"推荐标签",name:"recommend_desc"},{default:a(()=>[t(v,{modelValue:l(s).form.recommend_desc,"onUpdate:modelValue":e[5]||(e[5]=n=>l(s).form.recommend_desc=n),modelModifiers:{trim:!0},placeholder:"如：更划算、限时特惠",class:"w-full"},null,8,["modelValue"])]),_:1}),t(m,{label:"描述",name:"content"},{default:a(()=>[t(S,{modelValue:l(s).form.content,"onUpdate:modelValue":e[6]||(e[6]=n=>l(s).form.content=n),modelModifiers:{trim:!0},placeholder:"请输入套餐描述",class:"w-full",rows:2},null,8,["modelValue"])]),_:1})]),o("div",ye,[o("div",we,[t(p,{name:"i-lucide-settings",class:"w-4 h-4 text-(--ui-warning)"}),e[15]||(e[15]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"状态配置",-1))]),o("div",Ve,[t(m,{label:"是否显示",name:"show"},{default:a(()=>[t(j,{modelValue:l(g),"onUpdate:modelValue":e[7]||(e[7]=n=>k(g)?g.value=n:null)},null,8,["modelValue"])]),_:1}),t(m,{label:"是否启用",name:"state"},{default:a(()=>[t(j,{modelValue:l(b),"onUpdate:modelValue":e[8]||(e[8]=n=>k(b)?b.value=n:null)},null,8,["modelValue"])]),_:1})])])]),_:1},8,["schema","state"])]),footer:a(()=>[t(E,{label:"取消",color:"neutral",variant:"outline",onClick:w}),t(E,{loading:l(s).loading,label:"确认",variant:"solid",onClick:e[9]||(e[9]=n=>l(V)?.submit())},null,8,["loading"])]),_:1},8,["open"])}}}),Ce=Object.assign($e,{__name:"CommonCoinsEdit"}),Ue={key:0,class:"flex items-center justify-center py-20"},ke={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 items-stretch"},Fe={class:"flex items-center gap-2 mb-3"},Me={class:"font-semibold text-lg text-(--ui-text-highlighted)"},De={class:"flex items-baseline gap-2 mb-2"},Be={class:"flex items-center gap-1"},je={class:"text-2xl font-bold text-(--ui-text-highlighted)"},Ee={key:0,class:"text-sm text-(--ui-success)"},Re={class:"text-xl font-bold text-(--ui-primary) mb-3"},Te={class:"text-sm text-(--ui-text-muted) mb-4 line-clamp-2"},ze={class:"flex items-center justify-between pt-3 border-t border-(--ui-border)"},Le={class:"flex items-center gap-2"},Ne={class:"flex gap-1"},qe={key:2,class:"text-center py-20 text-(--ui-text-muted)"},ct=N({name:"CoinsList",__name:"coins",setup($){const C=re(),i=I({isDialog:!1,currentForm:{},loading:!1,list:[]}),h=async()=>{i.loading=!0;try{const{data:d}=await te();i.list=d?.list||[]}finally{i.loading=!1}},_=d=>{i.currentForm=d?L(d):{state:2,sort:0},i.isDialog=!0},w=()=>{i.isDialog=!1,h()},V=d=>{C.open({color:"error",title:"删除套餐",description:`确定要删除「${d.title}」吗？`,onPositiveClick:async()=>{const{error:f}=await oe({id:d.id});f||h()}})};return ne(()=>h()),(d,f)=>{const s=T,g=z,b=Q,U=W,r=Ce;return c(),x(R,null,[t(U,null,{actions:a(()=>[t(s,{label:"新增套餐",icon:"i-lucide-plus",color:"neutral",onClick:f[0]||(f[0]=e=>_())})]),default:a(()=>[l(i).loading?(c(),x("div",Ue,[t(g,{name:"i-lucide-loader",class:"w-8 h-8 animate-spin text-(--ui-text-muted)"})])):(c(),x("div",ke,[(c(!0),x(R,null,ie(l(i).list,e=>(c(),x("div",{key:e.id,class:"relative p-4 rounded-xl bg-(--ui-bg-elevated) border border-(--ui-border) hover:border-(--ui-primary) transition-all group h-full flex flex-col"},[e.recommend_desc?(c(),q(b,{key:0,variant:"solid",color:"warning",class:"absolute -top-2 -right-2 text-xs"},{default:a(()=>[M(u(e.recommend_desc),1)]),_:2},1024)):D("",!0),o("div",Fe,[t(g,{name:"i-lucide-package",class:"w-5 h-5 text-(--ui-primary)"}),o("span",Me,u(e.title),1)]),o("div",De,[o("div",Be,[t(g,{name:"i-lucide-zap",class:"w-4 h-4 text-(--ui-warning)"}),o("span",je,u(e.coins),1)]),e.gift_coins?(c(),x("span",Ee,"+"+u(e.gift_coins)+" 赠送",1)):D("",!0)]),o("div",Re," ¥"+u((e.amount/100).toFixed(2)),1),o("p",Te,u(e.content||"暂无描述"),1),o("div",ze,[o("div",Le,[t(b,{color:e.state===2?"success":"error",variant:"subtle"},{default:a(()=>[M(u(e.state===2?"启用":"关闭"),1)]),_:2},1032,["color"]),t(b,{color:e.show===2?"info":"neutral",variant:"subtle"},{default:a(()=>[M(u(e.show===2?"显示":"隐藏"),1)]),_:2},1032,["color"])]),o("div",Ne,[t(s,{size:"xs",color:"neutral",variant:"ghost",icon:"i-lucide-pencil",onClick:p=>_(e)},null,8,["onClick"]),t(s,{size:"xs",color:"error",variant:"ghost",icon:"i-lucide-trash-2",onClick:p=>V(e)},null,8,["onClick"])])])]))),128))])),!l(i).loading&&l(i).list.length===0?(c(),x("div",qe," 暂无能量套餐 ")):D("",!0)]),_:1}),t(r,{dialog:l(i).isDialog,"onUpdate:dialog":f[1]||(f[1]=e=>l(i).isDialog=e),"current-form":l(i).currentForm,onRefresh:w},null,8,["dialog","current-form"])],64)}}});export{ct as default};
