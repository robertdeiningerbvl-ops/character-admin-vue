import{_ as B,a as I,b as K,c as T}from"./DAqc9GYg.js";import{f as F,c as R,ap as E,aE as q,j as M,l as j,a as P,o as k,w as r,B as o,_ as V,b as t,a4 as N,aF as D,i as S,k as U,A,C as G,D as L,G as O}from"./DhOLkSnF.js";import{_ as z}from"./CSbqei5V.js";import{_ as H}from"./DAIKkUkW.js";import{_ as J}from"./DAeRr84W.js";import{_ as Q}from"./Db__RPjw.js";import{_ as W}from"./BZLiX_8y.js";import{h as X,i as Y}from"./CzWoDhk-.js";import{c as C}from"./45RcOEEf.js";import{o as Z,s as ee,n as w}from"./B-mCBPct.js";import{u as oe,b as te}from"./Bo5OMT4U.js";import{_ as ae}from"./-rcGzxkB.js";import{f as $}from"./BmKy9gZZ.js";import"./CLKxJTZi.js";import"./D0vBe5Vh.js";import"./CZg69nbc.js";import"./BrXYpapi.js";import"./CwtpYSSp.js";import"./BXSyqGa5.js";import"./HRiyi1uV.js";const se=F({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(l,{emit:_}){const m=l,c=_,s=R({get:()=>m.dialog,set:i=>c("update:dialog",i)}),p=()=>{s.value=!1},b=E("formRef"),h=q(),x=Z({limit:w().min(0),num:w().min(0),coins:w().min(0),tm:ee().nonempty()}),e=M({loading:!1,form:{}});async function g(){e.loading=!0;try{const i=C(e.form),{error:a}=await X(i);a||(h.add({title:"操作成功",color:"success"}),p(),c("refresh"))}finally{e.loading=!1}}return j(()=>m.dialog,i=>{i&&(e.form=C(m.currentForm),e.loading=!1)}),(i,a)=>{const d=H,u=J,v=Q,y=V,f=W;return k(),P(f,{open:t(s),"onUpdate:open":a[5]||(a[5]=n=>N(s)?s.value=n:null),title:l.currentForm.id?"修改":"新增",dismissible:!1,ui:{footer:"justify-end"}},{body:r(()=>[o(v,{ref_key:"formRef",ref:b,schema:t(x),state:t(e).form,class:"flex flex-col gap-4",onSubmit:g},{default:r(()=>[o(u,{label:"生成数量",name:"num",required:""},{default:r(()=>[o(d,{modelValue:t(e).form.num,"onUpdate:modelValue":a[0]||(a[0]=n=>t(e).form.num=n),modelModifiers:{trim:!0},placeholder:"请输入生成数量",type:"number",class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"限领次数",name:"limit",required:""},{default:r(()=>[o(d,{modelValue:t(e).form.limit,"onUpdate:modelValue":a[1]||(a[1]=n=>t(e).form.limit=n),modelModifiers:{trim:!0},placeholder:"请输入限领次数",type:"number",class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"能量",name:"coins",required:""},{default:r(()=>[o(d,{modelValue:t(e).form.coins,"onUpdate:modelValue":a[2]||(a[2]=n=>t(e).form.coins=n),modelModifiers:{trim:!0},placeholder:"请输入能量值",type:"number",class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"过期时间",name:"tm",required:""},{default:r(()=>[o(d,{modelValue:t(e).form.tm,"onUpdate:modelValue":a[3]||(a[3]=n=>t(e).form.tm=n),modelModifiers:{trim:!0},placeholder:"请选择过期时间",type:"datetime-local",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["schema","state"])]),footer:r(()=>[o(y,{label:"取消",color:"neutral",variant:"outline",onClick:p}),o(y,{loading:t(e).loading,label:"确认",color:"primary",variant:"solid",onClick:a[4]||(a[4]=n=>t(b)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),re=Object.assign(se,{__name:"MemberInvitationEdit"}),ne={0:["未使用","warning"],2:["已使用","success"]},le=[{label:"未使用",value:0},{label:"已使用",value:2}],ie=[{accessorKey:"id",header:()=>D(V,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"}),meta:{class:{th:"w-[80px]",td:"w-[80px]"}}},{accessorKey:"uid",header:"用户ID",searchPlaceholder:"请输入用户ID"},{accessorKey:"order_sn",header:"订单号",searchPlaceholder:"请输入订单号",meta:{class:{th:"w-[280px]"}}},{accessorKey:"code",header:"兑换码"},{accessorKey:"coins",header:"能量"},{accessorKey:"limit",header:"使用次数"},{accessorKey:"state",header:"使用状态",formItemProps:{component:"Select",componentProps:{options:le}},cell:({row:l})=>{const _=l.original.state,[m,c]=ne[_]||["未知","warning"];return D(ae,{class:"capitalize",variant:"subtle",color:c},()=>m)}},{accessorKey:"expire",header:"有效期",meta:{class:{th:"w-[180px]"}},cell:({row:l})=>$(l.original.expire)},{accessorKey:"created_at",header:"创建时间",meta:{class:{th:"w-[180px]"}},cell:({row:l})=>$(l.original.created_at)}],me={key:0,class:"absolute top-0 left-0 right-0 h-(--ui-header-height) flex items-center justify-between border-b border-(--ui-border) px-4 sm:px-6 bg-(--ui-bg)"},ce={class:"flex items-center gap-4"},Be=F({name:"InvitationCodeList",__name:"invitation-code",setup(l){const m=oe(te).smaller("lg"),c=S(),s=M({isDialog:!1,currentForm:{}}),p=x=>{s.currentForm={state:2},s.isDialog=!0},b=()=>{c.value?.reload(),s.isDialog=!1},h=[...ie,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}}}];return(x,e)=>{const g=I,i=V,a=B,d=K,u=z,v=T,y=re;return k(),U(O,null,[o(v,{ui:{body:"pb-[12px]! gap-0!"}},A({body:r(()=>[t(m)?G("",!0):(k(),U("div",me,[L("div",ce,[o(g),o(d)]),o(i,{label:"添加兑换码",icon:"i-lucide-plus",color:"primary",onClick:e[1]||(e[1]=f=>p())})])),o(u,{ref_key:"tableRef",ref:c,"data-request":t(Y),columns:h,"scroll-x":"min-w-[1400px]"},null,8,["data-request"])]),_:2},[t(m)?{name:"header",fn:r(()=>[o(a,{title:"兑换卡列表"},{leading:r(()=>[o(g)]),right:r(()=>[o(i,{label:"添加兑换码",icon:"i-lucide-plus",color:"primary",onClick:e[0]||(e[0]=f=>p())})]),_:1})]),key:"0"}:void 0]),1024),o(y,{dialog:t(s).isDialog,"onUpdate:dialog":e[2]||(e[2]=f=>t(s).isDialog=f),"current-form":t(s).currentForm,onRefresh:b},null,8,["dialog","current-form"])],64)}}});export{Be as default};
