import{w as K,_ as q,a as S}from"./DiI9-bkE.js";import{_ as P}from"./Bml5z8l2.js";import{_ as X}from"./CuFgEFCp.js";import{_ as Y}from"./oJBVUttf.js";import{_ as Z}from"./BdKneTYw.js";import{_ as ee}from"./_BOBmhmt.js";import{_ as te}from"./BkseHKFx.js";import{_ as oe}from"./9B_i7pfW.js";import{_ as se}from"./8gEztUrL.js";import{w as le,x as ae}from"./adOTzFDE.js";import{c as j}from"./B3KMLFeu.js";import{p as L,ai as ne,w as ie,z as m,a1 as re,a2 as r,a7 as t,u as s,Q as o,A as u,W as B,ah as O,a6 as c,R as D,i as C,c as F,r as E,j as de,a5 as N}from"./Cp_GvCOL.js";import{o as me,s as R,n as V}from"./CgOwER5m.js";import"./CM1DIlR0.js";import"./BlLzDdHJ.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";import"./DZaB2s8a.js";import"./_eNQqsN0.js";import"./C-fFc4Sm.js";import"./DnWsfCtc.js";const ue={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},ce={class:"flex items-center gap-2"},fe={class:"grid grid-cols-2 gap-4"},pe={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},_e={class:"flex items-center gap-2"},ge={class:"grid grid-cols-3 gap-4"},be={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},xe={class:"flex items-center gap-2"},he={key:0,class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},ye={class:"flex items-center gap-2"},ve={class:"grid grid-cols-7 gap-3"},we={class:"text-xs text-(--ui-text-muted) mb-2"},ke={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},Ve={class:"flex items-center gap-2"},$e={class:"flex items-center gap-8"},Ue=L({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup($,{emit:i}){const b=$,U=i,x=F({get:()=>b.dialog,set:d=>U("update:dialog",d)}),f=()=>{x.value=!1},_=ne("formRef"),g=K(),M=me({name:R().nonempty("任务名称不能为空"),code:R().nonempty("任务编码不能为空"),battery:V().min(0,"奖励电量不能小于0"),num:V().min(0,"需要次数不能小于0"),amount:V().min(0,"奖励金额不能小于0"),show:V(),state:V(),content:R().optional()}),l=E({loading:!1,form:{}}),v=F({get:()=>l.form.show===2,set:d=>{l.form.show=d?2:0}}),w=F({get:()=>l.form.state===2,set:d=>{l.form.state=d?2:0}}),n=F(()=>l.form.code==="QD"),h=E({1:100,2:100,3:100,4:100,5:100,6:100,7:100}),z=[{key:"1",label:"第1天"},{key:"2",label:"第2天"},{key:"3",label:"第3天"},{key:"4",label:"第4天"},{key:"5",label:"第5天"},{key:"6",label:"第6天"},{key:"7",label:"第7天"}];function J(){if(l.form.content&&n.value)try{const d=JSON.parse(l.form.content);Object.keys(h).forEach(e=>{h[e]=d[e]??100})}catch{}}async function Q(){l.loading=!0;try{const d=j(l.form);n.value&&(d.content=JSON.stringify(h));const{error:e}=await le(d);e||(g.add({title:"操作成功",color:"success"}),f(),U("refresh"))}finally{l.loading=!1}}return ie(()=>b.dialog,d=>{d&&(l.form=j(b.currentForm),l.loading=!1,J())}),(d,e)=>{const k=S,y=Y,p=Z,A=ee,T=te,W=oe,I=q,G=se;return m(),re(G,{open:s(x),"onUpdate:open":e[9]||(e[9]=a=>C(x)?x.value=a:null),title:$.currentForm.id?"编辑营销任务":"新增营销任务",ui:{content:"sm:max-w-2xl",footer:"justify-end bg-(--ui-bg-elevated)"}},{body:r(()=>[t(W,{ref_key:"formRef",ref:_,schema:s(M),state:s(l).form,class:"space-y-5",onSubmit:Q},{default:r(()=>[o("div",ue,[o("div",ce,[t(k,{name:"i-lucide-info",class:"w-4 h-4 text-(--ui-primary)"}),e[10]||(e[10]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"基本信息",-1))]),o("div",fe,[t(p,{label:"任务名称",name:"name",required:""},{default:r(()=>[t(y,{modelValue:s(l).form.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s(l).form.name=a),modelModifiers:{trim:!0},placeholder:"如：每日签到",class:"w-full"},null,8,["modelValue"])]),_:1}),t(p,{label:"任务编码",name:"code",required:""},{default:r(()=>[t(y,{modelValue:s(l).form.code,"onUpdate:modelValue":e[1]||(e[1]=a=>s(l).form.code=a),modelModifiers:{trim:!0},placeholder:"如：daily_checkin",class:"w-full",disabled:!!$.currentForm.id},null,8,["modelValue","disabled"])]),_:1})])]),o("div",pe,[o("div",_e,[t(k,{name:"i-lucide-gift",class:"w-4 h-4 text-(--ui-success)"}),e[11]||(e[11]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"奖励配置",-1))]),o("div",ge,[t(p,{label:"奖励电量",name:"battery",required:""},{default:r(()=>[t(y,{modelValue:s(l).form.battery,"onUpdate:modelValue":e[2]||(e[2]=a=>s(l).form.battery=a),modelModifiers:{number:!0},placeholder:"电量值",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),t(p,{label:"需要次数",name:"num",required:""},{default:r(()=>[t(y,{modelValue:s(l).form.num,"onUpdate:modelValue":e[3]||(e[3]=a=>s(l).form.num=a),modelModifiers:{number:!0},placeholder:"完成次数",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),t(p,{label:"奖励金额",name:"amount",required:""},{default:r(()=>[t(y,{modelValue:s(l).form.amount,"onUpdate:modelValue":e[4]||(e[4]=a=>s(l).form.amount=a),modelModifiers:{number:!0},placeholder:"金额",type:"number",min:"0",step:"0.01",class:"w-full"},null,8,["modelValue"])]),_:1})])]),o("div",be,[o("div",xe,[t(k,{name:"i-lucide-file-text",class:"w-4 h-4 text-(--ui-info)"}),e[12]||(e[12]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"任务详情",-1))]),t(p,{label:"任务描述",name:"remark"},{default:r(()=>[t(A,{modelValue:s(l).form.remark,"onUpdate:modelValue":e[5]||(e[5]=a=>s(l).form.remark=a),placeholder:"请输入任务描述信息",rows:2,class:"w-full"},null,8,["modelValue"])]),_:1})]),s(n)?(m(),u("div",he,[o("div",ye,[t(k,{name:"i-lucide-calendar-check",class:"w-4 h-4 text-(--ui-success)"}),e[13]||(e[13]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"签到奖励配置",-1)),e[14]||(e[14]=o("span",{class:"text-xs text-(--ui-text-muted)"},"（每日签到奖励电量）",-1))]),o("div",ve,[(m(),u(B,null,O(z,a=>o("div",{key:a.key,class:"text-center"},[o("p",we,c(a.label),1),t(y,{modelValue:s(h)[a.key],"onUpdate:modelValue":H=>s(h)[a.key]=H,modelModifiers:{number:!0},type:"number",min:"0",class:"w-full text-center"},null,8,["modelValue","onUpdate:modelValue"])])),64))])])):D("",!0),o("div",ke,[o("div",Ve,[t(k,{name:"i-lucide-settings",class:"w-4 h-4 text-(--ui-warning)"}),e[15]||(e[15]=o("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"状态配置",-1))]),o("div",$e,[t(p,{label:"是否显示",name:"show"},{default:r(()=>[t(T,{modelValue:s(v),"onUpdate:modelValue":e[6]||(e[6]=a=>C(v)?v.value=a:null)},null,8,["modelValue"])]),_:1}),t(p,{label:"是否启用",name:"state"},{default:r(()=>[t(T,{modelValue:s(w),"onUpdate:modelValue":e[7]||(e[7]=a=>C(w)?w.value=a:null)},null,8,["modelValue"])]),_:1})])])]),_:1},8,["schema","state"])]),footer:r(()=>[t(I,{label:"取消",color:"neutral",variant:"outline",onClick:f}),t(I,{loading:s(l).loading,label:"确认",color:"primary",variant:"solid",onClick:e[8]||(e[8]=a=>s(_)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),Me=Object.assign(Ue,{__name:"MarketingEdit"}),Fe={key:0,class:"flex items-center justify-center py-20"},De={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 items-stretch"},Ce={class:"flex items-center justify-between mb-3"},Re={class:"flex items-center gap-2"},je={class:"font-semibold text-lg text-(--ui-text-highlighted)"},Be={class:"px-2 py-1 rounded bg-(--ui-bg) text-xs font-mono text-(--ui-text-muted)"},Ee={class:"flex items-center gap-4 mb-3"},Te={key:0,class:"flex items-center gap-1"},Ie={class:"font-bold text-(--ui-text-highlighted)"},Ne={key:1,class:"flex items-center gap-1"},qe={class:"font-bold text-(--ui-success)"},Se={class:"flex items-center gap-1"},Le={class:"text-sm text-(--ui-text-muted)"},Oe={class:"text-sm text-(--ui-text-muted) mb-4 line-clamp-2 flex-1"},ze={class:"flex items-center justify-between pt-3 border-t border-(--ui-border)"},Je={class:"flex items-center gap-2"},Qe={key:2,class:"text-center py-20 text-(--ui-text-muted)"},_t=L({name:"MarketingList",__name:"list",setup($){const i=E({isDialog:!1,currentForm:{},loading:!1,list:[]}),b=async()=>{i.loading=!0;try{const{data:f}=await ae();i.list=f?.list||[]}finally{i.loading=!1}},U=f=>{i.currentForm=f?j(f):{},i.isDialog=!0},x=()=>{i.isDialog=!1,b()};return de(()=>b()),(f,_)=>{const g=S,M=P,l=q,v=X,w=Me;return m(),u(B,null,[t(v,null,{default:r(()=>[s(i).loading?(m(),u("div",Fe,[t(g,{name:"i-lucide-loader",class:"w-8 h-8 animate-spin text-(--ui-text-muted)"})])):(m(),u("div",De,[(m(!0),u(B,null,O(s(i).list,n=>(m(),u("div",{key:n.id,class:"relative p-4 rounded-xl bg-(--ui-bg-elevated) border border-(--ui-border) hover:border-(--ui-primary) transition-all group h-full flex flex-col"},[o("div",Ce,[o("div",Re,[t(g,{name:"i-lucide-zap",class:"w-5 h-5 text-(--ui-warning)"}),o("span",je,c(n.name),1)]),o("code",Be,c(n.code),1)]),o("div",Ee,[n.battery?(m(),u("div",Te,[t(g,{name:"i-lucide-battery-charging",class:"w-4 h-4 text-(--ui-warning)"}),o("span",Ie,c(n.battery),1),_[1]||(_[1]=o("span",{class:"text-xs text-(--ui-text-muted)"},"电量",-1))])):D("",!0),n.amount?(m(),u("div",Ne,[t(g,{name:"i-lucide-coins",class:"w-4 h-4 text-(--ui-success)"}),o("span",qe,"¥"+c(n.amount),1)])):D("",!0),o("div",Se,[t(g,{name:"i-lucide-repeat",class:"w-4 h-4 text-(--ui-text-muted)"}),o("span",Le,c(n.num||0)+" 次",1)])]),o("p",Oe,c(n.remark||"暂无描述"),1),o("div",ze,[o("div",Je,[t(M,{color:n.state===2?"success":"error",variant:"subtle"},{default:r(()=>[N(c(n.state===2?"启用":"关闭"),1)]),_:2},1032,["color"]),t(M,{color:n.show===2?"info":"neutral",variant:"subtle"},{default:r(()=>[N(c(n.show===2?"显示":"隐藏"),1)]),_:2},1032,["color"])]),t(l,{size:"xs",color:"neutral",variant:"ghost",icon:"i-lucide-pencil",onClick:h=>U(n)},null,8,["onClick"])])]))),128))])),!s(i).loading&&s(i).list.length===0?(m(),u("div",Qe," 暂无营销规则 ")):D("",!0)]),_:1}),t(w,{dialog:s(i).isDialog,"onUpdate:dialog":_[0]||(_[0]=n=>s(i).isDialog=n),"current-form":s(i).currentForm,onRefresh:x},null,8,["dialog","current-form"])],64)}}});export{_t as default};
