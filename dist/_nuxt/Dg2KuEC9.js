import{w as R,_ as j,a as B,n as S}from"./DiI9-bkE.js";import{_ as q}from"./Bml5z8l2.js";import{_ as A}from"./CuFgEFCp.js";import{_ as G}from"./DkYr1hfb.js";import{_ as P}from"./BdKneTYw.js";import{_ as Q}from"./oJBVUttf.js";import{_ as W}from"./_BOBmhmt.js";import{_ as H}from"./BkseHKFx.js";import{_ as J}from"./9B_i7pfW.js";import{_ as K}from"./8gEztUrL.js";import{e as X,D as Y,E as Z,F as ee,G as oe}from"./adOTzFDE.js";import{c as U}from"./B3KMLFeu.js";import{p as I,ai as te,w as se,z as u,a1 as ne,a2 as d,a7 as n,u as t,Q as a,i as D,a6 as c,c as z,r as E,j as ae,A as b,W as F,ah as ie,a5 as le,R as L}from"./Cp_GvCOL.js";import{f as re}from"./CE7u-7DH.js";import{u as de}from"./BCMcqMGM.js";import"./CM1DIlR0.js";import"./BlLzDdHJ.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./D7PB4JkZ.js";import"./DZaB2s8a.js";import"./C-fFc4Sm.js";import"./De6cJ90F.js";import"./DnWsfCtc.js";import"./DVCf4JVd.js";import"./_eNQqsN0.js";const me={class:"flex items-center gap-2"},ce={class:"font-semibold"},ue={class:"grid grid-cols-2 gap-4"},fe={class:"flex items-center h-9"},pe={class:"ml-2 text-sm"},_e=I({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})},bizId:{}},emits:["update:dialog","refresh"],setup(v,{emit:w}){const f=v,T=w,p=z({get:()=>f.dialog,set:o=>T("update:dialog",o)}),x=()=>{p.value=!1},l=te("formRef"),y=R(),_=z({get:()=>e.form.state===2,set:o=>{e.form.state=o?2:4}}),e=E({loading:!1,form:{},modelOptions:[],modelLoading:!1}),$=async()=>{e.modelLoading=!0;const{data:o}=await X({});o&&(e.modelOptions=o.list.map(s=>({label:s.name,value:s.id}))),e.modelLoading=!1};async function m(){e.loading=!0;try{const o=U(e.form),{error:s}=await(o.id?Y:Z)(o);s||(y.add({title:"保存成功",color:"success"}),x(),T("refresh"))}finally{e.loading=!1}}return se(()=>f.dialog,o=>{o&&(e.loading=!1,e.form=U(f.currentForm),!e.form.id&&f.bizId&&(e.form.biz_id=Number(f.bizId)),$())}),(o,s)=>{const k=B,C=G,g=P,h=Q,i=W,V=H,N=J,M=j,O=K;return u(),ne(O,{open:t(p),"onUpdate:open":s[6]||(s[6]=r=>D(p)?p.value=r:null),ui:{content:"sm:max-w-lg",footer:"justify-end"}},{header:d(()=>[a("div",me,[n(k,{name:"i-lucide-key",class:"w-5 h-5 text-(--ui-primary)"}),a("span",ce,c(v.currentForm.id?"编辑 Token":"新建 Token"),1)])]),body:d(()=>[n(N,{ref_key:"formRef",ref:l,state:t(e).form,class:"space-y-4",onSubmit:m},{default:d(()=>[n(g,{label:"关联模型",name:"biz_id",required:""},{default:d(()=>[n(C,{modelValue:t(e).form.biz_id,"onUpdate:modelValue":s[0]||(s[0]=r=>t(e).form.biz_id=r),items:t(e).modelOptions,loading:t(e).modelLoading,placeholder:"选择模型",disabled:!!v.bizId},null,8,["modelValue","items","loading","disabled"])]),_:1}),a("div",ue,[n(g,{label:"最大 Token 数",name:"max_token",required:""},{default:d(()=>[n(h,{modelValue:t(e).form.max_token,"onUpdate:modelValue":s[1]||(s[1]=r=>t(e).form.max_token=r),modelModifiers:{number:!0},type:"number",min:0,placeholder:"输入最大 Token"},null,8,["modelValue"])]),_:1}),n(g,{label:"每次消耗电量",name:"battery"},{default:d(()=>[n(h,{modelValue:t(e).form.battery,"onUpdate:modelValue":s[2]||(s[2]=r=>t(e).form.battery=r),modelModifiers:{number:!0},type:"number",min:0,placeholder:"输入消耗电量"},null,8,["modelValue"])]),_:1})]),n(g,{label:"说明",name:"description"},{default:d(()=>[n(i,{modelValue:t(e).form.description,"onUpdate:modelValue":s[3]||(s[3]=r=>t(e).form.description=r),modelModifiers:{trim:!0},placeholder:"输入说明",rows:2,autoresize:"",class:"w-full"},null,8,["modelValue"])]),_:1}),n(g,{label:"状态",name:"state"},{default:d(()=>[a("div",fe,[n(V,{modelValue:t(_),"onUpdate:modelValue":s[4]||(s[4]=r=>D(_)?_.value=r:null)},null,8,["modelValue"]),a("span",pe,c(t(_)?"启用":"关闭"),1)])]),_:1})]),_:1},8,["state"])]),footer:d(()=>[n(M,{label:"取消",color:"neutral",variant:"outline",onClick:x}),n(M,{loading:t(e).loading,label:"保存",onClick:s[5]||(s[5]=r=>t(l)?.submit())},null,8,["loading"])]),_:1},8,["open"])}}}),ge=Object.assign(_e,{__name:"CommonModelTokenEdit"}),be={key:0,class:"flex items-center justify-center py-20"},xe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ye={class:"flex items-center justify-between mb-3"},ke={class:"flex items-center gap-2"},ve={class:"w-8 h-8 rounded-lg bg-(--ui-primary)/10 flex items-center justify-center"},Te={class:"font-medium"},he={class:"text-xs text-(--ui-text-muted)"},we={class:"space-y-2 text-xs mb-3"},$e={class:"flex items-center justify-between"},Ce={class:"font-medium"},Ve={class:"flex items-center justify-between"},Ue={class:"font-medium text-yellow-500"},ze={key:0,class:"text-xs text-(--ui-text-muted) mb-3 line-clamp-2"},Me={class:"text-xs text-(--ui-text-muted) mb-3"},De={class:"flex items-center gap-2 pt-3 border-t border-(--ui-border)"},Fe={key:2,class:"text-center py-20 text-(--ui-text-muted)"},lo=I({name:"CommonModelTokenList",__name:"[id]",setup(v){const w=S(),f=de(),T=R(),p=z(()=>w.params.id),x={2:["启用","success"],4:["关闭","error"]},l=E({loading:!1,list:[],isDialog:!1,currentForm:{}}),y=async()=>{l.loading=!0;try{const{data:m}=await ee({biz_id:p.value});l.list=m?.list||[]}finally{l.loading=!1}},_=m=>{l.currentForm=m?U(m):{state:2},l.isDialog=!0},e=async m=>{f.open({color:"error",title:"删除 Token",description:"确定要删除该 Token 配置吗？",onPositiveClick:async()=>{const{error:o}=await oe({id:m.id});o||(T.add({title:"删除成功",color:"success"}),y())}})},$=()=>{l.isDialog=!1,y()};return ae(()=>y()),(m,o)=>{const s=j,k=B,C=q,g=A,h=ge;return u(),b(F,null,[n(g,null,{actions:d(()=>[n(s,{icon:"i-lucide-arrow-left",color:"neutral",variant:"ghost",to:"/model/list"}),n(s,{label:"新增",icon:"i-lucide-plus",onClick:o[0]||(o[0]=i=>_())})]),default:d(()=>[t(l).loading?(u(),b("div",be,[n(k,{name:"i-lucide-loader",class:"w-8 h-8 animate-spin text-(--ui-text-muted)"})])):(u(),b("div",xe,[(u(!0),b(F,null,ie(t(l).list,i=>(u(),b("div",{key:i.id,class:"p-4 rounded-xl bg-(--ui-bg-elevated) border border-(--ui-border) hover:border-(--ui-primary) transition-all"},[a("div",ye,[a("div",ke,[a("div",ve,[n(k,{name:"i-lucide-key",class:"w-4 h-4 text-(--ui-primary)"})]),a("div",null,[a("div",Te," Token #"+c(i.id),1),a("div",he," 模型 ID: "+c(i.biz_id),1)])]),n(C,{color:x[i.state]?.[1]||"neutral",variant:"subtle",size:"xs"},{default:d(()=>[le(c(x[i.state]?.[0]||"未知"),1)]),_:2},1032,["color"])]),a("div",we,[a("div",$e,[o[2]||(o[2]=a("span",{class:"text-(--ui-text-muted)"},"最大 Token",-1)),a("span",Ce,c(i.max_token?.toLocaleString()||0),1)]),a("div",Ve,[o[3]||(o[3]=a("span",{class:"text-(--ui-text-muted)"},"每次消耗",-1)),a("span",Ue,c(i.battery||0)+" 电量",1)])]),i.description?(u(),b("div",ze,c(i.description),1)):L("",!0),a("div",Me," 更新于 "+c(("formatToDateTime"in m?m.formatToDateTime:t(re))(i.updated_at)),1),a("div",De,[n(s,{size:"xs",color:"neutral",variant:"ghost",icon:"i-lucide-pencil",label:"编辑",onClick:V=>_(i)},null,8,["onClick"]),n(s,{size:"xs",color:"error",variant:"ghost",icon:"i-lucide-trash-2",label:"删除",onClick:V=>e(i)},null,8,["onClick"])])]))),128))])),!t(l).loading&&t(l).list.length===0?(u(),b("div",Fe,[n(k,{name:"i-lucide-key",class:"w-12 h-12 mx-auto mb-2 opacity-50"}),o[4]||(o[4]=a("p",null,"暂无 Token 配置",-1))])):L("",!0)]),_:1}),n(h,{dialog:t(l).isDialog,"onUpdate:dialog":o[1]||(o[1]=i=>t(l).isDialog=i),"current-form":t(l).currentForm,"biz-id":t(p),onRefresh:$},null,8,["dialog","current-form","biz-id"])],64)}}});export{lo as default};
