import{n as H,_ as R}from"./DiI9-bkE.js";import{_ as X}from"./oJBVUttf.js";import{_ as j}from"./DkYr1hfb.js";import{_ as C}from"./K6pfE6CB.js";import{p as S,z as r,a1 as g,a2 as x,R as h,r as z,A as d,W as P,u as a,ah as q,Q as c,a6 as _,an as O,a7 as f,c as I,n as A}from"./Cp_GvCOL.js";import{_ as F}from"./DxT_AjaP.js";const J=S({__name:"ExpandTable",props:{data:{default:[]},columns:{default:[]},scrollX:{default:""}},setup(i){return(w,v)=>{const u=B,k=C;return r(),g(k,{class:"shrink-0",data:i.data,columns:i.columns,ui:{base:`table-fixed border-separate border-spacing-0 w-full ${i.scrollX}`,thead:"[&>tr]:bg-(--ui-bg-elevated)/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-1 first:rounded-l-[calc(var(--ui-radius)*2)] last:rounded-r-[calc(var(--ui-radius)*2)] border-y border-(--ui-border) first:border-l last:border-r",td:"border-b border-(--ui-border) whitespace-normal",tr:"data-[expanded=true]:bg-(--ui-bg-elevated)/50"}},{expanded:x(({row:o})=>[o.original.children?(r(),g(u,{key:0,data:o.original.children,columns:i.columns},null,8,["data","columns"])):h("",!0)]),_:1},8,["data","columns","ui"])}}}),B=Object.assign(J,{__name:"ExpandTable"}),Q={key:0,class:"flex flex-wrap items-center mb-4 sm:mb-6 gap-4"},W={class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5 transition-all peer-focus:-top-2.5 peer-focus:text-highlighted peer-focus:text-xs peer-focus:font-medium peer-placeholder-shown:text-sm peer-placeholder-shown:text-dimmed peer-placeholder-shown:top-1.5 peer-placeholder-shown:font-normal"},G={class:"inline-flex bg-default px-1"},M={key:1,class:"relative"},Y=["value","placeholder"],Z={class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5 transition-all peer-focus:-top-2.5 peer-focus:text-highlighted peer-focus:text-xs peer-focus:font-medium peer-placeholder-shown:text-sm peer-placeholder-shown:text-dimmed peer-placeholder-shown:top-1.5 peer-placeholder-shown:font-normal"},ee={class:"inline-flex bg-default px-1"},oe={key:2,class:"relative"},ae={class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},te={class:"inline-flex bg-default px-1"},le={key:3,class:"relative"},se={class:"pointer-events-none absolute left-0 -top-2.5 text-highlighted text-xs font-medium px-1.5"},re={class:"inline-flex bg-default px-1"},ne={class:"flex flex-wrap items-center gap-4"},ce={key:1,class:"mb-4 sm:mb-6"},de={key:1,class:"flex items-center justify-between gap-3 border-t border-(--ui-border) pt-4 mt-auto"},ie={class:"text-sm text-(--ui-text-muted)"},ue={class:"flex items-center gap-1.5"},pe=S({__name:"DynamicTable",props:{hideToolbar:{type:Boolean,default:!1},search:{type:Boolean,default:!0},loading:{type:Boolean},dataRequest:{},columns:{default:[]},scrollX:{default:"min-w-[1000px]"},defaultPageSize:{default:10}},setup(i,{expose:w}){const v=H(),u=i,k=I(()=>u.search&&u.columns.some(n=>n.searchPlaceholder)),o=z({loading:!1,isBackendPagination:!1,formHash:"",form:null,list:[],showList:[]}),V=I(()=>u.columns.filter(n=>!n.hideInTable)),y=I(()=>u.loading||o.loading),$=async(n,t)=>{o.form[t]=n.trim()},l=z({page:1,pageSize:u.defaultPageSize,itemCount:0,onUpdatePage:n=>{l.page=n,o.isBackendPagination?b():K()}});function K(){o.showList=o.list.slice((Number(l.page)-1)*Number(l.pageSize),Number(l.page)*Number(l.pageSize))}function N(n){const t={...n},s=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/;return Object.keys(t).forEach(p=>{t[p]&&typeof t[p]=="string"&&s.test(t[p])&&(t[p]=t[p].replace("T"," ")+":00")}),t}async function b(){o.loading=!0;const n=JSON.stringify(o.form);o.formHash!==n&&(l.page=1,o.formHash=n);const t=N(o.form),{data:s}=await u.dataRequest({page:l.page,pagesize:l.pageSize,...t});s&&(o.isBackendPagination=!!s.count,o.isBackendPagination?(l.itemCount=s.count,o.showList=s.list):(o.list=s.list,l.itemCount=s.list.length,K())),o.loading=!1}async function U(){l.page=1,o.form=null,A(()=>{const n={};u.columns.forEach(t=>{const s=t.formItemProps?.field||t.accessorKey;v.query[s]!==void 0?n[s]=v.query[s]:t.formItemProps?.defaultValue!==void 0&&(n[s]=t.formItemProps.defaultValue)}),o.form=n,b()})}return U(),w({reload:b}),(n,t)=>{const s=R,p=X,T=j,E=B,L=C,D=F;return r(),d("div",null,[i.hideToolbar?h("",!0):(r(),d(P,{key:0},[a(k)&&a(o).form?(r(),d("div",Q,[(r(!0),d(P,null,q(i.columns,e=>(r(),d(P,{key:e.accessorKey},[e.searchPlaceholder?(r(),d(P,{key:0},[!e.formItemProps||!e.formItemProps.component?(r(),g(p,{key:0,"model-value":a(o).form[e.formItemProps?.field||e.accessorKey],placeholder:"",class:"w-[180px]",ui:{base:"peer",trailing:"pe-1"},"onUpdate:modelValue":m=>{$(m,e.formItemProps?.field||e.accessorKey)},onKeyup:O(b,["enter"])},{trailing:x(()=>[a(o).form[e.formItemProps?.field||e.accessorKey]?(r(),g(s,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:m=>a(o).form[e.formItemProps?.field||e.accessorKey]=""},null,8,["onClick"])):h("",!0)]),default:x(()=>[c("label",W,[c("span",G,_(e.searchPlaceholder),1)])]),_:2},1032,["model-value","onUpdate:modelValue"])):e.formItemProps&&e.formItemProps.component==="Select"?(r(),d("div",M,[f(T,{modelValue:a(o).form[e.formItemProps?.field||e.accessorKey],"onUpdate:modelValue":m=>a(o).form[e.formItemProps?.field||e.accessorKey]=m,items:e.formItemProps.componentProps.options,placeholder:e.searchPlaceholder,class:"w-[180px]",ui:{placeholder:"opacity-0",trailing:"pe-1"}},{trailing:x(()=>[a(o).form[e.formItemProps?.field||e.accessorKey]||a(o).form[e.formItemProps?.field||e.accessorKey]===0?(r(),g(s,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x"})):h("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"]),c("input",{type:"text",value:a(o).form[e.formItemProps?.field||e.accessorKey],placeholder:e.searchPlaceholder,class:"hidden peer"},null,8,Y),c("label",Z,[c("span",ee,_(e.searchPlaceholder),1)]),a(o).form[e.formItemProps?.field||e.accessorKey]||a(o).form[e.formItemProps?.field||e.accessorKey]===0?(r(),g(s,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",class:"absolute top-1/2 right-1 -translate-y-1/2 opacity-0",onClick:m=>a(o).form[e.formItemProps?.field||e.accessorKey]=""},null,8,["onClick"])):h("",!0)])):e.formItemProps&&e.formItemProps.component==="DateInput"?(r(),d("div",oe,[f(p,{modelValue:a(o).form[e.formItemProps?.field||e.accessorKey],"onUpdate:modelValue":m=>a(o).form[e.formItemProps?.field||e.accessorKey]=m,type:"date",class:"w-[160px]"},null,8,["modelValue","onUpdate:modelValue"]),c("label",ae,[c("span",te,_(e.searchPlaceholder),1)])])):e.formItemProps&&e.formItemProps.component==="DateTimeInput"?(r(),d("div",le,[f(p,{modelValue:a(o).form[e.formItemProps?.field||e.accessorKey],"onUpdate:modelValue":m=>a(o).form[e.formItemProps?.field||e.accessorKey]=m,type:"datetime-local",class:"w-[200px]"},null,8,["modelValue","onUpdate:modelValue"]),c("label",se,[c("span",re,_(e.searchPlaceholder),1)])])):h("",!0)],64)):h("",!0)],64))),128)),c("div",ne,[f(s,{disabled:a(y),label:"查询",icon:"i-lucide-search",onClick:b},null,8,["disabled"]),f(s,{disabled:a(y),label:"重置",icon:"fluent:arrow-reset-24-filled",color:"neutral",variant:"outline",onClick:U},null,8,["disabled"])])])):(r(),d("div",ce,[f(s,{disabled:a(y),label:"刷新",icon:"mdi-refresh",color:"neutral",variant:"outline",onClick:b},null,8,["disabled"])]))],64)),f(L,{ref:"table",sticky:"",class:"flex-1 shrink-0",data:a(o).showList,columns:a(V),loading:a(y),ui:{base:`table-fixed border-separate border-spacing-0 w-full ${i.scrollX}`,thead:"[&>tr]:bg-(--ui-bg-elevated)/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-1 first:rounded-l-[calc(var(--ui-radius)*2)] last:rounded-r-[calc(var(--ui-radius)*2)] border-y border-(--ui-border) first:border-l last:border-r last:sticky last:right-0 last:bg-(--ui-bg-elevated) last:z-10",td:"border-b border-(--ui-border) whitespace-normal break-all last:sticky last:right-0 last:bg-(--ui-bg) last:z-10",tr:"data-[expanded=true]:bg-(--ui-bg-elevated)/50"}},{expanded:x(({row:e})=>[e.original.children?(r(),g(E,{key:0,data:e.original.children,columns:a(V),"scroll-x":i.scrollX},null,8,["data","columns","scroll-x"])):h("",!0)]),_:1},8,["data","columns","loading","ui"]),a(l).pageSize!==999?(r(),d("div",de,[c("div",ie," 共 "+_(a(l).itemCount)+" 条数据 ",1),c("div",ue,[f(D,{"show-edges":"","sibling-count":1,page:a(l).page,"items-per-page":a(l).pageSize,total:a(l).itemCount,"onUpdate:page":a(l).onUpdatePage},null,8,["page","items-per-page","total","onUpdate:page"]),f(T,{modelValue:a(l).pageSize,"onUpdate:modelValue":t[0]||(t[0]=e=>a(l).pageSize=e),items:[{value:10,label:"10 / 页"},{value:20,label:"20 / 页"},{value:50,label:"50 / 页"},{value:100,label:"100 / 页"}],onChange:t[1]||(t[1]=e=>a(l).onUpdatePage(1))},null,8,["modelValue"])])])):h("",!0)])}}}),xe=Object.assign(pe,{__name:"DynamicTable"});export{xe as _};
