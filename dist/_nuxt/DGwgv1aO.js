import{_ as M}from"./1OJ4jHSB.js";import{w as j,_ as F,a as q,x as z}from"./DiI9-bkE.js";import{_ as A}from"./Odvr87Pg.js";import{_ as H}from"./CuFgEFCp.js";import{_ as h}from"./Bml5z8l2.js";import{_ as Q}from"./oJBVUttf.js";import{_ as W}from"./BdKneTYw.js";import{_ as G}from"./_BOBmhmt.js";import{_ as J}from"./9B_i7pfW.js";import{_ as X}from"./8gEztUrL.js";import{a as V,b as Y}from"./BWGna7Av.js";import{u as Z}from"./BCMcqMGM.js";import{c as T}from"./B3KMLFeu.js";import{p as B,ai as ee,w as te,z as _,a1 as R,a2 as d,a7 as i,u as n,R as D,Q as s,a6 as p,a5 as ae,A as U,i as se,c as C,r as E,E as r,W as oe,h as re}from"./Cp_GvCOL.js";import{f as ne}from"./CE7u-7DH.js";import"./D7PB4JkZ.js";import"./C-fFc4Sm.js";import"./DnWsfCtc.js";import"./C6Y-ieo6.js";import"./De6cJ90F.js";import"./BrwH2_O0.js";import"./7ga_NNx6.js";import"./BHtpJmxp.js";import"./BlLzDdHJ.js";import"./CM1DIlR0.js";import"./DkYr1hfb.js";import"./DZaB2s8a.js";import"./K6pfE6CB.js";import"./B9BvCEkO.js";import"./DxT_AjaP.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";const le={class:"flex items-center gap-2"},ie={class:"font-semibold"},me={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},ce={class:"flex items-center gap-2"},de={class:"grid grid-cols-2 gap-4 text-sm"},ue={class:"font-mono"},pe={class:"text-yellow-600"},fe={class:"font-medium"},xe={key:0,class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},_e={class:"flex items-center gap-2"},ge={key:1,class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},ye={class:"flex items-center gap-2"},be=B({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(o,{emit:t}){const l=o,u=t,f=C({get(){return l.dialog},set(c){u("update:dialog",c)}}),w=()=>{f.value=!1},g=ee("formRef"),e=E({loading:!1,补单Loading:!1,form:{}}),m=C(()=>e.form.state===2),v=Z(),y=j();async function k(){e.loading=!0;const c={id:e.form.id,real_amount:e.form.real_amount?e.form.real_amount*100:0,remark:e.form.remark},{error:a}=await V(c);a||(y.add({title:"操作成功",color:"success"}),u("refresh")),e.loading=!1}async function $(){v.open({title:"补单确认",description:`确定要对订单「${e.form.order_sn}」进行补单操作吗？补单后订单状态将变为已支付，并为用户增加相应能量。`,color:"warning",onPositiveClick:async()=>{e.补单Loading=!0;const c={id:e.form.id,state:2},{error:a}=await V(c);a||(y.add({title:"补单成功",color:"success"}),u("refresh")),e.补单Loading=!1}})}return te(()=>l.dialog,c=>{c&&(e.loading=!1,e.form=T(l.currentForm),e.form.real_amount&&(e.form.real_amount=e.form.real_amount/100))}),(c,a)=>{const b=q,I=h,S=Q,K=W,L=G,P=F,N=J,O=X;return _(),R(O,{open:n(f),"onUpdate:open":a[3]||(a[3]=x=>se(f)?f.value=x:null),ui:{footer:"justify-end",content:"sm:max-w-xl"}},{header:d(()=>[s("div",le,[i(b,{name:"i-lucide-receipt",class:"w-5 h-5 text-(--ui-primary)"}),s("span",ie,p(n(m)?"查看订单":"编辑订单"),1)])]),body:d(()=>[i(N,{ref_key:"formRef",ref:g,state:n(e).form,class:"space-y-5",onSubmit:k},{default:d(()=>[s("div",me,[s("div",ce,[i(b,{name:"i-lucide-info",class:"w-4 h-4 text-(--ui-primary)"}),a[4]||(a[4]=s("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"订单信息",-1))]),s("div",de,[s("div",null,[a[5]||(a[5]=s("span",{class:"text-(--ui-text-muted)"},"订单号：",-1)),s("span",ue,p(n(e).form.order_sn||"-"),1)]),s("div",null,[a[6]||(a[6]=s("span",{class:"text-(--ui-text-muted)"},"用户：",-1)),s("span",null,p(n(e).form.member?.username||"-"),1)]),s("div",null,[a[7]||(a[7]=s("span",{class:"text-(--ui-text-muted)"},"套餐：",-1)),s("span",null,p(n(e).form.package_info||"-"),1)]),s("div",null,[a[8]||(a[8]=s("span",{class:"text-(--ui-text-muted)"},"能量：",-1)),s("span",pe,p(n(e).form.coins||0),1)]),s("div",null,[a[9]||(a[9]=s("span",{class:"text-(--ui-text-muted)"},"订单金额：",-1)),s("span",fe,"¥"+p((n(e).form.order_amount||0)/100),1)]),s("div",null,[a[10]||(a[10]=s("span",{class:"text-(--ui-text-muted)"},"状态：",-1)),i(I,{color:n(e).form.state===2?"success":"warning",variant:"subtle"},{default:d(()=>[ae(p(n(e).form.state===2?"已支付":"待支付"),1)]),_:1},8,["color"])])])]),n(m)?D("",!0):(_(),U("div",xe,[s("div",_e,[i(b,{name:"i-lucide-edit",class:"w-4 h-4 text-(--ui-warning)"}),a[11]||(a[11]=s("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"可编辑信息",-1))]),i(K,{label:"实付金额",name:"real_amount"},{default:d(()=>[i(S,{modelValue:n(e).form.real_amount,"onUpdate:modelValue":a[0]||(a[0]=x=>n(e).form.real_amount=x),modelModifiers:{number:!0},type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"w-full"},null,8,["modelValue"])]),_:1}),i(K,{label:"备注",name:"remark"},{default:d(()=>[i(L,{modelValue:n(e).form.remark,"onUpdate:modelValue":a[1]||(a[1]=x=>n(e).form.remark=x),modelModifiers:{trim:!0},placeholder:"请输入备注信息",class:"w-full",rows:2},null,8,["modelValue"])]),_:1})])),n(e).form.state===0?(_(),U("div",ge,[s("div",ye,[i(b,{name:"i-lucide-alert-circle",class:"w-4 h-4 text-(--ui-error)"}),a[12]||(a[12]=s("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"补单操作",-1))]),a[13]||(a[13]=s("p",{class:"text-sm text-(--ui-text-muted)"}," 如果用户已支付但订单状态未更新，可以进行补单操作。补单后将为用户增加相应能量。 ",-1)),i(P,{color:"warning",variant:"soft",icon:"i-lucide-refresh-cw",label:"确认补单",loading:n(e).补单Loading,onClick:$},null,8,["loading"])])):D("",!0)]),_:1},8,["state"])]),footer:d(()=>[i(P,{label:n(m)?"关闭":"取消",color:"neutral",variant:"outline",onClick:w},null,8,["label"]),n(m)?D("",!0):(_(),R(P,{key:0,loading:n(e).loading,label:"确认",variant:"solid",onClick:a[2]||(a[2]=x=>n(g)?.submit())},null,8,["loading"]))]),_:1},8,["open"])}}}),he=Object.assign(be,{__name:"PaymentOrderEdit"}),we={0:["待支付","warning"],2:["已支付","success"]},ve={1:["支付宝","info"],2:["微信","success"],3:["USDT","warning"],4:["自建","neutral"]},ke=[{accessorKey:"id",header:()=>r(F,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"}),cell:({row:o})=>r("span",{class:"font-mono text-sm text-gray-600 dark:text-gray-400"},`#${o.original.id}`),meta:{class:{th:"w-[80px]",td:"w-[80px]"}}},{accessorKey:"uid",header:"用户信息",searchPlaceholder:"用户ID",meta:{class:{th:"w-[180px]",td:"w-[180px]"}},cell:({row:o})=>{const t=o.original.member;return!t||!t.id?r("span",{class:"text-gray-400"},o.original.uid||"-"):r("div",{class:"flex items-center gap-2"},[r(z,{src:t.avatar,size:"sm"}),r("div",{class:"flex flex-col"},[r("span",{class:"text-sm font-medium truncate"},t.username),r("span",{class:"text-xs text-(--ui-text-muted)"},`ID: ${t.id}`)])])}},{accessorKey:"order_sn",searchPlaceholder:"请输入订单号",header:"订单号",cell:({row:o})=>{const t=o.original.order_sn;return t?r("span",{class:"font-mono text-sm text-gray-700 dark:text-gray-300"},t):r("span",{class:"text-gray-400"},"-")},meta:{class:{th:"w-[180px]",td:"w-[180px]"}}},{accessorKey:"trade_no",searchPlaceholder:"请输入支付单号",header:"支付单号",cell:({row:o})=>{const t=o.original.trade_no;return t?r("span",{class:"font-mono text-xs text-gray-600 dark:text-gray-400"},t):r("span",{class:"text-gray-400"},"-")},meta:{class:{th:"w-[180px]",td:"w-[180px]"}}},{accessorKey:"coins",header:"能量",cell:({row:o})=>{const t=o.original.coins||0;return r("span",{class:"font-semibold text-yellow-600 dark:text-yellow-400"},t)},meta:{class:{th:"w-[100px]",td:"w-[100px]"}}},{accessorKey:"order_amount",header:"订单金额",cell:({row:o})=>{const t=(o.original.order_amount||0)/100;return r("span",{class:"font-semibold text-gray-900 dark:text-white"},`¥${t}`)},meta:{class:{th:"w-[120px]",td:"w-[120px]"}}},{accessorKey:"real_amount",header:"实付金额",cell:({row:o})=>{const t=(o.original.real_amount||0)/100;return r("span",{class:"font-semibold text-green-600 dark:text-green-400"},`¥${t}`)},meta:{class:{th:"w-[120px]",td:"w-[120px]"}}},{accessorKey:"remark",header:"备注",meta:{class:{th:"w-[150px]",td:"w-[150px]"}},cell:({row:o})=>{const t=o.original.remark;return t?r("span",{class:"text-sm text-gray-600 dark:text-gray-300 truncate"},t):r("span",{class:"text-gray-400"},"-")}},{accessorKey:"payment_type_name",header:"支付类型",cell:({row:o})=>{const t=o.original.payment_type_name;return t?r(h,{variant:"subtle",color:"neutral"},()=>t):r("span",{class:"text-gray-400"},"-")},meta:{class:{th:"w-[120px]",td:"w-[120px]"}}},{accessorKey:"payment_ty",searchPlaceholder:"支付方式",header:"支付方式",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},formItemProps:{component:"Select",componentProps:{options:[{label:"支付宝",value:1},{label:"微信",value:2},{label:"USDT",value:3},{label:"自建",value:4}]}},cell:({row:o})=>{const[t,l]=ve[o.original.payment_ty]||["未知","neutral"];return r(h,{variant:"subtle",color:l},()=>t)}},{accessorKey:"state",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},header:"状态",searchPlaceholder:"请输入状态",formItemProps:{component:"Select",componentProps:{options:[{label:"待支付",value:0},{label:"已支付",value:2}]}},cell:({row:o})=>{const t=o.original.state,[l,u]=we[t]||["未知","neutral"];return r(h,{variant:"subtle",color:u},()=>l)}},{accessorKey:"created_at",header:"创建时间",meta:{class:{th:"w-[180px]",td:"w-[180px]"}},cell:({row:o})=>{const t=o.original.created_at;return t?r("span",{class:"text-sm text-gray-600 dark:text-gray-300"},ne(t)):r("span",{class:"text-gray-400"},"-")}}],rt=B({name:"PaymentOrderList",__name:"order",setup(o){const t=re(),l=E({isDialog:!1,currentForm:{}}),u=async e=>{l.isDialog=!0,e?l.currentForm=T(e):l.currentForm={state:2}},f=async()=>{t.value.reload(),l.isDialog=!1};function w(e){const m=e.original.state===2;return[{label:m?"查看":"编辑",icon:m?"i-lucide-eye":"i-lucide-pencil",onSelect(){u(e.original)}}]}const g=[...ke,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:e})=>r("div",{class:"text-right"},r(M,{content:{align:"end"},items:w(e)},()=>r(F,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(e,m)=>{const v=A,y=H,k=he;return _(),U(oe,null,[i(y,null,{default:d(()=>[i(v,{ref_key:"tableRef",ref:t,"data-request":n(Y),columns:g,"scroll-x":"min-w-[1800px]"},null,8,["data-request"])]),_:1}),i(k,{dialog:n(l).isDialog,"onUpdate:dialog":m[0]||(m[0]=$=>n(l).isDialog=$),"current-form":n(l).currentForm,onRefresh:f},null,8,["dialog","current-form"])],64)}}});export{rt as default};
