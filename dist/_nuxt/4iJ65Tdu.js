import{_ as S}from"./CEcF5dWm.js";import{f as B,c as P,ap as j,aE as I,j as C,l as O,a as N,o as $,w as m,B as a,_ as D,b as e,D as h,a4 as z,aF as l,i as A,k as T,A as L,C as G,G as H}from"./DhOLkSnF.js";import{_ as J,a as Q,b as W,c as X}from"./DAqc9GYg.js";import{_ as Y}from"./CSbqei5V.js";import{_ as Z}from"./DAIKkUkW.js";import{_ as ee}from"./DAeRr84W.js";import{_ as te}from"./CVanS2c1.js";import{_ as ae}from"./D0vBe5Vh.js";import{_ as oe}from"./Db__RPjw.js";import{_ as se}from"./BZLiX_8y.js";import{w as re,x as le}from"./D1QVHQma.js";import{c as M}from"./45RcOEEf.js";import{o as ne,n as g,s as q}from"./B-mCBPct.js";import{u as me,b as ie}from"./Bo5OMT4U.js";import{_ as U}from"./-rcGzxkB.js";import{_ as ce}from"./CLU2_0cD.js";import{f as de}from"./BmKy9gZZ.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./CLKxJTZi.js";import"./HRiyi1uV.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";const ue={class:"grid grid-cols-2 gap-4"},pe={class:"grid grid-cols-3 gap-4"},fe={class:"grid grid-cols-2 gap-4"},_e=B({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(r,{emit:o}){const c=r,u=o,i=P({get:()=>c.dialog,set:f=>u("update:dialog",f)}),b=()=>{i.value=!1},x=j("formRef"),w=I(),v=ne({name:q().nonempty("任务名称不能为空"),code:q().nonempty("任务编码不能为空"),battery:g().min(0,"奖励电量不能小于0"),num:g().min(0,"需要次数不能小于0"),amount:g().min(0,"奖励金额不能小于0"),show:g(),state:g()}),p=[{label:"关闭",value:0},{label:"启用",value:2}],y=[{label:"隐藏",value:0},{label:"显示",value:2}],t=C({loading:!1,form:{}});async function k(){t.loading=!0;try{const f=M(t.form),{error:s}=await re(f);s||(w.add({title:"操作成功",color:"success"}),b(),u("refresh"))}finally{t.loading=!1}}return O(()=>c.dialog,f=>{f&&(t.form=M(c.currentForm),t.loading=!1)}),(f,s)=>{const _=Z,d=ee,V=te,F=ae,R=oe,K=D,E=se;return $(),N(E,{open:e(i),"onUpdate:open":s[9]||(s[9]=n=>z(i)?i.value=n:null),title:r.currentForm.id?"修改营销任务":"新增营销任务",dismissible:!1,ui:{footer:"justify-end"}},{body:m(()=>[a(R,{ref_key:"formRef",ref:x,schema:e(v),state:e(t).form,class:"flex flex-col gap-4",onSubmit:k},{default:m(()=>[h("div",ue,[a(d,{label:"任务名称",name:"name",required:""},{default:m(()=>[a(_,{modelValue:e(t).form.name,"onUpdate:modelValue":s[0]||(s[0]=n=>e(t).form.name=n),modelModifiers:{trim:!0},placeholder:"如：每日签到",class:"w-full"},null,8,["modelValue"])]),_:1}),a(d,{label:"任务编码",name:"code",required:""},{default:m(()=>[a(_,{modelValue:e(t).form.code,"onUpdate:modelValue":s[1]||(s[1]=n=>e(t).form.code=n),modelModifiers:{trim:!0},placeholder:"如：daily_checkin",class:"w-full"},null,8,["modelValue"])]),_:1})]),h("div",pe,[a(d,{label:"奖励电量",name:"battery",required:""},{default:m(()=>[a(_,{modelValue:e(t).form.battery,"onUpdate:modelValue":s[2]||(s[2]=n=>e(t).form.battery=n),modelModifiers:{number:!0},placeholder:"电量值",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),a(d,{label:"需要次数",name:"num",required:""},{default:m(()=>[a(_,{modelValue:e(t).form.num,"onUpdate:modelValue":s[3]||(s[3]=n=>e(t).form.num=n),modelModifiers:{number:!0},placeholder:"完成次数",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),a(d,{label:"奖励金额",name:"amount",required:""},{default:m(()=>[a(_,{modelValue:e(t).form.amount,"onUpdate:modelValue":s[4]||(s[4]=n=>e(t).form.amount=n),modelModifiers:{number:!0},placeholder:"金额",type:"number",min:"0",step:"0.01",class:"w-full"},null,8,["modelValue"])]),_:1})]),a(d,{label:"任务描述",name:"remark"},{default:m(()=>[a(V,{modelValue:e(t).form.remark,"onUpdate:modelValue":s[5]||(s[5]=n=>e(t).form.remark=n),placeholder:"请输入任务描述信息，帮助用户了解任务详情",rows:3,class:"w-full"},null,8,["modelValue"])]),_:1}),h("div",fe,[a(d,{label:"显示状态",name:"show",required:""},{default:m(()=>[a(F,{modelValue:e(t).form.show,"onUpdate:modelValue":s[6]||(s[6]=n=>e(t).form.show=n),items:y,placeholder:"选择显示状态",class:"w-full"},null,8,["modelValue"])]),_:1}),a(d,{label:"任务状态",name:"state",required:""},{default:m(()=>[a(F,{modelValue:e(t).form.state,"onUpdate:modelValue":s[7]||(s[7]=n=>e(t).form.state=n),items:p,placeholder:"选择任务状态",class:"w-full"},null,8,["modelValue"])]),_:1})])]),_:1},8,["schema","state"])]),footer:m(()=>[a(K,{label:"取消",color:"neutral",variant:"outline",onClick:b}),a(K,{loading:e(t).loading,label:"确认",color:"primary",variant:"solid",onClick:s[8]||(s[8]=n=>e(x)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),ge=Object.assign(_e,{__name:"MarketingEdit"}),be={0:["关闭","error"],2:["启用","success"]},xe={0:["隐藏","warning"],2:["显示","info"]},ye=[{label:"关闭",value:0},{label:"启用",value:2}],he=[{label:"隐藏",value:0},{label:"显示",value:2}],we=[{accessorKey:"id",header:()=>l(D,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"}),meta:{class:{th:"w-[80px]",td:"w-[80px]"}}},{accessorKey:"name",header:"任务名称",meta:{class:{th:"w-[100px]"}},cell:({row:r})=>{const o=r.original.name;return l("div",{class:"font-medium text-gray-900 dark:text-white"},o||"-")}},{accessorKey:"code",header:"编码",searchPlaceholder:"搜索任务编码",meta:{class:{th:"w-[80px]"}},cell:({row:r})=>{const o=r.original.code;return l("code",{class:"px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs font-mono text-gray-700 dark:text-gray-300"},o||"-")}},{accessorKey:"battery",header:"奖励电量",meta:{class:{th:"w-[100px]"}},cell:({row:r})=>{const o=r.original.battery;return o?l("div",{class:"flex items-center gap-1"},[l("span",{class:"text-yellow-600 font-semibold"},o),l("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"⚡")]):"-"}},{accessorKey:"num",header:"需要次数",meta:{class:{th:"w-[100px]"}},cell:({row:r})=>{const o=r.original.num;return l("div",{class:"text-center"},l(U,{variant:"soft",color:"neutral"},()=>o||0))}},{accessorKey:"amount",header:"奖励金额",meta:{class:{th:"w-[120px]"}},cell:({row:r})=>{const o=r.original.amount;return o?l("div",{class:"flex items-center gap-1"},[l("span",{class:"text-green-600 font-semibold"},`¥${o}`)]):"-"}},{accessorKey:"remark",header:"任务描述",meta:{class:{th:"w-[300px]"}},cell:({row:r})=>{const o=r.original.remark;return o?l(ce,{text:o},{default:()=>l("div",{class:"truncate max-w-[280px] cursor-help text-gray-600 dark:text-gray-400"},o)}):l("span",{class:"text-gray-400 dark:text-gray-500"},"无描述")}},{accessorKey:"show",header:"显示状态",formItemProps:{component:"Select",componentProps:{options:he}},meta:{class:{th:"w-[100px]"}},cell:({row:r})=>{const o=r.original.show,[c,u]=xe[o]||["未知","warning"];return l(U,{class:"capitalize",variant:"subtle",color:u},()=>c)}},{accessorKey:"state",header:"任务状态",formItemProps:{component:"Select",componentProps:{options:ye}},meta:{class:{th:"w-[100px]"}},cell:({row:r})=>{const o=r.original.state,[c,u]=be[o]||["未知","error"];return l(U,{class:"capitalize",variant:"subtle",color:u},()=>c)}},{accessorKey:"updated_at",header:"更新时间",meta:{class:{th:"w-[180px]"}},cell:({row:r})=>{const o=r.original.updated_at;return l("div",{class:"text-gray-500 dark:text-gray-400 text-sm"},de(o))}}],ve={key:0,class:"absolute top-0 left-0 right-0 h-(--ui-header-height) flex items-center justify-between border-b border-(--ui-border) px-4 sm:px-6 bg-(--ui-bg)"},ke={class:"flex items-center gap-4"},Qe=B({name:"MarketingList",__name:"list",setup(r){const c=me(ie).smaller("lg"),u=A(),i=C({isDialog:!1,currentForm:{}}),b=p=>{i.currentForm=p?M(p):{},i.isDialog=!0},x=()=>{u.value?.reload(),i.isDialog=!1};function w(p){return[{label:"编辑",icon:"i-lucide-edit",onSelect(){b(p.original)}}]}const v=[...we,{id:"actions",header:"操作",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:p})=>l("div",{class:"text-right"},l(S,{content:{align:"end"},items:w(p)},()=>l(D,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(p,y)=>{const t=Q,k=J,f=W,s=Y,_=X,d=ge;return $(),T(H,null,[a(_,{ui:{body:"pb-[12px]! gap-0!"}},L({body:m(()=>[e(c)?G("",!0):($(),T("div",ve,[h("div",ke,[a(t),a(f)])])),a(s,{ref_key:"tableRef",ref:u,"data-request":e(le),columns:v,"scroll-x":"min-w-[1200px]"},null,8,["data-request"])]),_:2},[e(c)?{name:"header",fn:m(()=>[a(k,{title:"营销任务配置"},{leading:m(()=>[a(t)]),_:1})]),key:"0"}:void 0]),1024),a(d,{dialog:e(i).isDialog,"onUpdate:dialog":y[0]||(y[0]=V=>e(i).isDialog=V),"current-form":e(i).currentForm,onRefresh:x},null,8,["dialog","current-form"])],64)}}});export{Qe as default};
