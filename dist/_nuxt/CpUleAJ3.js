import{_ as M}from"./CEcF5dWm.js";import{f as R,c as N,ap as P,j as T,i as j,aE as I,l as z,a as L,o as v,w as i,B as o,_ as w,b as e,k as U,C as E,n as G,a4 as O,F as H,aF as m,A as Q,D as W,G as X}from"./DhOLkSnF.js";import{_ as Y,a as Z,b as ee,c as te}from"./DAqc9GYg.js";import{_ as oe}from"./CSbqei5V.js";import{_ as ae}from"./DAIKkUkW.js";import{_ as ne}from"./DAeRr84W.js";import{_ as re}from"./D0vBe5Vh.js";import{_ as le}from"./CVanS2c1.js";import{_ as se}from"./Db__RPjw.js";import{_ as ie}from"./BZLiX_8y.js";import{c as me,d as ce,e as ue,f as de}from"./CxuEfYss.js";import{c as q}from"./45RcOEEf.js";import{o as pe,s as A}from"./B-mCBPct.js";import{u as fe,b as _e}from"./Bo5OMT4U.js";import{_ as S}from"./-rcGzxkB.js";import{_ as J}from"./CLU2_0cD.js";import{f as ge}from"./BmKy9gZZ.js";import{u as be}from"./BVQSm7Ip.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./CLKxJTZi.js";import"./HRiyi1uV.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";const ye={key:0,class:"text-red-500 text-sm mt-1"},xe=R({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(n,{emit:D}){const g=n,b=D,f=N({get(){return g.dialog},set(a){b("update:dialog",a)}}),C=()=>{f.value=!1},c=P("formRef"),y=pe({name:A().nonempty(),content:A().nonempty("请输入 JSON")}),k=[{label:"删除",value:4},{label:"待审核",value:2},{label:"正常",value:1},{label:"提交",value:0}],t=T({loading:!1,form:{tag:[],content:""}}),d=j(null),x=N({get(){try{const a=typeof t.form.content=="string"?JSON.parse(t.form.content):t.form.content;return JSON.stringify(a,null,2)}catch{return t.form.content||""}},set(a){t.form.content=a}}),l=I();async function u(){t.loading=!0;const a=q(t.form);Array.isArray(a.tag)&&(a.tag=a.tag.join(","));try{JSON.parse(a.content),d.value=null,a.content=JSON.stringify(JSON.parse(a.content))}catch(p){d.value=p.message,l.add({title:`JSON 格式错误: ${p.message}`,color:"error"}),t.loading=!1;return}const{error:r}=await(a.id?me:ce)(a);r||(l.add({title:"操作成功",color:"success"}),b("refresh")),t.loading=!1}return z(()=>g.dialog,a=>{a&&(t.loading=!1,t.form=g.currentForm),d.value=null}),(a,r)=>{const p=ae,_=ne,V=re,$=le,h=se,F=w,K=ie;return v(),L(K,{open:e(f),"onUpdate:open":r[6]||(r[6]=s=>O(f)?f.value=s:null),title:n.currentForm.id?"修改":"新增",dismissible:!1,ui:{footer:"justify-end"}},{body:i(()=>[o(h,{ref_key:"formRef",ref:c,schema:e(y),state:e(t).form,class:"flex flex-col gap-4",onSubmit:u},{default:i(()=>[o(_,{label:"名称",name:"name",required:""},{default:i(()=>[o(p,{modelValue:e(t).form.name,"onUpdate:modelValue":r[0]||(r[0]=s=>e(t).form.name=s),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},null,8,["modelValue"])]),_:1}),o(_,{label:"可评分值",name:"rating",required:""},{default:i(()=>[o(p,{modelValue:e(t).form.rating,"onUpdate:modelValue":r[1]||(r[1]=s=>e(t).form.rating=s),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",type:"number",ui:{trailing:"pe-1"}},null,8,["modelValue"])]),_:1}),o(_,{label:"提示限制",name:"hint",required:""},{default:i(()=>[o(p,{modelValue:e(t).form.hint,"onUpdate:modelValue":r[2]||(r[2]=s=>e(t).form.hint=s),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",type:"number",min:"0",ui:{trailing:"pe-1"}},null,8,["modelValue"])]),_:1}),o(_,{label:"状态",name:"state",required:""},{default:i(()=>[o(V,{modelValue:e(t).form.state,"onUpdate:modelValue":r[3]||(r[3]=s=>e(t).form.state=s),items:k,placeholder:"请选择",class:"w-full"},null,8,["modelValue"])]),_:1}),o(_,{label:"描述 (JSON)",name:"content"},{default:i(()=>[o($,{modelValue:e(x),"onUpdate:modelValue":r[4]||(r[4]=s=>O(x)?x.value=s:null),class:G(["w-full font-mono text-sm",{"border-red-500 bg-red-50":e(d)}]),rows:12,placeholder:"请输入 JSON"},null,8,["modelValue","class"]),e(d)?(v(),U("div",ye," JSON 错误: "+H(e(d)),1)):E("",!0)]),_:1})]),_:1},8,["schema","state"])]),footer:i(()=>[o(F,{label:"取消",color:"neutral",variant:"outline",onClick:C}),o(F,{loading:e(t).loading,label:"确认",variant:"solid",onClick:r[5]||(r[5]=s=>e(c)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),he=Object.assign(xe,{__name:"AmusementCategoryEdit"}),B={1:["启用","success"],2:["待审核","error"],4:["已删除","error"]},ve=[{accessorKey:"id",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},header:()=>m(w,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent"})},{accessorKey:"name",searchPlaceholder:"类型名称",header:"类型名称",meta:{class:{th:"w-[150px]",td:"w-[150px]"}},cell:({row:n})=>m(J,{text:n.original.name,ui:{content:"max-w-[100px] h-auto",text:"whitespace-pre-wrap break-all select-text"}},()=>m("div",{class:"truncate"},n.original.name))},{accessorKey:"rating",header:"可评分值",cell:({row:n})=>m(S,{variant:"outline",color:"info"},()=>n.original.rating)},{accessorKey:"hint",header:"提示限制",cell:({row:n})=>m(S,{variant:"outline",color:"primary"},()=>n.original.hint)},{accessorKey:"content",header:"规则",meta:{class:{th:"w-[250px]",td:"w-[250px]"}},cell:({row:n})=>m(J,{text:n.original.content,ui:{content:"max-w-[250px] h-auto",text:"whitespace-pre-wrap break-all select-text"}},()=>m("div",{class:"truncate"},n.original.content))},{accessorKey:"created_at",meta:{class:{th:"w-[150px]",td:"w-[150px]"}},header:"创建时间",cell:({row:n})=>ge(n.original.created_at)},{accessorKey:"state",meta:{class:{th:"w-[100px]",td:"w-[80px]"}},header:"状态",searchPlaceholder:"筛选状态",formItemProps:{component:"Select",componentProps:{options:[{label:"待审核",value:2},{label:"启用",value:1},{label:"已删除",value:4}]}},cell:({row:n})=>m(S,{class:"capitalize",variant:"subtle",color:B[n.original.state]?.[1]},()=>B[n.original.state]?.[0])}],we={key:0,class:"absolute top-0 left-0 right-0 h-(--ui-header-height) flex items-center justify-between border-b border-(--ui-border) px-4 sm:px-6 bg-(--ui-bg)"},Ce={class:"flex items-center gap-4"},We=R({name:"AmusementCategoryList",__name:"category",setup(n){const g=fe(_e).smaller("lg"),b=j(),f=w,C=be(),c=T({isDialog:!1,currentForm:{}}),y=async l=>{c.isDialog=!0,l?c.currentForm=q(l):c.currentForm={state:2}},k=async()=>{b.value.reload(),c.isDialog=!1},t=async l=>{const{error:u}=await de({id:l.id});u||b.value.reload()};function d(l){return[{label:"编辑",icon:"material-symbols:edit-square-outline",onSelect(){y(l.original)}},{type:"separator"},{label:"删除",icon:"material-symbols:contract-delete-outline-rounded",color:"error",onSelect(){C.open({color:"error",title:"删除数据",description:"您确定要删除吗？",onPositiveClick(){t(l.original)}})}}]}const x=[...ve,{id:"actions",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:l})=>m("div",{class:"text-right"},m(M,{content:{align:"end"},items:d(l)},()=>m(w,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(l,u)=>{const a=Z,r=Y,p=ee,_=oe,V=te,$=he;return v(),U(X,null,[o(V,{ui:{body:"pb-[12px]! gap-0!"}},Q({body:i(()=>[e(g)?E("",!0):(v(),U("div",we,[W("div",Ce,[o(a),o(p)]),o(e(f),{label:"新增",icon:"i-lucide-plus",onClick:u[1]||(u[1]=h=>y(null))})])),o(_,{ref_key:"tableRef",ref:b,"data-request":e(ue),columns:x,"scroll-x":"min-w-[1000px]"},null,8,["data-request"])]),_:2},[e(g)?{name:"header",fn:i(()=>[o(r,{title:"游戏分类列表"},{leading:i(()=>[o(a)]),right:i(()=>[o(e(f),{label:"新增",icon:"i-lucide-plus",onClick:u[0]||(u[0]=h=>y(null))})]),_:1})]),key:"0"}:void 0]),1024),o($,{dialog:e(c).isDialog,"onUpdate:dialog":u[2]||(u[2]=h=>e(c).isDialog=h),"current-form":e(c).currentForm,onRefresh:k},null,8,["dialog","current-form"])],64)}}});export{We as default};
