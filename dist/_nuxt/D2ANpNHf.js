import{w as Q,_ as I,a as S}from"./DiI9-bkE.js";import{_ as A}from"./Odvr87Pg.js";import{_ as G}from"./CuFgEFCp.js";import{_ as W}from"./oJBVUttf.js";import{_ as H}from"./BdKneTYw.js";import{_ as J}from"./_BOBmhmt.js";import{_ as X}from"./9B_i7pfW.js";import{_ as B}from"./8gEztUrL.js";import{i as Y,j as F}from"./B33qAI9M.js";import{c as K}from"./B3KMLFeu.js";import{p as E,ai as Z,w as ee,z as _,a1 as te,a2 as c,a7 as r,u as e,Q as n,i as oe,c as se,r as q,h as L,E as s,A as h,a6 as D,W as j,ah as ae,R as re}from"./Cp_GvCOL.js";import{o as le,n as U,s as z}from"./CgOwER5m.js";import{_ as ie}from"./DxT_AjaP.js";import{f as M}from"./CE7u-7DH.js";import{_ as w}from"./Bml5z8l2.js";import{_ as P}from"./Baq49nZQ.js";import"./CM1DIlR0.js";import"./BlLzDdHJ.js";import"./DkYr1hfb.js";import"./D7PB4JkZ.js";import"./DZaB2s8a.js";import"./C-fFc4Sm.js";import"./De6cJ90F.js";import"./DnWsfCtc.js";import"./K6pfE6CB.js";import"./B9BvCEkO.js";import"./DaMwIZ4f.js";import"./BnfZ4xmv.js";import"./CangPKqO.js";import"./C8Jf-TuN.js";import"./DVCf4JVd.js";import"./BHtpJmxp.js";const ne={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},de={class:"flex items-center gap-2"},me={class:"grid grid-cols-2 gap-4"},ce={class:"grid grid-cols-2 gap-4"},ue={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},pe={class:"flex items-center gap-2"},fe={class:"p-4 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border) space-y-4"},xe={class:"flex items-center gap-2"},ge=E({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(l,{emit:a}){const x=l,t=a,y=se({get:()=>x.dialog,set:f=>t("update:dialog",f)}),$=()=>{y.value=!1},k=Z("formRef"),V=Q(),T=le({limit:U().min(0,"限领次数不能小于0"),num:U().min(1,"生成数量至少为1"),coins:U().min(0,"能量不能小于0"),tm:z().nonempty("请选择过期时间"),remark:z().optional(),uid:U().optional()}),i=q({loading:!1,form:{}}),d=L(""),u=L([]);async function C(){i.loading=!0;try{const f=K(i.form);f.tm&&(f.tm=f.tm.replace("T"," ")+":00");const{error:o}=await Y(f);o||(V.add({title:"操作成功",color:"success"}),$(),t("refresh"))}finally{i.loading=!1}}return ee(()=>x.dialog,f=>{f&&(i.form=K(x.currentForm),i.loading=!1,d.value="",u.value=[])}),(f,o)=>{const v=S,b=W,g=H,p=J,N=X,R=I,O=B;return _(),te(O,{open:e(y),"onUpdate:open":o[7]||(o[7]=m=>oe(y)?y.value=m:null),title:"生成兑换卡",ui:{content:"sm:max-w-xl",footer:"justify-end bg-(--ui-bg-elevated)"}},{body:c(()=>[r(N,{ref_key:"formRef",ref:k,schema:e(T),state:e(i).form,class:"space-y-5",onSubmit:C},{default:c(()=>[n("div",ne,[n("div",de,[r(v,{name:"i-lucide-settings",class:"w-4 h-4 text-(--ui-primary)"}),o[8]||(o[8]=n("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"基本配置",-1))]),n("div",me,[r(g,{label:"生成数量",name:"num",required:""},{default:c(()=>[r(b,{modelValue:e(i).form.num,"onUpdate:modelValue":o[0]||(o[0]=m=>e(i).form.num=m),modelModifiers:{number:!0},placeholder:"请输入数量",type:"number",min:"1",class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"限领次数",name:"limit",required:""},{default:c(()=>[r(b,{modelValue:e(i).form.limit,"onUpdate:modelValue":o[1]||(o[1]=m=>e(i).form.limit=m),modelModifiers:{number:!0},placeholder:"每张卡可用次数",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1})]),n("div",ce,[r(g,{label:"能量值",name:"coins",required:""},{default:c(()=>[r(b,{modelValue:e(i).form.coins,"onUpdate:modelValue":o[2]||(o[2]=m=>e(i).form.coins=m),modelModifiers:{number:!0},placeholder:"请输入能量值",type:"number",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),r(g,{label:"过期时间",name:"tm",required:""},{default:c(()=>[r(b,{modelValue:e(i).form.tm,"onUpdate:modelValue":o[3]||(o[3]=m=>e(i).form.tm=m),placeholder:"请选择过期时间",type:"datetime-local",class:"w-full"},null,8,["modelValue"])]),_:1})])]),n("div",ue,[n("div",pe,[r(v,{name:"i-lucide-user",class:"w-4 h-4 text-(--ui-info)"}),o[9]||(o[9]=n("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"指定用户",-1)),o[10]||(o[10]=n("span",{class:"text-xs text-(--ui-text-muted)"},"（可选）",-1))]),r(g,{label:"选择用户",name:"uid"},{default:c(()=>[r(b,{modelValue:e(i).form.uid,"onUpdate:modelValue":o[4]||(o[4]=m=>e(i).form.uid=m),modelModifiers:{number:!0},placeholder:"请输入用户ID",type:"number",min:"1",class:"w-full"},null,8,["modelValue"])]),_:1})]),n("div",fe,[n("div",xe,[r(v,{name:"i-lucide-file-text",class:"w-4 h-4 text-(--ui-warning)"}),o[11]||(o[11]=n("span",{class:"text-sm font-medium text-(--ui-text-highlighted)"},"备注信息",-1)),o[12]||(o[12]=n("span",{class:"text-xs text-(--ui-text-muted)"},"（可选）",-1))]),r(g,{name:"remark"},{default:c(()=>[r(p,{modelValue:e(i).form.remark,"onUpdate:modelValue":o[5]||(o[5]=m=>e(i).form.remark=m),placeholder:"请输入备注信息",rows:2,class:"w-full"},null,8,["modelValue"])]),_:1})])]),_:1},8,["schema","state"])]),footer:c(()=>[r(R,{label:"取消",color:"neutral",variant:"outline",onClick:$}),r(R,{loading:e(i).loading,label:"确认",color:"primary",variant:"solid",onClick:o[6]||(o[6]=m=>e(k)?.submit())},null,8,["loading"])]),_:1},8,["open"])}}}),_e=Object.assign(ge,{__name:"MemberInvitationEdit"}),be={0:["未使用","warning"],2:["已使用","success"]},he=[{label:"未使用",value:0},{label:"已使用",value:2}],ye=[{accessorKey:"id",header:"ID",meta:{class:{th:"w-[80px]",td:"w-[80px]"}},cell:({row:l})=>s("span",{class:"text-(--ui-text-muted) font-mono text-sm"},`#${l.original.id}`)},{accessorKey:"uid",header:"用户",searchPlaceholder:"请输入用户ID",meta:{class:{th:"w-[180px]",td:"w-[180px]"}},cell:({row:l})=>{const a=l.original.member;return!l.original.uid||!a?.id?s("div",{class:"flex flex-col"},[s("span",{class:"text-sm text-(--ui-text-muted)"},"系统"),s(P,{text:"受限领次数限制"},{default:()=>s(w,{variant:"subtle",color:"primary",class:"w-fit mt-1 cursor-help"},()=>"系统邀请码")})]):s("div",{class:"flex flex-col"},[s("span",{class:"text-sm font-medium text-(--ui-text-highlighted) truncate max-w-[120px]"},a.username||"未知"),s(P,{text:"不受限领次数限制"},{default:()=>s(w,{variant:"subtle",color:"success",class:"w-fit mt-0.5 cursor-help"},()=>"个人邀请码")})])}},{accessorKey:"code",searchPlaceholder:"请输入兑换码",header:"兑换码",meta:{class:{th:"w-[180px]",td:"w-[180px]"}},cell:({row:l})=>{const a=l.original.code;return a?s("code",{class:"px-2 py-1 rounded bg-(--ui-bg-elevated) text-xs font-mono text-(--ui-primary)"},a):s("span",{class:"text-(--ui-text-muted)"},"-")}},{accessorKey:"coins",header:"能量",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:l})=>{const a=l.original.coins;return a?s("div",{class:"flex items-center gap-1"},[s("span",{class:"i-lucide-zap w-4 h-4 text-(--ui-warning)"}),s("span",{class:"font-medium text-(--ui-text-highlighted)"},a)]):s("span",{class:"text-(--ui-text-muted)"},"-")}},{accessorKey:"num",header:"张数",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:l})=>{const a=l.original.num;return s(w,{variant:"subtle",color:"info"},()=>`${a||0} 张`)}},{accessorKey:"limit",header:"限领次数",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:l})=>{const a=l.original.limit;return s(w,{variant:"subtle",color:"neutral"},()=>`${a||0} 次`)}},{accessorKey:"state",header:"使用状态",formItemProps:{component:"Select",componentProps:{options:he}},meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:l})=>{const[a,x]=be[l.original.state]||["未知","warning"];return s(w,{variant:"subtle",color:x},()=>a)}},{accessorKey:"remark",header:"备注",meta:{class:{th:"w-[150px]",td:"w-[150px]"}},cell:({row:l})=>{const a=l.original.remark;return a?s(P,{text:a},{default:()=>s("div",{class:"truncate max-w-[140px] text-(--ui-text-muted)"},a)}):s("span",{class:"text-(--ui-text-muted)"},"-")}},{accessorKey:"expire",header:"有效期",meta:{class:{th:"w-[160px]",td:"w-[160px]"}},cell:({row:l})=>{const a=l.original.expire;return a?s("div",{class:"flex items-center gap-2"},[s("span",{class:"i-lucide-calendar w-4 h-4 text-(--ui-text-muted)"}),s("span",{class:"text-sm"},M(a))]):s("span",{class:"text-(--ui-text-muted)"},"-")}},{accessorKey:"created_at",header:"创建时间",meta:{class:{th:"w-[160px]",td:"w-[160px]"}},cell:({row:l})=>{const a=l.original.created_at;return a?s("div",{class:"flex items-center gap-2"},[s("span",{class:"i-lucide-clock w-4 h-4 text-(--ui-text-muted)"}),s("span",{class:"text-sm"},M(a))]):s("span",{class:"text-(--ui-text-muted)"},"-")}}],ve={class:"mb-3 flex items-center gap-2"},we={class:"px-2 py-1 rounded bg-(--ui-bg-elevated) text-xs font-mono text-(--ui-primary)"},$e={key:0,class:"flex items-center justify-center py-8"},ke={key:1,class:"text-center py-8 text-(--ui-text-muted)"},Ve={key:2,class:"space-y-3 max-h-[400px] overflow-y-auto"},De={class:"flex items-center justify-between"},Ue={class:"flex flex-col"},Te={class:"text-sm font-medium text-(--ui-text-highlighted)"},Ce={class:"text-xs text-(--ui-text-muted)"},Pe={class:"text-xs text-(--ui-text-muted)"},Ie={key:3,class:"flex justify-center mt-4"},mt=E({name:"InvitationCodeList",__name:"invitation-code",setup(l){const a=L(),x=I,t=q({isDialog:!1,currentForm:{},recordDialog:!1,recordCode:"",recordList:[],recordLoading:!1,recordPage:1,recordPageSize:10,recordTotal:0}),y=d=>{t.currentForm={state:2},t.isDialog=!0},$=()=>{a.value?.reload(),t.isDialog=!1},k=async d=>{t.recordCode=d,t.recordDialog=!0,t.recordPage=1,await V()},V=async()=>{t.recordLoading=!0;try{const{data:d}=await F({code:t.recordCode,ty:1,page:t.recordPage,pagesize:t.recordPageSize});t.recordList=d?.list||[],t.recordTotal=d?.count||0}finally{t.recordLoading=!1}},T=d=>{t.recordPage=d,V()},i=[...ye,{id:"actions",header:"操作",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:d})=>s(I,{label:"领取记录",size:"xs",color:"neutral",variant:"outline",onClick:()=>k(d.original.code)})}];return(d,u)=>{const C=A,f=G,o=_e,v=S,b=ie,g=B;return _(),h(j,null,[r(f,null,{actions:c(()=>[r(e(x),{label:"添加兑换码",icon:"i-lucide-plus",color:"neutral",onClick:u[0]||(u[0]=p=>y())})]),default:c(()=>[r(C,{ref_key:"tableRef",ref:a,"data-request":e(F),columns:i,"scroll-x":"min-w-[1400px]"},null,8,["data-request"])]),_:1}),r(o,{dialog:e(t).isDialog,"onUpdate:dialog":u[1]||(u[1]=p=>e(t).isDialog=p),"current-form":e(t).currentForm,onRefresh:$},null,8,["dialog","current-form"]),r(g,{open:e(t).recordDialog,"onUpdate:open":u[3]||(u[3]=p=>e(t).recordDialog=p),title:"领取记录",ui:{content:"sm:max-w-2xl",footer:"justify-end bg-(--ui-bg-elevated)"}},{body:c(()=>[n("div",ve,[u[4]||(u[4]=n("span",{class:"text-sm text-(--ui-text-muted)"},"兑换码：",-1)),n("code",we,D(e(t).recordCode),1)]),e(t).recordLoading?(_(),h("div",$e,[r(v,{name:"i-lucide-loader",class:"w-6 h-6 animate-spin text-(--ui-text-muted)"})])):e(t).recordList.length===0?(_(),h("div",ke," 暂无领取记录 ")):(_(),h("div",Ve,[(_(!0),h(j,null,ae(e(t).recordList,p=>(_(),h("div",{key:p.id,class:"p-3 rounded-lg bg-(--ui-bg-elevated) border border-(--ui-border)"},[n("div",De,[n("div",Ue,[n("span",Te,D(p.member?.username||"未知用户"),1),n("span",Ce,"ID: "+D(p.uid),1)]),n("span",Pe,D(("formatToDateTime"in d?d.formatToDateTime:e(M))(p.created_at)),1)])]))),128))])),e(t).recordTotal>e(t).recordPageSize?(_(),h("div",Ie,[r(b,{page:e(t).recordPage,"items-per-page":e(t).recordPageSize,total:e(t).recordTotal,"onUpdate:page":T},null,8,["page","items-per-page","total"])])):re("",!0)]),footer:c(()=>[r(e(x),{label:"关闭",color:"neutral",variant:"outline",onClick:u[2]||(u[2]=p=>e(t).recordDialog=!1)})]),_:1},8,["open"])],64)}}});export{mt as default};
