import{_ as G}from"./CEcF5dWm.js";import{f as z,c as J,ap as W,i as I,az as X,j as K,aE as Y,l as H,a as w,o as p,w as l,B as t,_ as $,b as e,C as F,D as S,aq as N,a4 as Q,aT as Z,aU as ee,aV as ae,aW as oe,aF as u,aN as te,aO as se,k as U,A as re,aP as T,aX as le,G as ne,aY as ie}from"./DhOLkSnF.js";import{_ as me,a as ce,b as de,c as ue}from"./DAqc9GYg.js";import{_ as pe}from"./CSbqei5V.js";import{_ as fe}from"./DAIKkUkW.js";import{_ as ge}from"./DAeRr84W.js";import{_ as _e}from"./D0vBe5Vh.js";import{_ as be}from"./Db__RPjw.js";import{_ as ve}from"./BZLiX_8y.js";import{c as O}from"./45RcOEEf.js";import{o as he,n as E,s as j,l as ye}from"./B-mCBPct.js";import{u as xe,b as ke}from"./Bo5OMT4U.js";import{_ as A}from"./-rcGzxkB.js";import{f as we}from"./BmKy9gZZ.js";import{u as Ue}from"./BVQSm7Ip.js";import"./CZg69nbc.js";import"./CwtpYSSp.js";import"./DPsBupTg.js";import"./9Rxep3Q5.js";import"./CLKxJTZi.js";import"./HRiyi1uV.js";import"./BrXYpapi.js";import"./BXSyqGa5.js";const Fe={class:"flex flex-wrap items-center gap-3"},$e=z({__name:"Edit",props:{dialog:{type:Boolean,default:!1},currentForm:{default:()=>({})}},emits:["update:dialog","refresh"],setup(s,{emit:B}){const f=s,b=B,g=J({get(){return f.dialog},set(r){b("update:dialog",r)}}),C=()=>{g.value=!1},v=W("formRef"),m=I(),h=X(),V=he({username:j().nonempty(),password:j().min(8,"不能少于 8 个字符").optional().or(ye("")),group_id:E(),state:E()}),a=K({loading:!1,avatarLoading:!1,form:{},groupOptions:[{label:"运营",value:5},{label:"管理员",value:1},{label:"超级管理员",value:99}],stateOptions:[{label:"正常",value:2},{label:"禁用",value:1}]});async function D(r){const o=r.target;if(o.files?.length&&Z(o.files[0])){a.avatarLoading=!0;const{data:d}=await ee({image:o.files[0]});d&&(a.form.avatar=d.uri),a.avatarLoading=!1}}function P(){m.value?.click()}const n=Y();async function c(){a.loading=!0;const r=O(a.form);r.id=f.currentForm.id,!r.id&&!r.password&&(r.password="12345677");const{error:o}=await(r.id?ae:oe)(r);o||(n.add({title:"操作成功",color:"success"}),b("refresh")),a.loading=!1}return H(()=>f.dialog,r=>{r&&(a.loading=!1,a.form=f.currentForm)}),(r,o)=>{const d=$,k=fe,_=ge,R=N,y=_e,x=be,L=ve;return p(),w(L,{open:e(g),"onUpdate:open":o[7]||(o[7]=i=>Q(g)?g.value=i:null),title:s.currentForm.id?"修改":"新增",dismissible:!1,ui:{footer:"justify-end"}},{body:l(()=>[t(x,{ref_key:"formRef",ref:v,schema:e(V),state:e(a).form,class:"flex flex-col gap-4",onSubmit:c},{default:l(()=>[t(_,{label:"用户名",name:"username",required:""},{default:l(()=>[t(k,{modelValue:e(a).form.username,"onUpdate:modelValue":o[1]||(o[1]=i=>e(a).form.username=i),modelModifiers:{trim:!0},disabled:!!s.currentForm.id,placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:l(()=>[!s.currentForm.id&&e(a).form.username?(p(),w(d,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:o[0]||(o[0]=i=>e(a).form.username="")})):F("",!0)]),_:1},8,["modelValue","disabled"])]),_:1}),t(_,{label:"头像",name:"avatar",description:"JPG, JPEG or PNG. 1MB Max.",class:"flex max-sm:flex-col justify-between sm:items-center gap-4"},{default:l(()=>[S("div",Fe,[t(R,{src:e(a).form.avatar,alt:e(a).form.username,size:"xl"},null,8,["src","alt"]),t(d,{loading:e(a).avatarLoading,label:"上传",color:"neutral",onClick:P},null,8,["loading"]),S("input",{ref_key:"fileRef",ref:m,type:"file",class:"hidden",accept:".jpg, .jpeg, .png",onChange:D},null,544)])]),_:1}),t(_,{label:"密码",name:"password",help:"初始值为：12345677，不填则不修改"},{default:l(()=>[t(k,{modelValue:e(a).form.password,"onUpdate:modelValue":o[3]||(o[3]=i=>e(a).form.password=i),modelModifiers:{trim:!0},placeholder:"请输入",class:"w-full",ui:{trailing:"pe-1"}},{trailing:l(()=>[e(a).form.password?(p(),w(d,{key:0,color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x",onClick:o[2]||(o[2]=i=>e(a).form.password="")})):F("",!0)]),_:1},8,["modelValue"])]),_:1}),e(h).userInfo.group_id==99?(p(),w(_,{key:0,label:"角色",name:"group_id",required:""},{default:l(()=>[t(y,{modelValue:e(a).form.group_id,"onUpdate:modelValue":o[4]||(o[4]=i=>e(a).form.group_id=i),items:e(a).groupOptions,placeholder:"请选择",class:"w-full"},null,8,["modelValue","items"])]),_:1})):F("",!0),t(_,{label:"状态",name:"state",required:""},{default:l(()=>[t(y,{modelValue:e(a).form.state,"onUpdate:modelValue":o[5]||(o[5]=i=>e(a).form.state=i),items:e(a).stateOptions,placeholder:"请选择",class:"w-full"},null,8,["modelValue","items"])]),_:1})]),_:1},8,["schema","state"])]),footer:l(()=>[t(d,{label:"取消",color:"neutral",variant:"outline",onClick:C}),t(d,{loading:e(a).loading,label:"确认",variant:"solid",onClick:o[6]||(o[6]=i=>e(v)?.submit())},null,8,["loading"])]),_:1},8,["open","title"])}}}),Ce=Object.assign($e,{__name:"SystemUserEdit"}),M={1:["管理员","warning"],5:["运营","info"],99:["超级管理员","error"]},q={1:["禁用","error"],2:["正常","success"],4:["已删除","error"]},Ve=[{accessorKey:"id",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},header:()=>u($,{color:"neutral",variant:"ghost",label:"ID",class:"-mx-2.5 hover:bg-transparent focus:bg-transparent data-[state=open]:bg-transparent text-(--ui-text-highlighted) font-semibold"})},{accessorKey:"username",header:"账号",searchPlaceholder:"筛选账号",cell:({row:s})=>u("div",{class:"flex items-center gap-3"},[u(N,{src:s.original.avatar,alt:s.original.username,size:"lg"}),u("div",void 0,[u("p",{class:"font-medium text-(--ui-text-highlighted)"},s.original.username)])])},{accessorKey:"created_at",header:"注册时间",cell:({row:s})=>we(s.original.created_at)},{accessorKey:"ip",header:"登录IP"},{accessorKey:"group_id",header:"角色",searchPlaceholder:"筛选角色",formItemProps:{component:"Select",componentProps:{options:[{label:"管理员",value:1},{label:"运营",value:5},{label:"超级管理员",value:99}]}},cell:({row:s})=>u(A,{class:"capitalize",variant:"subtle",color:M[s.original.group_id]?.[1]},()=>M[s.original.group_id]?.[0])},{accessorKey:"state",header:"状态",searchPlaceholder:"筛选状态",formItemProps:{component:"Select",componentProps:{options:[{label:"正常",value:2},{label:"禁用",value:1},{label:"已删除",value:4}]}},cell:({row:s})=>u(A,{class:"capitalize",variant:"subtle",color:q[s.original.state]?.[1]},()=>q[s.original.state]?.[0])}],De={key:0,class:"absolute top-0 left-0 right-0 h-(--ui-header-height) flex items-center justify-between border-b border-(--ui-border) px-4 sm:px-6 bg-(--ui-bg)"},Pe={class:"flex items-center gap-4"},ea=z({name:"SystemUser",__name:"user",setup(s){const f=xe(ke).smaller("lg"),b=I(),g=$,C=Ue(),{hasPermission:v}=te(),m=K({isDialog:!1,currentForm:{}}),h=async n=>{m.isDialog=!0,n?m.currentForm=O(n):m.currentForm={group_id:5,state:2}},V=async()=>{b.value.reload(),m.isDialog=!1},a=async n=>{const{error:c}=await ie({id:n.id});c||b.value.reload()};function D(n){return[{label:"编辑",icon:"material-symbols:edit-square-outline",disabled:!v("admin-edit"),onSelect(){h(n.original)}},{type:"separator"},{label:"删除",icon:"material-symbols:contract-delete-outline-rounded",color:"error",disabled:!v("admin-remove"),onSelect(){C.open({color:"error",title:"删除数据",description:"您确定要删除吗？",onPositiveClick(){a(n.original)}})}}]}const P=[...Ve,{id:"actions",meta:{class:{th:"w-[100px]",td:"w-[100px]"}},cell:({row:n})=>u("div",{class:"text-right"},u(G,{content:{align:"end"},items:D(n)},()=>u($,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"})))}];return(n,c)=>{const r=ce,o=me,d=de,k=pe,_=ue,R=Ce,y=se("permission");return p(),U(ne,null,[t(_,{ui:{body:"pb-[12px]! gap-0!"}},re({body:l(()=>[e(f)?F("",!0):(p(),U("div",De,[S("div",Pe,[t(r),t(d)]),T((p(),U("div",null,[t(e(g),{label:"新增",icon:"i-lucide-plus",onClick:c[1]||(c[1]=x=>h(null))})])),[[y,"admin-add"]])])),t(k,{ref_key:"tableRef",ref:b,"data-request":e(le),columns:P,"scroll-x":"min-w-[1200px]"},null,8,["data-request"])]),_:2},[e(f)?{name:"header",fn:l(()=>[t(o,{title:"系统用户"},{leading:l(()=>[t(r)]),right:l(()=>[T((p(),U("div",null,[t(e(g),{label:"新增",icon:"i-lucide-plus",onClick:c[0]||(c[0]=x=>h(null))})])),[[y,"admin-add"]])]),_:1})]),key:"0"}:void 0]),1024),t(R,{dialog:e(m).isDialog,"onUpdate:dialog":c[2]||(c[2]=x=>e(m).isDialog=x),"current-form":e(m).currentForm,onRefresh:V},null,8,["dialog","current-form"])],64)}}});export{ea as default};
